# Onno í”„ë¡ íŠ¸ì—”ë“œ ê¸°ìˆ  ìŠ¤í™

**ë²„ì „**: 2.1 (Part 6.4 ì ‘ê·¼ì„± - í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜, í¬ì»¤ìŠ¤ ê´€ë¦¬, ìŠ¤í¬ë¦° ë¦¬ë” ì§€ì› êµ¬í˜„)
**ì‘ì„±ì¼**: 2025-12-29 (ìµœì¢… ì—…ë°ì´íŠ¸: 2025-12-30)
**ëŒ€ìƒ**: í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì
**ëª©ì **: ê°œë°œìê°€ ë°”ë¡œ ì½”ë”© ì‹œì‘ ê°€ëŠ¥í•œ ì™„ì „í•œ ê¸°ìˆ  ëª…ì„¸
**Part 1.4 ì—…ë°ì´íŠ¸**: Notion í†µí•© ì»´í¬ë„ŒíŠ¸ ë° ì´ë²¤íŠ¸ ë¡œê¹… ì¶”ê°€
**Part 1.5 ì—…ë°ì´íŠ¸**: ë¯¸íŒ… ì¤€ë¹„ ëª¨ë‹¬ 5-Layer Framework ê¸°ë°˜ êµ¬í˜„
**Part 2 ì—…ë°ì´íŠ¸**: Today í™”ë©´ ì„¹ì…˜ êµ¬ì¡° ë° ì¹´ë“œ ìƒíƒœ ê´€ë¦¬ êµ¬í˜„
**Part 3 ì—…ë°ì´íŠ¸**: HUD ìë™ ì‹œì‘, Idle ìƒíƒœ, ì•Œë¦¼ ì‹œìŠ¤í…œ, ì‚¬ìš©ì ì‘ë‹µ ì²˜ë¦¬ êµ¬í˜„
**Part 4 ì—…ë°ì´íŠ¸**: í™•ì • ëª¨ë‹¬ ê³ ë„í™”, ìë™ ì „í™˜, ì™„ë£Œ í™”ë©´, Notion í†µí•© êµ¬í˜„ ì¶”ê°€
**Part 5 ì—…ë°ì´íŠ¸**: ê²€ìƒ‰ í™”ë©´, ì‹œë§¨í‹± ê²€ìƒ‰, ê²°ê³¼ ë¦¬ìŠ¤íŠ¸, ìƒì„¸ ì¡°íšŒ, í•„í„° ì»´í¬ë„ŒíŠ¸ êµ¬í˜„ ì¶”ê°€
**Part 5.2 ì—…ë°ì´íŠ¸**: ì„¤ì • í™”ë©´, í†µí•© ê´€ë¦¬, ì•Œë¦¼ ì„¤ì •, í”„ë¡œí•„ í¸ì§‘ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„ ì¶”ê°€
**Part 6.1 ì—…ë°ì´íŠ¸**: ì—ëŸ¬ ë¶„ë¥˜ ì‹œìŠ¤í…œ, ì—ëŸ¬ ì»´í¬ë„ŒíŠ¸, ë³µêµ¬ UI, ì—ëŸ¬ Analytics êµ¬í˜„ ì¶”ê°€
**Part 6.2 ì—…ë°ì´íŠ¸**: ë¡œë”© Store, Skeleton/Spinner/Progress ì»´í¬ë„ŒíŠ¸, ë‚™ê´€ì  UI, ë¡œë”© Analytics êµ¬í˜„ ì¶”ê°€
**Part 6.3 ì—…ë°ì´íŠ¸**: ë¹ˆ ìƒíƒœ Store, ë²”ìš©/ì¸ë¼ì¸ ë¹ˆ ìƒíƒœ ì»´í¬ë„ŒíŠ¸, ì»¨í…ìŠ¤íŠ¸ë³„ í”„ë¦¬ì…‹, ë¹ˆ ìƒíƒœ Analytics êµ¬í˜„ ì¶”ê°€
**Part 6.4 ì—…ë°ì´íŠ¸**: ì ‘ê·¼ì„± Store, í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜, í¬ì»¤ìŠ¤ íŠ¸ë©, ìŠ¤í¬ë¦° ë¦¬ë” ìœ í‹¸, ARIA ë¼ì´ë¸Œ ë¦¬ì „, ì ‘ê·¼ì„± Analytics êµ¬í˜„ ì¶”ê°€

---

## ğŸ“‹ ëª©ì°¨

1. [ê¸°ìˆ  ìŠ¤íƒ](#1-ê¸°ìˆ -ìŠ¤íƒ)
2. [í”„ë¡œì íŠ¸ êµ¬ì¡°](#2-í”„ë¡œì íŠ¸-êµ¬ì¡°)
3. [ìƒíƒœ ê´€ë¦¬](#3-ìƒíƒœ-ê´€ë¦¬)
4. [ë¼ìš°íŒ… ë° ë‚´ë¹„ê²Œì´ì…˜](#4-ë¼ìš°íŒ…-ë°-ë‚´ë¹„ê²Œì´ì…˜)
5. [ì»´í¬ë„ŒíŠ¸ ì•„í‚¤í…ì²˜](#5-ì»´í¬ë„ŒíŠ¸-ì•„í‚¤í…ì²˜)
6. [ë°ì´í„° í˜ì¹­](#6-ë°ì´í„°-í˜ì¹­)
7. [ì‹¤ì‹œê°„ í†µì‹ ](#7-ì‹¤ì‹œê°„-í†µì‹ )
8. [ë¸Œë¼ìš°ì € í™•ì¥ êµ¬í˜„](#8-ë¸Œë¼ìš°ì €-í™•ì¥-êµ¬í˜„)
9. [HUD êµ¬í˜„](#9-hud-êµ¬í˜„)
10. [ì„±ëŠ¥ ìµœì í™”](#10-ì„±ëŠ¥-ìµœì í™”)
11. [í…ŒìŠ¤íŠ¸ ì „ëµ](#11-í…ŒìŠ¤íŠ¸-ì „ëµ)
12. [ë¹Œë“œ ë° ë°°í¬](#12-ë¹Œë“œ-ë°-ë°°í¬)

---

## 1. ê¸°ìˆ  ìŠ¤íƒ

### 1.1 Core Stack

```json
{
  "framework": "React 18.2.0",
  "language": "TypeScript 5.3.0",
  "bundler": "Vite 5.0.0",
  "package-manager": "pnpm 8.0.0"
}
```

**ì„ íƒ ì´ìœ :**

```
React 18:
â”œâ”€ Concurrent Features (ì„±ëŠ¥)
â”œâ”€ Automatic Batching (ë¦¬ë Œë”ë§ ìµœì í™”)
â”œâ”€ Streaming SSR ì§€ì› (í–¥í›„)
â””â”€ ìƒíƒœê³„ ì„±ìˆ™ë„

TypeScript:
â”œâ”€ íƒ€ì… ì•ˆì „ì„± (ëŸ°íƒ€ì„ ì—ëŸ¬ ë°©ì§€)
â”œâ”€ IDE ì§€ì› ìš°ìˆ˜ (ìë™ì™„ì„±)
â”œâ”€ ë¦¬íŒ©í† ë§ ìš©ì´
â””â”€ íŒ€ í˜‘ì—… í–¥ìƒ

Vite:
â”œâ”€ ê°œë°œ ì„œë²„ ë¹ ë¦„ (< 1ì´ˆ ì‹œì‘)
â”œâ”€ HMR ë¹ ë¦„ (ì¦‰ê° ë°˜ì˜)
â”œâ”€ ë¹Œë“œ ë¹ ë¦„ (Rollup ê¸°ë°˜)
â””â”€ ì„¤ì • ê°„ë‹¨

pnpm:
â”œâ”€ ë””ìŠ¤í¬ ê³µê°„ ì ˆì•½ (ì‹¬ë³¼ë¦­ ë§í¬)
â”œâ”€ ì„¤ì¹˜ ì†ë„ ë¹ ë¦„
â””â”€ Monorepo ì§€ì› ìš°ìˆ˜
```

### 1.2 UI Libraries

```json
{
  "styling": "TailwindCSS 3.4.0",
  "components": "Radix UI 1.0.0",
  "animation": "Framer Motion 11.0.0",
  "icons": "Lucide React 0.300.0",
  "fonts": "@fontsource/pretendard"
}
```

**ì„ íƒ ì´ìœ :**

```
TailwindCSS:
â”œâ”€ Utility-first (ë¹ ë¥¸ ê°œë°œ)
â”œâ”€ ì¼ê´€ì„± ìœ ì§€ (ë””ìì¸ ì‹œìŠ¤í…œ)
â”œâ”€ Tree-shaking (ì‚¬ìš© ì•ˆ í•œ CSS ì œê±°)
â”œâ”€ JIT ëª¨ë“œ (ë¹Œë“œ ì†ë„)
â””â”€ Figmaì™€ ë§¤í•‘ ì‰¬ì›€

Radix UI:
â”œâ”€ Headless Components (ìŠ¤íƒ€ì¼ ììœ )
â”œâ”€ ì ‘ê·¼ì„± ìš°ìˆ˜ (WAI-ARIA)
â”œâ”€ í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
â””â”€ Unstyled (Tailwindì™€ ì¡°í•©)

Framer Motion:
â”œâ”€ ì„ ì–¸ì  ì• ë‹ˆë©”ì´ì…˜
â”œâ”€ Layout ì• ë‹ˆë©”ì´ì…˜ (Auto)
â”œâ”€ Gesture ì§€ì› (Drag, Hover)
â””â”€ ì„±ëŠ¥ ìš°ìˆ˜ (GPU ê°€ì†)

Lucide React:
â”œâ”€ Tree-shakable (ë²ˆë“¤ ì‚¬ì´ì¦ˆ ì‘ìŒ)
â”œâ”€ ì¼ê´€ëœ ë””ìì¸
â”œâ”€ React ì»´í¬ë„ŒíŠ¸
â””â”€ ì»¤ìŠ¤í„°ë§ˆì´ì§• ì‰¬ì›€
```

### 1.3 State Management

```json
{
  "global-state": "Zustand 4.4.0",
  "server-state": "TanStack Query 5.0.0",
  "form-state": "React Hook Form 7.49.0"
}
```

**ì„ íƒ ì´ìœ :**

```
Zustand:
â”œâ”€ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì ìŒ (Redux ëŒ€ë¹„)
â”œâ”€ ëŸ¬ë‹ ì»¤ë¸Œ ë‚®ìŒ
â”œâ”€ ë²ˆë“¤ ì‚¬ì´ì¦ˆ ì‘ìŒ (~1KB)
â”œâ”€ TypeScript ì§€ì› ìš°ìˆ˜
â””â”€ DevTools ì§€ì›

TanStack Query:
â”œâ”€ ì„œë²„ ìƒíƒœ ì „ìš© (ìºì‹±, ë¦¬í˜ì¹­)
â”œâ”€ Optimistic Updates
â”œâ”€ ìë™ ì¬ì‹œë„
â”œâ”€ Background Refetch
â””â”€ DevTools ë‚´ì¥

React Hook Form:
â”œâ”€ ë¹„ì œì–´ ì»´í¬ë„ŒíŠ¸ (ì„±ëŠ¥)
â”œâ”€ Validation ìš°ìˆ˜ (Zod ì—°ë™)
â”œâ”€ ì¬ë Œë”ë§ ìµœì†Œí™”
â””â”€ API ê°„ë‹¨
```

### 1.4 Development Tools

```json
{
  "linting": "ESLint 8.56.0",
  "formatting": "Prettier 3.1.0",
  "type-checking": "TypeScript",
  "testing": "Vitest 1.0.0",
  "e2e-testing": "Playwright 1.40.0",
  "git-hooks": "Husky 8.0.0"
}
```

### 1.5 Browser Extension Specific

```json
{
  "extension-api": "chrome-types 0.1.0",
  "manifest-version": "3",
  "build-tool": "@crxjs/vite-plugin 2.0.0"
}
```

---

## 2. í”„ë¡œì íŠ¸ êµ¬ì¡°

### 2.1 í´ë” êµ¬ì¡°

```
onno-webapp/
â”œâ”€ public/
â”‚  â”œâ”€ icons/
â”‚  â”‚  â”œâ”€ logo.svg
â”‚  â”‚  â””â”€ favicon.ico
â”‚  â””â”€ videos/
â”‚     â””â”€ demo.mp4
â”‚
â”œâ”€ src/
â”‚  â”œâ”€ app/                 # Next.js App Router (ì›¹ ê¸°ë°˜)
â”‚  â”‚  â”œâ”€ page.tsx         # ëœë”© í˜ì´ì§€
â”‚  â”‚  â”œâ”€ layout.tsx
â”‚  â”‚  â””â”€ app/             # ë©”ì¸ í”„ë¡œë•íŠ¸
â”‚  â”‚     â”œâ”€ onboarding/   # ì˜¨ë³´ë”© í”Œë¡œìš°
â”‚  â”‚     â”œâ”€ now/
â”‚  â”‚     â”œâ”€ today/
â”‚  â”‚     â””â”€ search/
â”‚  â”‚
â”‚  â”œâ”€ sidepanel/           # (í–¥í›„ ì‹¤ì œ í™•ì¥ìš©)
â”‚  â”‚  â”œâ”€ index.tsx
â”‚  â”‚  â”œâ”€ App.tsx
â”‚  â”‚  â”œâ”€ router.tsx
â”‚  â”‚  â””â”€ main.css
â”‚  â”‚
â”‚  â”œâ”€ components/          # ê³µìš© ì»´í¬ë„ŒíŠ¸
â”‚  â”‚  â”œâ”€ onboarding/
â”‚  â”‚  â”‚  â”œâ”€ LandingPage.tsx
â”‚  â”‚  â”‚  â”œâ”€ InstallationModal.tsx
â”‚  â”‚  â”‚  â”œâ”€ BrowserSelection.tsx
â”‚  â”‚  â”‚  â”œâ”€ InstallingStep.tsx
â”‚  â”‚  â”‚  â”œâ”€ CompleteStep.tsx
â”‚  â”‚  â”‚  â”œâ”€ SignupModal.tsx           # Part 1.3: íšŒì›ê°€ì… ëª¨ë‹¬
â”‚  â”‚  â”‚  â”œâ”€ EmailSignupForm.tsx       # ì´ë©”ì¼ ê°€ì… í¼
â”‚  â”‚  â”‚  â”œâ”€ LaterConfirmModal.tsx     # "ë‚˜ì¤‘ì—" í™•ì¸ ëª¨ë‹¬
â”‚  â”‚  â”‚  â”œâ”€ NotionIntegration.tsx     # Part 1.4: Notion í†µí•©
â”‚  â”‚  â”‚  â””â”€ PreparationModal.tsx      # Part 1.5: ë¯¸íŒ… ì¤€ë¹„ ëª¨ë‹¬
â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€ screens/
â”‚  â”‚  â”‚  â”œâ”€ NowScreen/
â”‚  â”‚  â”‚  â”‚  â”œâ”€ index.tsx
â”‚  â”‚  â”‚  â”‚  â”œâ”€ HUDIdle.tsx
â”‚  â”‚  â”‚  â”‚  â”œâ”€ HUDAlert.tsx
â”‚  â”‚  â”‚  â”‚  â””â”€ AlertCard.tsx
â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ TodayScreen/
â”‚  â”‚  â”‚  â”‚  â”œâ”€ index.tsx
â”‚  â”‚  â”‚  â”‚  â”œâ”€ PriorityList.tsx
â”‚  â”‚  â”‚  â”‚  â”œâ”€ MeetingCard.tsx
â”‚  â”‚  â”‚  â”‚  â”œâ”€ PrepModal.tsx
â”‚  â”‚  â”‚  â”‚  â””â”€ ConfirmModal.tsx
â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ SearchScreen/
â”‚  â”‚  â”‚     â”œâ”€ index.tsx
â”‚  â”‚  â”‚     â”œâ”€ SearchBar.tsx
â”‚  â”‚  â”‚     â”œâ”€ ResultList.tsx
â”‚  â”‚  â”‚     â””â”€ ResultCard.tsx
â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€ common/
â”‚  â”‚  â”‚  â”œâ”€ Button.tsx
â”‚  â”‚  â”‚  â”œâ”€ Input.tsx
â”‚  â”‚  â”‚  â”œâ”€ Card.tsx
â”‚  â”‚  â”‚  â”œâ”€ Badge.tsx
â”‚  â”‚  â”‚  â”œâ”€ Navigation.tsx
â”‚  â”‚  â”‚  â”œâ”€ Toast.tsx
â”‚  â”‚  â”‚  â””â”€ Modal.tsx
â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€ layouts/
â”‚  â”‚     â”œâ”€ MainLayout.tsx
â”‚  â”‚     â””â”€ ModalLayout.tsx
â”‚  â”‚
â”‚  â”œâ”€ hooks/               # Custom Hooks
â”‚  â”‚  â”œâ”€ useMeeting.ts
â”‚  â”‚  â”œâ”€ useRealtime.ts
â”‚  â”‚  â”œâ”€ useDecisions.ts
â”‚  â”‚  â”œâ”€ useSearch.ts
â”‚  â”‚  â”œâ”€ useToast.ts
â”‚  â”‚  â””â”€ useMeetingPrep.ts   # Part 1.5: ë¯¸íŒ… ì¤€ë¹„ í›…
â”‚  â”‚
â”‚  â”œâ”€ stores/              # Zustand Stores
â”‚  â”‚  â”œâ”€ meetingStore.ts
â”‚  â”‚  â”œâ”€ hudStore.ts
â”‚  â”‚  â”œâ”€ todayStore.ts
â”‚  â”‚  â””â”€ userStore.ts
â”‚  â”‚
â”‚  â”œâ”€ services/            # API í˜¸ì¶œ
â”‚  â”‚  â”œâ”€ api.ts
â”‚  â”‚  â”œâ”€ meetingApi.ts
â”‚  â”‚  â”œâ”€ decisionApi.ts
â”‚  â”‚  â”œâ”€ searchApi.ts
â”‚  â”‚  â””â”€ websocket.ts
â”‚  â”‚
â”‚  â”œâ”€ utils/               # ìœ í‹¸ë¦¬í‹°
â”‚  â”‚  â”œâ”€ date.ts
â”‚  â”‚  â”œâ”€ format.ts
â”‚  â”‚  â”œâ”€ validation.ts
â”‚  â”‚  â””â”€ storage.ts
â”‚  â”‚
â”‚  â”œâ”€ types/               # TypeScript íƒ€ì…
â”‚  â”‚  â”œâ”€ meeting.ts
â”‚  â”‚  â”œâ”€ decision.ts
â”‚  â”‚  â”œâ”€ alert.ts
â”‚  â”‚  â””â”€ api.ts
â”‚  â”‚
â”‚  â””â”€ constants/           # ìƒìˆ˜
â”‚     â”œâ”€ routes.ts
â”‚     â”œâ”€ config.ts
â”‚     â””â”€ messages.ts
â”‚
â”œâ”€ tests/
â”‚  â”œâ”€ unit/
â”‚  â”œâ”€ integration/
â”‚  â””â”€ e2e/
â”‚
â”œâ”€ .env.example
â”œâ”€ .eslintrc.json
â”œâ”€ .prettierrc
â”œâ”€ tsconfig.json
â”œâ”€ vite.config.ts
â”œâ”€ tailwind.config.js
â””â”€ package.json
```

### 2.2 ì£¼ìš” íŒŒì¼ ì„¤ëª…

```typescript
// src/app/page.tsx (ëœë”© í˜ì´ì§€)
import { LandingPage } from '@/components/onboarding/LandingPage';

export default function HomePage() {
  return <LandingPage />;
}

// src/app/app/onboarding/page.tsx (ë©”ì¸ í”„ë¡œë•íŠ¸ ì§„ì…ì )
import { TodayScreen } from '@/components/screens/TodayScreen';

export default function OnboardingPage() {
  return <TodayScreen />;
}

// package.json
{
  "name": "onno-webapp",
  "version": "1.0.0",
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start"
  },
  "dependencies": {
    "react": "^18.2.0",
    "next": "^14.0.0",
    "typescript": "^5.3.0",
    "tailwindcss": "^3.4.0",
    "framer-motion": "^11.0.0",
    "zustand": "^4.4.0"
  }
}

// ì£¼ì˜ì‚¬í•­:
// - MVPëŠ” ì›¹ ê¸°ë°˜ ì²´í—˜ ë²„ì „
// - ì‹¤ì œ ë¸Œë¼ìš°ì € í™•ì¥ì€ í–¥í›„ ê°œë°œ
// - manifest.jsonì€ í–¥í›„ Phase 2ì—ì„œ ì¶”ê°€
```

---

## 3. ìƒíƒœ ê´€ë¦¬

### 3.1 Zustand Store ì„¤ê³„

#### Meeting Store (íšŒì˜ ìƒíƒœ)

```typescript
// src/stores/meetingStore.ts
import { create } from 'zustand';
import { devtools, persist } from 'zustand/middleware';

export interface Meeting {
  id: string;
  title: string;
  company: string;
  startTime: Date;
  endTime?: Date;
  status: 'scheduled' | 'ongoing' | 'completed';
  participants: string[];
  transcript: TranscriptItem[];
  decisions: Decision[];
  insights: Insight[];
}

export interface TranscriptItem {
  id: string;
  timestamp: number;
  speaker: string;
  text: string;
}

interface MeetingStore {
  // State
  currentMeeting: Meeting | null;
  meetings: Meeting[];
  isRecording: boolean;

  // Actions
  startMeeting: (meeting: Omit<Meeting, 'id'>) => void;
  endMeeting: () => void;
  updateTranscript: (item: TranscriptItem) => void;
  addDecision: (decision: Decision) => void;
  addInsight: (insight: Insight) => void;

  // Computed
  getMeetingById: (id: string) => Meeting | undefined;
  getRecentMeetings: (limit: number) => Meeting[];
}

export const useMeetingStore = create<MeetingStore>()(
  devtools(
    persist(
      (set, get) => ({
        // Initial State
        currentMeeting: null,
        meetings: [],
        isRecording: false,

        // Actions
        startMeeting: (meeting) => {
          const newMeeting: Meeting = {
            ...meeting,
            id: crypto.randomUUID(),
            status: 'ongoing',
            transcript: [],
            decisions: [],
            insights: [],
          };

          set((state) => ({
            currentMeeting: newMeeting,
            meetings: [newMeeting, ...state.meetings],
            isRecording: true,
          }));
        },

        endMeeting: () => {
          set((state) => {
            if (!state.currentMeeting) return state;

            const updatedMeeting: Meeting = {
              ...state.currentMeeting,
              endTime: new Date(),
              status: 'completed',
            };

            return {
              currentMeeting: null,
              isRecording: false,
              meetings: state.meetings.map((m) =>
                m.id === updatedMeeting.id ? updatedMeeting : m
              ),
            };
          });
        },

        updateTranscript: (item) => {
          set((state) => {
            if (!state.currentMeeting) return state;

            return {
              currentMeeting: {
                ...state.currentMeeting,
                transcript: [...state.currentMeeting.transcript, item],
              },
            };
          });
        },

        addDecision: (decision) => {
          set((state) => {
            if (!state.currentMeeting) return state;

            return {
              currentMeeting: {
                ...state.currentMeeting,
                decisions: [...state.currentMeeting.decisions, decision],
              },
            };
          });
        },

        addInsight: (insight) => {
          set((state) => {
            if (!state.currentMeeting) return state;

            return {
              currentMeeting: {
                ...state.currentMeeting,
                insights: [...state.currentMeeting.insights, insight],
              },
            };
          });
        },

        // Computed
        getMeetingById: (id) => {
          return get().meetings.find((m) => m.id === id);
        },

        getRecentMeetings: (limit) => {
          return get().meetings.slice(0, limit);
        },
      }),
      {
        name: 'onno-meetings',
        partialize: (state) => ({
          meetings: state.meetings,
        }),
      }
    )
  )
);
```

#### HUD Store (HUD ìƒíƒœ)

```typescript
// src/stores/hudStore.ts
import { create } from 'zustand';

export type HUDState = 'idle' | 'alert';
export type AlertLevel = 1 | 2 | 3;

export interface Alert {
  id: string;
  level: AlertLevel;
  icon: string;
  title: string;
  message: string;
  suggestedQuestion?: string;
  reason?: string[];
  timestamp: number;
}

interface HUDStore {
  // State
  state: HUDState;
  currentAlert: Alert | null;
  alertQueue: Alert[];
  infoAlerts: Alert[];

  // Actions
  showAlert: (alert: Omit<Alert, 'id' | 'timestamp'>) => void;
  dismissAlert: () => void;
  askQuestion: (alertId: string) => void;

  // Computed
  hasAlerts: () => boolean;
  getAlertCount: () => number;
}

export const useHUDStore = create<HUDStore>()((set, get) => ({
  // Initial State
  state: 'idle',
  currentAlert: null,
  alertQueue: [],
  infoAlerts: [],

  // Actions
  showAlert: (alert) => {
    const newAlert: Alert = {
      ...alert,
      id: crypto.randomUUID(),
      timestamp: Date.now(),
    };

    // Level 1 (Info): íì—ë§Œ ì¶”ê°€, í‘œì‹œ ì•ˆ í•¨
    if (newAlert.level === 1) {
      set((state) => ({
        infoAlerts: [...state.infoAlerts, newAlert],
      }));
      return;
    }

    // Level 2, 3: ì¦‰ì‹œ í‘œì‹œ
    set((state) => ({
      state: 'alert',
      currentAlert: newAlert,
      alertQueue: [...state.alertQueue, newAlert],
    }));

    // Level 2: 10ì´ˆ í›„ ìë™ ë‹«í˜
    if (newAlert.level === 2) {
      setTimeout(() => {
        const current = get().currentAlert;
        if (current?.id === newAlert.id) {
          get().dismissAlert();
        }
      }, 10000);
    }
  },

  dismissAlert: () => {
    set({
      state: 'idle',
      currentAlert: null,
    });
  },

  askQuestion: (alertId) => {
    const alert = get().alertQueue.find((a) => a.id === alertId);
    if (alert?.suggestedQuestion) {
      // TODO: ì§ˆë¬¸ì„ í´ë¦½ë³´ë“œì— ë³µì‚¬í•˜ê±°ë‚˜ ìŒì„± ì…ë ¥ íŠ¸ë¦¬ê±°
      navigator.clipboard.writeText(alert.suggestedQuestion);
    }
    get().dismissAlert();
  },

  // Computed
  hasAlerts: () => {
    return get().alertQueue.length > 0 || get().infoAlerts.length > 0;
  },

  getAlertCount: () => {
    return get().infoAlerts.length;
  },
}));
```

#### Today Store (ì˜¤ëŠ˜ í•  ì¼)

```typescript
// src/stores/todayStore.ts
import { create } from 'zustand';

export type TaskPriority = 'urgent' | 'today' | 'later';

export interface Task {
  id: string;
  type: 'confirmation' | 'preparation' | 'action';
  priority: TaskPriority;
  meetingId?: string;
  title: string;
  description: string;
  estimatedTime: number; // ë¶„ ë‹¨ìœ„
  dueDate?: Date;
  completed: boolean;
}

interface TodayStore {
  // State
  tasks: Task[];

  // Actions
  addTask: (task: Omit<Task, 'id' | 'completed'>) => void;
  completeTask: (taskId: string) => void;
  deleteTask: (taskId: string) => void;

  // Computed
  getTasksByPriority: (priority: TaskPriority) => Task[];
  getUrgentCount: () => number;
  getTodayCount: () => number;
}

export const useTodayStore = create<TodayStore>()((set, get) => ({
  // Initial State
  tasks: [],

  // Actions
  addTask: (task) => {
    const newTask: Task = {
      ...task,
      id: crypto.randomUUID(),
      completed: false,
    };

    set((state) => ({
      tasks: [...state.tasks, newTask],
    }));
  },

  completeTask: (taskId) => {
    set((state) => ({
      tasks: state.tasks.map((t) =>
        t.id === taskId ? { ...t, completed: true } : t
      ),
    }));
  },

  deleteTask: (taskId) => {
    set((state) => ({
      tasks: state.tasks.filter((t) => t.id !== taskId),
    }));
  },

  // Computed
  getTasksByPriority: (priority) => {
    return get().tasks.filter(
      (t) => t.priority === priority && !t.completed
    );
  },

  getUrgentCount: () => {
    return get().tasks.filter(
      (t) => t.priority === 'urgent' && !t.completed
    ).length;
  },

  getTodayCount: () => {
    return get().tasks.filter(
      (t) => t.priority === 'today' && !t.completed
    ).length;
  },
}));
```

---

## 4. ë¼ìš°íŒ… ë° ë‚´ë¹„ê²Œì´ì…˜

### 4.1 Router ì„¤ì •

```typescript
// src/sidepanel/router.tsx
import { createBrowserRouter } from 'react-router-dom';
import { MainLayout } from '@/components/layouts/MainLayout';
import { NowScreen } from '@/components/screens/NowScreen';
import { TodayScreen } from '@/components/screens/TodayScreen';
import { SearchScreen } from '@/components/screens/SearchScreen';

export const router = createBrowserRouter([
  {
    path: '/',
    element: <MainLayout />,
    children: [
      {
        index: true,
        element: <TodayScreen />, // ê¸°ë³¸ í™”ë©´
      },
      {
        path: 'now',
        element: <NowScreen />,
      },
      {
        path: 'today',
        element: <TodayScreen />,
      },
      {
        path: 'search',
        element: <SearchScreen />,
      },
    ],
  },
]);
```

### 4.2 Navigation Component

```typescript
// src/components/common/Navigation.tsx
import { NavLink } from 'react-router-dom';
import { Radio, Calendar, Search, Settings } from 'lucide-react';
import { useHUDStore } from '@/stores/hudStore';
import { useTodayStore } from '@/stores/todayStore';

export function Navigation() {
  const alertCount = useHUDStore((state) => state.getAlertCount());
  const urgentCount = useTodayStore((state) => state.getUrgentCount());

  const tabs = [
    {
      to: '/now',
      icon: Radio,
      label: 'ì§€ê¸ˆ',
      badge: alertCount,
    },
    {
      to: '/today',
      icon: Calendar,
      label: 'ì˜¤ëŠ˜',
      badge: urgentCount,
    },
    {
      to: '/search',
      icon: Search,
      label: 'ê²€ìƒ‰',
    },
  ];

  return (
    <nav className="flex h-14 border-b border-gray-200 bg-white sticky top-0 z-50">
      {tabs.map((tab) => (
        <NavLink
          key={tab.to}
          to={tab.to}
          className={({ isActive }) =>
            `flex-1 flex flex-col items-center justify-center gap-1 relative
             transition-colors duration-200
             ${isActive
               ? 'text-blue-500'
               : 'text-gray-400 hover:bg-gray-50'
             }`
          }
        >
          {({ isActive }) => (
            <>
              <tab.icon size={24} />
              <span className="text-xs font-medium">{tab.label}</span>

              {tab.badge > 0 && (
                <span className="absolute top-2 right-8 min-w-[20px] h-5
                                 px-1.5 flex items-center justify-center
                                 bg-blue-500 text-white text-xs font-semibold
                                 rounded-full">
                  {tab.badge}
                </span>
              )}

              {isActive && (
                <div className="absolute bottom-0 left-0 right-0 h-0.5
                                bg-blue-500 rounded-t" />
              )}
            </>
          )}
        </NavLink>
      ))}

      {/* Settings Icon */}
      <button className="w-14 flex items-center justify-center
                        text-gray-400 hover:bg-gray-50">
        <Settings size={20} />
      </button>
    </nav>
  );
}
```

---

## 5. ì»´í¬ë„ŒíŠ¸ ì•„í‚¤í…ì²˜

### 5.1 Component Patterns

```typescript
// 1. Atomic Design ê¸°ë°˜
components/
â”œâ”€ atoms/        # ìµœì†Œ ë‹¨ìœ„ (Button, Input, Badge)
â”œâ”€ molecules/    # ì¡°í•© (SearchBar, MeetingCard)
â”œâ”€ organisms/    # ë³µì¡í•œ ì¡°í•© (Navigation, ConfirmModal)
â”œâ”€ templates/    # ë ˆì´ì•„ì›ƒ (MainLayout)
â””â”€ pages/        # í™”ë©´ (NowScreen, TodayScreen)

// 2. Composition Pattern
// í° ì»´í¬ë„ŒíŠ¸ëŠ” ì‘ì€ ì»´í¬ë„ŒíŠ¸ë¡œ ë¶„ë¦¬

// 3. Presentational vs Container
// - Presentational: UIë§Œ ë‹´ë‹¹ (propsë¡œ ë°ì´í„° ë°›ìŒ)
// - Container: ë¡œì§ ë‹´ë‹¹ (store, API í˜¸ì¶œ)
```

### 5.2 í•µì‹¬ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

#### Button Component

```typescript
// src/components/common/Button.tsx
import { forwardRef, ButtonHTMLAttributes } from 'react';
import { Loader2 } from 'lucide-react';
import { cva, type VariantProps } from 'class-variance-authority';

const buttonVariants = cva(
  // Base styles
  `inline-flex items-center justify-center gap-2
   font-semibold rounded-lg transition-all duration-200
   disabled:opacity-60 disabled:cursor-not-allowed
   focus-visible:outline-none focus-visible:ring-2
   focus-visible:ring-offset-2`,
  {
    variants: {
      variant: {
        primary:
          'bg-blue-500 text-white hover:bg-blue-600 active:scale-98',
        secondary:
          'bg-transparent border border-gray-300 text-gray-500 hover:bg-gray-100',
        danger:
          'bg-red-500 text-white hover:bg-red-600 active:scale-98',
      },
      size: {
        sm: 'h-9 px-3 text-sm',
        md: 'h-10 px-4 text-sm',
        lg: 'h-11 px-6 text-base',
      },
    },
    defaultVariants: {
      variant: 'primary',
      size: 'md',
    },
  }
);

export interface ButtonProps
  extends ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  isLoading?: boolean;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
}

export const Button = forwardRef<HTMLButtonElement, ButtonProps>(
  ({
    className,
    variant,
    size,
    isLoading,
    leftIcon,
    rightIcon,
    children,
    disabled,
    ...props
  }, ref) => {
    return (
      <button
        ref={ref}
        className={buttonVariants({ variant, size, className })}
        disabled={disabled || isLoading}
        {...props}
      >
        {isLoading ? (
          <>
            <Loader2 size={16} className="animate-spin" />
            ë¡œë”© ì¤‘...
          </>
        ) : (
          <>
            {leftIcon}
            {children}
            {rightIcon}
          </>
        )}
      </button>
    );
  }
);

Button.displayName = 'Button';
```

#### Alert Card Component (HUD)

```typescript
// src/components/screens/NowScreen/AlertCard.tsx
import { motion } from 'framer-motion';
import { ArrowRight } from 'lucide-react';
import { Alert } from '@/stores/hudStore';
import { Button } from '@/components/common/Button';

interface AlertCardProps {
  alert: Alert;
  onAsk: () => void;
  onDismiss: () => void;
}

export function AlertCard({ alert, onAsk, onDismiss }: AlertCardProps) {
  const borderColors = {
    1: 'border-gray-300',
    2: 'border-amber-500',
    3: 'border-red-500',
  };

  const animations = {
    1: {},
    2: {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      exit: { opacity: 0, y: -20 },
    },
    3: {
      initial: { opacity: 0, scale: 0.95 },
      animate: {
        opacity: 1,
        scale: 1,
        boxShadow: [
          '0 0 0 0 rgba(239, 68, 68, 0)',
          '0 0 0 8px rgba(239, 68, 68, 0)',
        ],
      },
      exit: { opacity: 0, scale: 0.95 },
      transition: {
        boxShadow: {
          duration: 2,
          repeat: Infinity,
        },
      },
    },
  };

  return (
    <motion.div
      {...animations[alert.level]}
      className={`
        w-[375px] bg-white rounded-2xl shadow-lg
        border-2 ${borderColors[alert.level]} p-5
      `}
    >
      {/* Header */}
      <div className="flex items-start gap-3">
        <span className="text-2xl">{alert.icon}</span>
        <div className="flex-1">
          <h3 className="text-lg font-semibold text-gray-900">
            {alert.title}
          </h3>
          <p className="text-sm text-gray-600 mt-1">
            {alert.message}
          </p>
        </div>
      </div>

      {/* Suggested Question */}
      {alert.suggestedQuestion && (
        <div className="mt-4 p-3 bg-blue-50 border border-blue-500 rounded-lg">
          <p className="text-xs text-gray-500 mb-1">ì œì•ˆ ì§ˆë¬¸:</p>
          <p className="text-sm font-semibold text-gray-800">
            "{alert.suggestedQuestion}"
          </p>
        </div>
      )}

      {/* Reason (Level 3 only) */}
      {alert.level === 3 && alert.reason && (
        <div className="mt-4">
          <p className="text-sm font-semibold text-gray-500 mb-2">
            ì™œ ìœ„í—˜?
          </p>
          <div className="p-3 bg-red-50 rounded-lg space-y-1">
            {alert.reason.map((item, idx) => (
              <p key={idx} className="text-sm text-red-900">
                â€¢ {item}
              </p>
            ))}
          </div>
        </div>
      )}

      {/* Actions */}
      <div className="flex gap-2 mt-4">
        <Button
          variant={alert.level === 3 ? 'danger' : 'primary'}
          className="flex-1"
          onClick={onAsk}
          rightIcon={<ArrowRight size={16} />}
        >
          {alert.level === 3 ? 'ì§€ê¸ˆ í™•ì¸' : 'ë¬¼ì–´ë³´ê¸°'}
        </Button>
        <Button
          variant="secondary"
          onClick={onDismiss}
        >
          {alert.level === 3 ? 'ìœ„í—˜ ê°ìˆ˜' : 'ë‚˜ì¤‘ì—'}
        </Button>
      </div>
    </motion.div>
  );
}
```

#### Meeting Card Component

```typescript
// src/components/screens/TodayScreen/MeetingCard.tsx
import { format } from 'date-fns';
import { ko } from 'date-fns/locale';
import { Lightbulb } from 'lucide-react';
import { Button } from '@/components/common/Button';

interface MeetingCardProps {
  meeting: {
    id: string;
    time: Date;
    title: string;
    company: string;
    preparation: {
      uncheckedItems: string[];
      suggestedQuestions: string[];
    };
    estimatedPrepTime: number;
  };
  onPrepare: (meetingId: string) => void;
  onStart: (meetingId: string) => void;
}

export function MeetingCard({
  meeting,
  onPrepare,
  onStart
}: MeetingCardProps) {
  return (
    <div className="bg-white border border-gray-200 rounded-xl p-4
                    shadow-sm hover:shadow-md hover:border-blue-500
                    transition-all duration-200">
      {/* Title */}
      <h3 className="text-base font-semibold text-gray-900 mb-3">
        <span className="text-blue-500 font-medium">
          {format(meeting.time, 'HH:mm', { locale: ko })}
        </span>
        {' '}
        {meeting.company} {meeting.title}
      </h3>

      {/* Preparation Badge */}
      {meeting.preparation.uncheckedItems.length > 0 && (
        <div className="inline-flex items-center gap-1 px-2 py-1
                        bg-blue-100 text-blue-800 text-xs font-medium
                        rounded-md mb-2">
          <Lightbulb size={12} />
          ì¤€ë¹„ í•„ìš”
        </div>
      )}

      {/* Unchecked Items */}
      {meeting.preparation.uncheckedItems.length > 0 && (
        <ul className="space-y-1 mb-3">
          {meeting.preparation.uncheckedItems.map((item, idx) => (
            <li key={idx} className="text-sm text-gray-700 pl-4">
              â€¢ {item}
            </li>
          ))}
        </ul>
      )}

      {/* Meta */}
      <p className="text-xs text-gray-500 mb-3">
        ì˜ˆìƒ ì¤€ë¹„ ì‹œê°„: {meeting.estimatedPrepTime}ë¶„
      </p>

      {/* Actions */}
      <div className="flex gap-2">
        <Button
          size="sm"
          className="flex-1"
          onClick={() => onPrepare(meeting.id)}
        >
          ì¤€ë¹„í•˜ê¸°
        </Button>
        <Button
          size="sm"
          variant="secondary"
          onClick={() => onStart(meeting.id)}
        >
          ë°”ë¡œ ì‹œì‘
        </Button>
      </div>
    </div>
  );
}
```

---

## 6. ë°ì´í„° í˜ì¹­

### 6.1 TanStack Query ì„¤ì •

```typescript
// src/services/api.ts
import axios from 'axios';

export const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL || 'http://localhost:3000/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request Interceptor (ì¸ì¦ í† í° ì¶”ê°€)
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('onno_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Response Interceptor (ì—ëŸ¬ ì²˜ë¦¬)
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
      localStorage.removeItem('onno_token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);
```

### 6.2 API Service Layer

```typescript
// src/services/meetingApi.ts
import { api } from './api';
import { Meeting } from '@/types/meeting';

export const meetingApi = {
  // ë¯¸íŒ… ëª©ë¡ ì¡°íšŒ
  getMeetings: async (params?: {
    from?: Date;
    to?: Date;
    company?: string;
  }) => {
    const { data } = await api.get<Meeting[]>('/meetings', { params });
    return data;
  },

  // ë¯¸íŒ… ìƒì„¸ ì¡°íšŒ
  getMeetingById: async (id: string) => {
    const { data } = await api.get<Meeting>(`/meetings/${id}`);
    return data;
  },

  // ë¯¸íŒ… ìƒì„±
  createMeeting: async (meeting: Omit<Meeting, 'id'>) => {
    const { data } = await api.post<Meeting>('/meetings', meeting);
    return data;
  },

  // ë¯¸íŒ… ì—…ë°ì´íŠ¸
  updateMeeting: async (id: string, updates: Partial<Meeting>) => {
    const { data } = await api.patch<Meeting>(`/meetings/${id}`, updates);
    return data;
  },

  // ë¯¸íŒ… í™•ì •
  confirmMeeting: async (
    id: string,
    confirmation: {
      decisions: Decision[];
      actions: Action[];
      insights: Insight[];
    }
  ) => {
    const { data } = await api.post(`/meetings/${id}/confirm`, confirmation);
    return data;
  },
};
```

### 6.3 Custom Hooks (React Query)

```typescript
// src/hooks/useMeeting.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { meetingApi } from '@/services/meetingApi';
import { useToast } from './useToast';

// ë¯¸íŒ… ëª©ë¡ ì¡°íšŒ
export function useMeetings(params?: {
  from?: Date;
  to?: Date;
  company?: string;
}) {
  return useQuery({
    queryKey: ['meetings', params],
    queryFn: () => meetingApi.getMeetings(params),
    staleTime: 5 * 60 * 1000, // 5ë¶„
  });
}

// ë¯¸íŒ… ìƒì„¸ ì¡°íšŒ
export function useMeeting(id: string) {
  return useQuery({
    queryKey: ['meetings', id],
    queryFn: () => meetingApi.getMeetingById(id),
    enabled: !!id,
  });
}

// ë¯¸íŒ… ìƒì„±
export function useCreateMeeting() {
  const queryClient = useQueryClient();
  const { showToast } = useToast();

  return useMutation({
    mutationFn: meetingApi.createMeeting,
    onSuccess: (newMeeting) => {
      // ìºì‹œ ë¬´íš¨í™”
      queryClient.invalidateQueries({ queryKey: ['meetings'] });

      // Optimistic Update
      queryClient.setQueryData(['meetings', newMeeting.id], newMeeting);

      showToast({
        type: 'success',
        message: 'ë¯¸íŒ…ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤',
      });
    },
    onError: (error) => {
      showToast({
        type: 'error',
        message: 'ë¯¸íŒ… ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤',
      });
    },
  });
}

// ë¯¸íŒ… í™•ì •
export function useConfirmMeeting() {
  const queryClient = useQueryClient();
  const { showToast } = useToast();

  return useMutation({
    mutationFn: ({
      id,
      confirmation
    }: {
      id: string;
      confirmation: any
    }) => {
      return meetingApi.confirmMeeting(id, confirmation);
    },
    onSuccess: (_, variables) => {
      queryClient.invalidateQueries({
        queryKey: ['meetings', variables.id]
      });

      showToast({
        type: 'success',
        message: 'í™•ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤',
      });
    },
  });
}
```

---

## 7. ì‹¤ì‹œê°„ í†µì‹ 

### 7.1 WebSocket ì„¤ì •

```typescript
// src/services/websocket.ts
import { io, Socket } from 'socket.io-client';

class WebSocketService {
  private socket: Socket | null = null;
  private reconnectAttempts = 0;
  private maxReconnectAttempts = 5;

  connect(userId: string) {
    if (this.socket?.connected) return;

    this.socket = io(import.meta.env.VITE_WS_URL || 'ws://localhost:3000', {
      auth: {
        token: localStorage.getItem('onno_token'),
      },
      reconnection: true,
      reconnectionDelay: 1000,
      reconnectionDelayMax: 5000,
    });

    this.setupEventHandlers();
  }

  private setupEventHandlers() {
    if (!this.socket) return;

    this.socket.on('connect', () => {
      console.log('WebSocket connected');
      this.reconnectAttempts = 0;
    });

    this.socket.on('disconnect', (reason) => {
      console.log('WebSocket disconnected:', reason);
    });

    this.socket.on('connect_error', (error) => {
      console.error('WebSocket error:', error);
      this.reconnectAttempts++;

      if (this.reconnectAttempts >= this.maxReconnectAttempts) {
        this.socket?.disconnect();
      }
    });
  }

  // íŠ¸ëœìŠ¤í¬ë¦½íŠ¸ ì‹¤ì‹œê°„ ìˆ˜ì‹ 
  onTranscript(callback: (data: TranscriptItem) => void) {
    this.socket?.on('transcript', callback);
  }

  // ì¸ì‚¬ì´íŠ¸ ì‹¤ì‹œê°„ ìˆ˜ì‹ 
  onInsight(callback: (data: Insight) => void) {
    this.socket?.on('insight', callback);
  }

  // ê°­ ê°ì§€ ì•Œë¦¼ ìˆ˜ì‹ 
  onAlert(callback: (data: Alert) => void) {
    this.socket?.on('alert', callback);
  }

  // ë¯¸íŒ… ì‹œì‘ ì „ì†¡
  emitMeetingStart(meetingId: string) {
    this.socket?.emit('meeting:start', { meetingId });
  }

  // ë¯¸íŒ… ì¢…ë£Œ ì „ì†¡
  emitMeetingEnd(meetingId: string) {
    this.socket?.emit('meeting:end', { meetingId });
  }

  // ì—°ê²° í•´ì œ
  disconnect() {
    this.socket?.disconnect();
    this.socket = null;
  }
}

export const wsService = new WebSocketService();
```

### 7.2 ì‹¤ì‹œê°„ ë°ì´í„° Hook

```typescript
// src/hooks/useRealtime.ts
import { useEffect } from 'react';
import { wsService } from '@/services/websocket';
import { useMeetingStore } from '@/stores/meetingStore';
import { useHUDStore } from '@/stores/hudStore';

export function useRealtime(meetingId: string | null) {
  const updateTranscript = useMeetingStore((s) => s.updateTranscript);
  const addInsight = useMeetingStore((s) => s.addInsight);
  const showAlert = useHUDStore((s) => s.showAlert);

  useEffect(() => {
    if (!meetingId) return;

    // WebSocket ì—°ê²°
    wsService.connect(meetingId);

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    wsService.onTranscript((transcript) => {
      updateTranscript(transcript);
    });

    wsService.onInsight((insight) => {
      addInsight(insight);
    });

    wsService.onAlert((alert) => {
      showAlert(alert);
    });

    // Cleanup
    return () => {
      wsService.disconnect();
    };
  }, [meetingId, updateTranscript, addInsight, showAlert]);
}
```

---

## 8. ë¸Œë¼ìš°ì € í™•ì¥ êµ¬í˜„

### 8.1 Background Service Worker

```typescript
// src/background/index.ts
import { detectMeetingStart } from './meetingDetector';

// í™•ì¥ ì„¤ì¹˜ ì‹œ
chrome.runtime.onInstalled.addListener(() => {
  console.log('Onno Extension Installed');

  // Side Panel í™œì„±í™”
  chrome.sidePanel.setPanelBehavior({ openPanelOnActionClick: true });
});

// íƒ­ ì—…ë°ì´íŠ¸ ê°ì§€ (Zoom/Meet ì ‘ì†)
chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {
  if (changeInfo.status === 'complete' && tab.url) {
    const isMeetingUrl =
      tab.url.includes('zoom.us') ||
      tab.url.includes('meet.google.com');

    if (isMeetingUrl) {
      detectMeetingStart(tabId, tab.url);
    }
  }
});

// Content Scriptì—ì„œ ë©”ì‹œì§€ ìˆ˜ì‹ 
chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
  if (message.type === 'MEETING_STARTED') {
    // Side Panel ìë™ ì—´ê¸°
    chrome.sidePanel.open({ tabId: sender.tab?.id });

    // HUD ì°½ ì—´ê¸°
    chrome.windows.create({
      url: 'src/hud/hud.html',
      type: 'popup',
      width: 300,
      height: 60,
      top: 20,
      left: window.screen.width - 320,
    });
  }

  if (message.type === 'MEETING_ENDED') {
    // Side Panelì˜ Today í™”ë©´ìœ¼ë¡œ ì „í™˜
    chrome.tabs.sendMessage(sender.tab?.id!, {
      type: 'NAVIGATE_TO_TODAY',
    });
  }

  return true;
});
```

### 8.2 Content Script

```typescript
// src/content/zoom/zoomIntegration.ts
class ZoomIntegration {
  private observer: MutationObserver | null = null;

  init() {
    this.detectMeetingStart();
    this.observeMeetingState();
  }

  private detectMeetingStart() {
    // Zoom ë¯¸íŒ… ì‹œì‘ ê°ì§€
    const isInMeeting = document.querySelector('[aria-label="In Meeting"]');

    if (isInMeeting) {
      this.onMeetingStart();
    }
  }

  private observeMeetingState() {
    // DOM ë³€í™” ê°ì§€ (ë¯¸íŒ… ì‹œì‘/ì¢…ë£Œ)
    this.observer = new MutationObserver((mutations) => {
      for (const mutation of mutations) {
        if (mutation.addedNodes.length > 0) {
          const isInMeeting = document.querySelector('[aria-label="In Meeting"]');
          if (isInMeeting) {
            this.onMeetingStart();
          }
        }

        if (mutation.removedNodes.length > 0) {
          const meetingEnded = document.querySelector('.meeting-ended');
          if (meetingEnded) {
            this.onMeetingEnd();
          }
        }
      }
    });

    this.observer.observe(document.body, {
      childList: true,
      subtree: true,
    });
  }

  private onMeetingStart() {
    // Backgroundì— ì•Œë¦¼
    chrome.runtime.sendMessage({
      type: 'MEETING_STARTED',
      data: {
        platform: 'zoom',
        url: window.location.href,
        timestamp: Date.now(),
      },
    });
  }

  private onMeetingEnd() {
    chrome.runtime.sendMessage({
      type: 'MEETING_ENDED',
      data: {
        platform: 'zoom',
        timestamp: Date.now(),
      },
    });
  }

  destroy() {
    this.observer?.disconnect();
  }
}

// ì´ˆê¸°í™”
const zoomIntegration = new ZoomIntegration();
zoomIntegration.init();
```

---

## 9. HUD êµ¬í˜„

### 9.1 HUD Window

```typescript
// src/hud/HUD.tsx
import { useEffect } from 'react';
import { AnimatePresence } from 'framer-motion';
import { useHUDStore } from '@/stores/hudStore';
import { HUDIdle } from './HUDIdle';
import { HUDAlert } from './HUDAlert';

export function HUD() {
  const state = useHUDStore((s) => s.state);
  const currentAlert = useHUDStore((s) => s.currentAlert);
  const dismissAlert = useHUDStore((s) => s.dismissAlert);
  const askQuestion = useHUDStore((s) => s.askQuestion);

  // ì°½ í•­ìƒ ìœ„ì— í‘œì‹œ (Electron í•„ìš”)
  useEffect(() => {
    // Chromiumì€ í•­ìƒ ìœ„ ê¸°ëŠ¥ ì œí•œì 
    // í–¥í›„ Electronìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œ êµ¬í˜„
  }, []);

  return (
    <div className="fixed top-5 right-5 z-[9999]">
      <AnimatePresence mode="wait">
        {state === 'idle' ? (
          <HUDIdle key="idle" />
        ) : currentAlert ? (
          <HUDAlert
            key="alert"
            alert={currentAlert}
            onAsk={() => askQuestion(currentAlert.id)}
            onDismiss={dismissAlert}
          />
        ) : null}
      </AnimatePresence>
    </div>
  );
}
```

### 9.2 HUD Idle State

```typescript
// src/hud/HUDIdle.tsx
import { motion } from 'framer-motion';
import { useHUDStore } from '@/stores/hudStore';
import { useMeetingStore } from '@/stores/meetingStore';
import { formatDuration } from '@/utils/date';

export function HUDIdle() {
  const alertCount = useHUDStore((s) => s.getAlertCount());
  const meeting = useMeetingStore((s) => s.currentMeeting);

  const elapsed = meeting
    ? Date.now() - meeting.startTime.getTime()
    : 0;

  return (
    <motion.div
      initial={{ opacity: 0, scale: 0.9 }}
      animate={{ opacity: 1, scale: 1 }}
      exit={{ opacity: 0, scale: 0.9 }}
      className="w-[300px] h-[60px] bg-white/95 backdrop-blur-sm
                 border border-gray-200 rounded-2xl shadow-md
                 flex items-center gap-3 px-4 cursor-pointer
                 hover:bg-white hover:shadow-lg transition-all"
    >
      {/* Status Indicator */}
      <div className="relative">
        <div className="w-3 h-3 bg-green-500 rounded-full" />
        <div className="absolute inset-0 w-3 h-3 bg-green-500 rounded-full
                        animate-ping opacity-75" />
      </div>

      {/* Time */}
      <span className="text-base font-medium text-gray-700">
        {formatDuration(elapsed)}
      </span>

      {/* Badge */}
      {alertCount > 0 && (
        <span className="ml-auto min-w-[24px] h-6 px-2 flex items-center
                         justify-center bg-blue-500 text-white text-xs
                         font-semibold rounded-full">
          {alertCount}
        </span>
      )}
    </motion.div>
  );
}
```

---

## 10. ì„±ëŠ¥ ìµœì í™”

### 10.1 Code Splitting

```typescript
// src/sidepanel/router.tsx
import { lazy, Suspense } from 'react';
import { Loader2 } from 'lucide-react';

// Lazy load screens
const NowScreen = lazy(() => import('@/components/screens/NowScreen'));
const TodayScreen = lazy(() => import('@/components/screens/TodayScreen'));
const SearchScreen = lazy(() => import('@/components/screens/SearchScreen'));

// Loading fallback
function LoadingScreen() {
  return (
    <div className="flex items-center justify-center h-screen">
      <Loader2 size={32} className="animate-spin text-blue-500" />
    </div>
  );
}

export const router = createBrowserRouter([
  {
    path: '/',
    element: <MainLayout />,
    children: [
      {
        path: 'now',
        element: (
          <Suspense fallback={<LoadingScreen />}>
            <NowScreen />
          </Suspense>
        ),
      },
      // ... ë‚˜ë¨¸ì§€ ë¼ìš°íŠ¸
    ],
  },
]);
```

### 10.2 React.memo & useMemo

```typescript
// ë¦¬ë Œë”ë§ ë°©ì§€
import { memo } from 'react';

export const MeetingCard = memo(function MeetingCard({ meeting, ...props }) {
  // ...
}, (prevProps, nextProps) => {
  // Custom comparison
  return prevProps.meeting.id === nextProps.meeting.id;
});

// ë¹„ì‹¼ ê³„ì‚° ìºì‹±
import { useMemo } from 'react';

function SearchResults({ results }) {
  const sortedResults = useMemo(() => {
    return results.sort((a, b) => b.relevance - a.relevance);
  }, [results]);

  // ...
}
```

### 10.3 Virtualization (ê¸´ ë¦¬ìŠ¤íŠ¸)

```typescript
// src/components/screens/TodayScreen/index.tsx
import { useVirtualizer } from '@tanstack/react-virtual';
import { useRef } from 'react';

export function TodayScreen() {
  const parentRef = useRef<HTMLDivElement>(null);
  const { data: tasks } = useTasks();

  const virtualizer = useVirtualizer({
    count: tasks?.length ?? 0,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 120, // ì¹´ë“œ ë†’ì´
    overscan: 5, // ë¯¸ë¦¬ ë Œë”ë§í•  ì•„ì´í…œ ìˆ˜
  });

  return (
    <div ref={parentRef} className="h-screen overflow-auto">
      <div
        style={{
          height: `${virtualizer.getTotalSize()}px`,
          position: 'relative',
        }}
      >
        {virtualizer.getVirtualItems().map((virtualItem) => (
          <div
            key={virtualItem.key}
            style={{
              position: 'absolute',
              top: 0,
              left: 0,
              width: '100%',
              transform: `translateY(${virtualItem.start}px)`,
            }}
          >
            <MeetingCard meeting={tasks[virtualItem.index]} />
          </div>
        ))}
      </div>
    </div>
  );
}
```

---

## 11. í…ŒìŠ¤íŠ¸ ì „ëµ

### 11.1 Unit Tests (Vitest)

```typescript
// tests/unit/stores/hudStore.test.ts
import { describe, it, expect, beforeEach } from 'vitest';
import { useHUDStore } from '@/stores/hudStore';

describe('HUDStore', () => {
  beforeEach(() => {
    // ìŠ¤í† ì–´ ë¦¬ì…‹
    useHUDStore.setState({
      state: 'idle',
      currentAlert: null,
      alertQueue: [],
      infoAlerts: [],
    });
  });

  it('should show Level 2 alert immediately', () => {
    const { showAlert, state, currentAlert } = useHUDStore.getState();

    showAlert({
      level: 2,
      icon: 'âš ï¸',
      title: 'í…ŒìŠ¤íŠ¸',
      message: 'í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€',
    });

    expect(useHUDStore.getState().state).toBe('alert');
    expect(useHUDStore.getState().currentAlert?.level).toBe(2);
  });

  it('should add Level 1 alert to info queue only', () => {
    const { showAlert } = useHUDStore.getState();

    showAlert({
      level: 1,
      icon: 'ğŸ’¡',
      title: 'ì •ë³´',
      message: 'ì°¸ê³  ì‚¬í•­',
    });

    expect(useHUDStore.getState().state).toBe('idle');
    expect(useHUDStore.getState().infoAlerts).toHaveLength(1);
  });
});
```

### 11.2 Component Tests

```typescript
// tests/unit/components/Button.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { describe, it, expect, vi } from 'vitest';
import { Button } from '@/components/common/Button';

describe('Button', () => {
  it('renders children correctly', () => {
    render(<Button>Click me</Button>);
    expect(screen.getByText('Click me')).toBeInTheDocument();
  });

  it('calls onClick when clicked', () => {
    const onClick = vi.fn();
    render(<Button onClick={onClick}>Click</Button>);

    fireEvent.click(screen.getByText('Click'));
    expect(onClick).toHaveBeenCalledTimes(1);
  });

  it('shows loading state', () => {
    render(<Button isLoading>Submit</Button>);
    expect(screen.getByText('ë¡œë”© ì¤‘...')).toBeInTheDocument();
  });

  it('is disabled when isLoading', () => {
    render(<Button isLoading>Submit</Button>);
    expect(screen.getByRole('button')).toBeDisabled();
  });
});
```

### 11.3 E2E Tests (Playwright)

```typescript
// tests/e2e/meeting-flow.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Meeting Flow', () => {
  test('complete meeting lifecycle', async ({ page }) => {
    // 1. Side Panel ì—´ê¸°
    await page.goto('chrome-extension://[ID]/src/sidepanel/index.html');

    // 2. Today í™”ë©´ í™•ì¸
    await expect(page.locator('h1')).toContainText('ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”');

    // 3. ë¯¸íŒ… ì¹´ë“œì—ì„œ [ì¤€ë¹„í•˜ê¸°] í´ë¦­
    await page.click('text=ì¤€ë¹„í•˜ê¸°');

    // 4. ì¤€ë¹„ ëª¨ë‹¬ í™•ì¸
    await expect(page.locator('text=ë¯¸íŒ… ì¤€ë¹„')).toBeVisible();

    // 5. [ì¤€ë¹„ ì™„ë£Œ] í´ë¦­
    await page.click('text=ì¤€ë¹„ ì™„ë£Œ');

    // 6. Now í™”ë©´ìœ¼ë¡œ ì´ë™
    await page.click('text=ì§€ê¸ˆ');

    // 7. HUD Idle ìƒíƒœ í™•ì¸
    await expect(page.locator('.hud-idle')).toBeVisible();
  });
});
```

---

## 12. ë¹Œë“œ ë° ë°°í¬

### 12.1 Vite ì„¤ì •

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { crx } from '@crxjs/vite-plugin';
import manifest from './public/manifest.json';
import path from 'path';

export default defineConfig({
  plugins: [
    react(),
    crx({ manifest }),
  ],

  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },

  build: {
    rollupOptions: {
      input: {
        sidepanel: 'src/sidepanel/index.html',
        hud: 'src/hud/hud.html',
      },
    },
  },
});
```

### 12.2 í™˜ê²½ ë³€ìˆ˜

```bash
# .env.development
VITE_API_URL=http://localhost:3000/api
VITE_WS_URL=ws://localhost:3000

# .env.production
VITE_API_URL=https://api.onno.ai/api
VITE_WS_URL=wss://api.onno.ai
```

### 12.3 ë¹Œë“œ ëª…ë ¹ì–´

```json
// package.json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "build:dev": "vite build --mode development",
    "build:prod": "vite build --mode production",
    "preview": "vite preview",
    "test": "vitest",
    "test:e2e": "playwright test",
    "lint": "eslint . --ext ts,tsx",
    "format": "prettier --write \"src/**/*.{ts,tsx}\""
  }
}
```

### 12.4 Chrome Web Store ë°°í¬

```bash
# 1. í”„ë¡œë•ì…˜ ë¹Œë“œ
npm run build:prod

# 2. dist í´ë” ì••ì¶•
cd dist
zip -r ../onno-extension-v1.0.0.zip .

# 3. Chrome Web Storeì— ì—…ë¡œë“œ
# https://chrome.google.com/webstore/devconsole
```

---

## 13. Notion í†µí•© êµ¬í˜„ (Part 1.4)

### 13.1 Notion Store

```typescript
// src/stores/notionStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

export interface NotionConnection {
  isConnected: boolean;
  workspaceId?: string;
  workspaceName?: string;
  accessToken?: string;
  connectedAt?: number;
}

interface NotionStore {
  // State
  connection: NotionConnection;
  isConnecting: boolean;
  isSaving: boolean;
  error: string | null;

  // Actions
  setConnection: (connection: NotionConnection) => void;
  setConnecting: (isConnecting: boolean) => void;
  setSaving: (isSaving: boolean) => void;
  setError: (error: string | null) => void;
  disconnect: () => void;
  clearError: () => void;
}

export const useNotionStore = create<NotionStore>()(
  persist(
    (set) => ({
      // Initial State
      connection: {
        isConnected: false,
      },
      isConnecting: false,
      isSaving: false,
      error: null,

      // Actions
      setConnection: (connection) => set({ connection, error: null }),
      setConnecting: (isConnecting) => set({ isConnecting }),
      setSaving: (isSaving) => set({ isSaving }),
      setError: (error) => set({ error }),
      disconnect: () =>
        set({
          connection: { isConnected: false },
          error: null,
        }),
      clearError: () => set({ error: null }),
    }),
    {
      name: 'onno-notion',
      partialize: (state) => ({
        connection: state.connection,
      }),
    }
  )
);
```

### 13.2 Notion Integration Component

```typescript
// src/components/onboarding/NotionIntegration.tsx
import { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Check, Link, Loader2, AlertCircle, ExternalLink } from 'lucide-react';
import { useNotionStore } from '@/stores/notionStore';
import { useAnalytics } from '@/hooks/useAnalytics';
import { notionApi } from '@/services/notionApi';

interface NotionIntegrationProps {
  defaultChecked?: boolean;
  onChange?: (checked: boolean) => void;
  onSaveComplete?: (pageUrl: string) => void;
}

export function NotionIntegration({
  defaultChecked = true,
  onChange,
  onSaveComplete,
}: NotionIntegrationProps) {
  const [checked, setChecked] = useState(defaultChecked);
  const {
    connection,
    isConnecting,
    isSaving,
    error,
    setConnection,
    setConnecting,
    setSaving,
    setError,
    clearError,
  } = useNotionStore();

  const {
    trackNotionCheckboxShown,
    trackNotionCheckboxChecked,
    trackNotionConnectClicked,
    trackNotionOAuthCompleted,
    trackNotionOAuthDenied,
    trackNotionSaveCompleted,
    trackNotionSaveFailed,
  } = useAnalytics();

  // ì²´í¬ë°•ìŠ¤ í‘œì‹œ ì‹œ ì´ë²¤íŠ¸ íŠ¸ë˜í‚¹
  useEffect(() => {
    trackNotionCheckboxShown();
  }, []);

  // ì²´í¬ë°•ìŠ¤ ë³€ê²½ í•¸ë“¤ëŸ¬
  const handleCheckChange = (newChecked: boolean) => {
    setChecked(newChecked);
    onChange?.(newChecked);

    if (newChecked) {
      trackNotionCheckboxChecked();
    }
  };

  // OAuth ì—°ê²° ì‹œì‘
  const handleConnect = async () => {
    trackNotionConnectClicked();
    setConnecting(true);
    clearError();

    try {
      // OAuth íŒì—… ì—´ê¸°
      const result = await notionApi.startOAuth();

      if (result.success) {
        trackNotionOAuthCompleted();
        setConnection({
          isConnected: true,
          workspaceId: result.workspaceId,
          workspaceName: result.workspaceName,
          accessToken: result.accessToken,
          connectedAt: Date.now(),
        });
      } else {
        trackNotionOAuthDenied();
        setChecked(false);
        onChange?.(false);
      }
    } catch (err) {
      setError('ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setConnecting(false);
    }
  };

  // Notionì— ì €ì¥
  const saveToNotion = async (meetingData: MeetingData) => {
    if (!connection.isConnected || !checked) return null;

    setSaving(true);
    clearError();

    try {
      const result = await notionApi.saveMeeting(meetingData);
      trackNotionSaveCompleted();
      onSaveComplete?.(result.pageUrl);
      return result;
    } catch (err) {
      trackNotionSaveFailed();
      setError('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      return null;
    } finally {
      setSaving(false);
    }
  };

  return (
    <div className="border-t border-gray-200 pt-5 mt-5">
      {/* Section Title */}
      <h4 className="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-3">
        ğŸ’¾ ì €ì¥ ì˜µì…˜
      </h4>

      {/* Notion Option Container */}
      <div
        className={`
          p-4 rounded-xl transition-all duration-200
          ${checked
            ? 'bg-blue-50 border-2 border-blue-500'
            : 'bg-gray-50 border border-gray-200'
          }
        `}
      >
        {/* Checkbox Row */}
        <label className="flex items-center gap-3 cursor-pointer mb-3">
          <input
            type="checkbox"
            checked={checked}
            onChange={(e) => handleCheckChange(e.target.checked)}
            className="w-5 h-5 rounded border-gray-300 text-blue-500
                       focus:ring-blue-500 cursor-pointer"
          />
          <span className="text-base font-semibold text-gray-900">
            Notionì— ì €ì¥í•˜ê¸°
          </span>
        </label>

        {/* Conditional Content */}
        <AnimatePresence mode="wait">
          {checked && (
            <motion.div
              initial={{ opacity: 0, height: 0 }}
              animate={{ opacity: 1, height: 'auto' }}
              exit={{ opacity: 0, height: 0 }}
              className="pl-8"
            >
              {/* Not Connected State */}
              {!connection.isConnected && !isConnecting && (
                <div className="space-y-2">
                  <button
                    onClick={handleConnect}
                    disabled={isConnecting}
                    className="w-full h-11 flex items-center justify-center gap-2
                               bg-blue-500 text-white rounded-lg font-semibold
                               hover:bg-blue-600 transition-colors"
                  >
                    <Link size={20} />
                    Notion ì—°ê²°í•˜ê¸°
                  </button>
                  <p className="text-sm text-gray-500 text-center">
                    30ì´ˆë©´ ì—°ê²° ì™„ë£Œ!
                  </p>
                </div>
              )}

              {/* Connecting State */}
              {isConnecting && (
                <div className="flex flex-col items-center gap-3 py-4">
                  <Loader2 size={32} className="animate-spin text-blue-500" />
                  <p className="text-sm text-gray-700">Notion ì—°ê²° ì¤‘...</p>
                </div>
              )}

              {/* Connected State */}
              {connection.isConnected && !isConnecting && (
                <div className="space-y-2">
                  <div className="flex items-center gap-2">
                    <Check size={20} className="text-green-500" />
                    <span className="text-sm font-semibold text-green-600">
                      Notion ì—°ê²°ë¨
                    </span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-sm text-gray-700 bg-gray-100 px-2 py-1 rounded">
                      {connection.workspaceName}
                    </span>
                  </div>
                  <p className="text-xs text-gray-500">
                    ì €ì¥ ìœ„ì¹˜: Onno íšŒì˜ë¡ (ìë™ ìƒì„±)
                  </p>
                  <button
                    onClick={() => useNotionStore.getState().disconnect()}
                    className="text-xs text-gray-400 hover:text-gray-600
                               hover:underline cursor-pointer"
                  >
                    ì—°ê²° í•´ì œ
                  </button>
                </div>
              )}

              {/* Error State */}
              {error && (
                <motion.div
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  className="mt-3 p-3 bg-red-50 border border-red-500
                             rounded-lg flex items-center gap-3"
                >
                  <AlertCircle size={20} className="text-red-500" />
                  <span className="text-sm text-red-800 flex-1">{error}</span>
                  <button
                    onClick={handleConnect}
                    className="text-sm font-semibold text-red-500
                               border border-red-500 px-3 py-1 rounded
                               hover:bg-red-50"
                  >
                    ë‹¤ì‹œ ì‹œë„
                  </button>
                </motion.div>
              )}
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    </div>
  );
}
```

### 13.3 Notion API Service

```typescript
// src/services/notionApi.ts
import { api } from './api';

interface OAuthResult {
  success: boolean;
  workspaceId?: string;
  workspaceName?: string;
  accessToken?: string;
  error?: string;
}

interface SaveMeetingResult {
  success: boolean;
  pageId: string;
  pageUrl: string;
}

export const notionApi = {
  // OAuth íŒì—… ì‹œì‘
  startOAuth: async (): Promise<OAuthResult> => {
    return new Promise((resolve, reject) => {
      // OAuth íŒì—… URL
      const authUrl = `${import.meta.env.VITE_API_URL}/auth/notion`;
      const popup = window.open(
        authUrl,
        'Notion OAuth',
        'width=600,height=700,left=200,top=100'
      );

      // íŒì—…ì—ì„œ ë©”ì‹œì§€ ìˆ˜ì‹ 
      const handleMessage = (event: MessageEvent) => {
        if (event.origin !== import.meta.env.VITE_API_URL) return;

        if (event.data.type === 'NOTION_AUTH_SUCCESS') {
          window.removeEventListener('message', handleMessage);
          popup?.close();
          resolve({
            success: true,
            ...event.data.payload,
          });
        }

        if (event.data.type === 'NOTION_AUTH_DENIED') {
          window.removeEventListener('message', handleMessage);
          popup?.close();
          resolve({ success: false });
        }

        if (event.data.type === 'NOTION_AUTH_ERROR') {
          window.removeEventListener('message', handleMessage);
          popup?.close();
          reject(new Error(event.data.error));
        }
      };

      window.addEventListener('message', handleMessage);

      // íŒì—… ë‹«í˜ ê°ì§€
      const checkPopup = setInterval(() => {
        if (popup?.closed) {
          clearInterval(checkPopup);
          window.removeEventListener('message', handleMessage);
          resolve({ success: false });
        }
      }, 500);
    });
  },

  // ë¯¸íŒ… ë°ì´í„°ë¥¼ Notionì— ì €ì¥
  saveMeeting: async (meetingData: MeetingData): Promise<SaveMeetingResult> => {
    const { data } = await api.post('/integrations/notion/save', meetingData);
    return data;
  },

  // ì—°ê²° ìƒíƒœ í™•ì¸
  checkConnection: async (): Promise<boolean> => {
    try {
      const { data } = await api.get('/integrations/notion/status');
      return data.isConnected;
    } catch {
      return false;
    }
  },

  // ì—°ê²° í•´ì œ
  disconnect: async (): Promise<void> => {
    await api.delete('/integrations/notion/disconnect');
  },
};
```

### 13.4 ConfirmModalì— Notion í†µí•© ì¶”ê°€

```typescript
// src/components/screens/TodayScreen/ConfirmModal.tsx
import { useState } from 'react';
import { motion } from 'framer-motion';
import { ArrowRight, Check, ExternalLink } from 'lucide-react';
import { Button } from '@/components/common/Button';
import { NotionIntegration } from '@/components/onboarding/NotionIntegration';
import { useNotionStore } from '@/stores/notionStore';
import { useConfirmMeeting } from '@/hooks/useMeeting';
import { useAnalytics } from '@/hooks/useAnalytics';

interface ConfirmModalProps {
  meeting: Meeting;
  onClose: () => void;
  onComplete: () => void;
}

export function ConfirmModal({ meeting, onClose, onComplete }: ConfirmModalProps) {
  const [notionEnabled, setNotionEnabled] = useState(true);
  const [savedPageUrl, setSavedPageUrl] = useState<string | null>(null);
  const { connection } = useNotionStore();
  const { mutateAsync: confirmMeeting, isPending } = useConfirmMeeting();
  const { trackEvent } = useAnalytics();

  const handleConfirm = async () => {
    try {
      // 1. ë¯¸íŒ… í™•ì •
      await confirmMeeting({
        id: meeting.id,
        confirmation: {
          decisions: meeting.decisions,
          actions: meeting.actions,
          insights: meeting.insights,
        },
      });

      // 2. Notion ì €ì¥ (í™œì„±í™”ëœ ê²½ìš°)
      if (notionEnabled && connection.isConnected) {
        // NotionIntegration ì»´í¬ë„ŒíŠ¸ì—ì„œ ìë™ ì²˜ë¦¬ë¨
      }

      trackEvent('confirmation_completed', {
        notionEnabled,
        notionConnected: connection.isConnected,
      });

      onComplete();
    } catch (error) {
      // ì—ëŸ¬ ì²˜ë¦¬
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <motion.div
        initial={{ opacity: 0, scale: 0.95 }}
        animate={{ opacity: 1, scale: 1 }}
        className="w-[480px] max-h-[80vh] bg-white rounded-2xl shadow-xl overflow-auto"
      >
        {/* Header */}
        <div className="sticky top-0 bg-gray-50 px-5 py-4 border-b">
          <h2 className="text-xl font-bold text-gray-900 flex items-center gap-2">
            ğŸ“ ë°©ê¸ˆ íšŒì˜ ì •ë¦¬
            <span className="text-sm font-semibold text-amber-800 bg-amber-100
                           px-2 py-1 rounded">
              5ë¶„
            </span>
          </h2>
        </div>

        {/* Body */}
        <div className="p-5 space-y-6">
          {/* ê²°ì • ì‚¬í•­ */}
          <section>
            <h3 className="text-sm font-semibold text-gray-500 mb-3">
              âœ… ê²°ì • ì‚¬í•­ ({meeting.decisions.length})
            </h3>
            {meeting.decisions.map((decision, idx) => (
              <div key={idx} className="p-3 bg-gray-50 rounded-lg mb-2">
                <p className="font-medium">{decision.content}</p>
              </div>
            ))}
          </section>

          {/* ì¸ì‚¬ì´íŠ¸ */}
          <section>
            <h3 className="text-sm font-semibold text-gray-500 mb-3">
              ğŸ“‹ ì¸ì‚¬ì´íŠ¸ ({meeting.insights.length}ê°œ ì¶”ì¶œë¨)
            </h3>
            {/* ... ì¸ì‚¬ì´íŠ¸ ëª©ë¡ ... */}
          </section>

          {/* Notion í†µí•© (Part 1.4) */}
          <NotionIntegration
            defaultChecked={true}
            onChange={setNotionEnabled}
            onSaveComplete={setSavedPageUrl}
          />
        </div>

        {/* Footer */}
        <div className="sticky bottom-0 bg-white px-5 py-4 border-t">
          {/* ì €ì¥ ì™„ë£Œ ë©”ì‹œì§€ */}
          {savedPageUrl && (
            <div className="mb-3 p-3 bg-green-50 border border-green-500
                           rounded-lg flex items-center gap-3">
              <Check size={20} className="text-green-500" />
              <span className="text-sm text-green-800">Notionì— ì €ì¥ëì–´ìš”!</span>
              <a
                href={savedPageUrl}
                target="_blank"
                rel="noopener noreferrer"
                className="ml-auto text-sm font-semibold text-blue-500
                           flex items-center gap-1 hover:underline"
              >
                Notionì—ì„œ ë³´ê¸°
                <ExternalLink size={14} />
              </a>
            </div>
          )}

          <Button
            onClick={handleConfirm}
            isLoading={isPending}
            rightIcon={<ArrowRight size={20} />}
            className="w-full h-11"
          >
            í™•ì •í•˜ê³  ì €ì¥í•˜ê¸°
          </Button>
        </div>
      </motion.div>
    </div>
  );
}
```

---

## 14. ë¯¸íŒ… ì¤€ë¹„ ëª¨ë‹¬ êµ¬í˜„ (Part 1.5)

### 14.1 PreparationModal ì»´í¬ë„ŒíŠ¸

```typescript
// src/components/onboarding/PreparationModal.tsx
import { useState, useEffect, useCallback } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { X, ChevronDown, ChevronUp, Plus, Clock, AlertTriangle, FileText } from 'lucide-react';
import { useMeetingPrep } from '@/hooks/useMeetingPrep';
import { track } from '@/services/analytics';

interface PreparationModalProps {
  meetingId: string;
  companyName: string;
  meetingTime: string;
  meetingNumber: number;
  isOpen: boolean;
  onClose: () => void;
  onComplete: () => void;
  onSkip: () => void;
}

interface PastMeeting {
  id: string;
  date: string;
  summary: string[];
}

interface UnconfirmedItem {
  id: string;
  label: string;
  description?: string;
  isChecked: boolean;
}

interface SuggestedQuestion {
  id: string;
  text: string;
  isChecked: boolean;
  isAI: boolean;
}

export function PreparationModal({
  meetingId,
  companyName,
  meetingTime,
  meetingNumber,
  isOpen,
  onClose,
  onComplete,
  onSkip,
}: PreparationModalProps) {
  const {
    pastMeetings,
    unconfirmedItems,
    suggestedQuestions,
    isLoading,
    error,
    isQuickMode,
    minutesUntilMeeting,
    toggleUnconfirmed,
    toggleQuestion,
    addUserQuestion,
    refetch,
  } = useMeetingPrep(meetingId);

  const [isPastExpanded, setIsPastExpanded] = useState(false);
  const [newQuestion, setNewQuestion] = useState('');
  const [prepStartTime] = useState(Date.now());

  // ëª¨ë‹¬ ì—´ë¦´ ë•Œ ì´ë²¤íŠ¸ ë¡œê¹…
  useEffect(() => {
    if (isOpen) {
      track('prep_modal_opened', {
        meetingId,
        companyName,
        meetingNumber,
        pastMeetingCount: pastMeetings.length,
        unconfirmedCount: unconfirmedItems.length,
        suggestedQuestionCount: suggestedQuestions.length,
        isQuickMode,
      });
    }
  }, [isOpen, meetingId]);

  // ì§€ë‚œ ë¯¸íŒ… ì„¹ì…˜ í¼ì¹˜ê¸°
  const handlePastExpand = () => {
    setIsPastExpanded(!isPastExpanded);
    if (!isPastExpanded) {
      track('prep_past_expanded', { meetingId });
    }
  };

  // ë¯¸í™•ì¸ í•­ëª© ì²´í¬
  const handleUnconfirmedToggle = (itemId: string) => {
    toggleUnconfirmed(itemId);
    track('prep_unconfirmed_viewed', { meetingId, itemId });
  };

  // AI ì§ˆë¬¸ ì²´í¬ í† ê¸€
  const handleQuestionToggle = (questionId: string, isChecked: boolean) => {
    toggleQuestion(questionId);
    if (!isChecked) {
      track('prep_question_unchecked', { meetingId, questionId });
    }
  };

  // ì‚¬ìš©ì ì§ˆë¬¸ ì¶”ê°€
  const handleAddQuestion = () => {
    if (newQuestion.trim()) {
      addUserQuestion(newQuestion.trim());
      track('prep_question_added', { meetingId, text: newQuestion.trim() });
      setNewQuestion('');
    }
  };

  // ì¤€ë¹„ ì™„ë£Œ
  const handleComplete = () => {
    const prepTimeSeconds = Math.round((Date.now() - prepStartTime) / 1000);
    const checkedQuestions = suggestedQuestions.filter(q => q.isChecked);

    track('prep_completed', {
      meetingId,
      companyName,
      meetingNumber,
      prepTimeSeconds,
      checkedQuestionCount: checkedQuestions.length,
      userQuestionCount: suggestedQuestions.filter(q => !q.isAI).length,
      isQuickMode,
    });

    onComplete();
  };

  // ë‚˜ì¤‘ì— í´ë¦­
  const handleSkip = () => {
    track('prep_skipped', {
      meetingId,
      prepTimeSeconds: Math.round((Date.now() - prepStartTime) / 1000),
    });
    onSkip();
  };

  if (!isOpen) return null;

  return (
    <AnimatePresence>
      <motion.div
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        exit={{ opacity: 0 }}
        className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[10000]"
        onClick={onClose}
      >
        <motion.div
          initial={{ scale: 0.95, opacity: 0, y: 20 }}
          animate={{ scale: 1, opacity: 1, y: 0 }}
          exit={{ scale: 0.95, opacity: 0, y: 20 }}
          transition={{ type: 'spring', duration: 0.3 }}
          className="w-[420px] max-h-[85vh] bg-white rounded-2xl shadow-2xl overflow-hidden"
          onClick={(e) => e.stopPropagation()}
        >
          {/* Header */}
          <div className="bg-blue-500 px-5 py-4 text-white">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <span>ğŸ“‹</span>
                <h2 className="font-bold text-lg">{companyName} {meetingNumber}ì°¨ ë¯¸íŒ… ì¤€ë¹„</h2>
              </div>
              <span className="bg-white/20 text-sm font-semibold px-2 py-1 rounded">
                {meetingTime}
              </span>
            </div>
          </div>

          {/* Quick Mode Banner */}
          {isQuickMode && (
            <div className="bg-red-100 border border-red-200 mx-5 mt-4 p-3 rounded-lg flex items-center gap-2 animate-pulse">
              <Clock className="w-5 h-5 text-red-600" />
              <span className="text-sm font-semibold text-red-800">
                {minutesUntilMeeting}ë¶„ í›„ ë¯¸íŒ…! í•µì‹¬ë§Œ ë¹ ë¥´ê²Œ í™•ì¸í•˜ì„¸ìš”
              </span>
            </div>
          )}

          {/* Body */}
          <div className="p-5 overflow-y-auto max-h-[calc(85vh-180px)]">
            {isLoading ? (
              <div className="flex items-center justify-center py-8">
                <div className="animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full" />
              </div>
            ) : error ? (
              <ErrorState onRetry={refetch} onSkip={handleSkip} />
            ) : (
              <>
                {/* Section 1: ì§€ë‚œ ë¯¸íŒ… ìš”ì•½ */}
                <PastMeetingsSection
                  meetings={pastMeetings}
                  meetingNumber={meetingNumber}
                  isExpanded={isPastExpanded}
                  onToggle={handlePastExpand}
                  isQuickMode={isQuickMode}
                />

                {/* Section 2: ë¯¸í™•ì¸ ì‚¬í•­ */}
                <UnconfirmedSection
                  items={isQuickMode ? unconfirmedItems.slice(0, 2) : unconfirmedItems}
                  onToggle={handleUnconfirmedToggle}
                />

                {/* Section 3: AI ì¶”ì²œ ì§ˆë¬¸ */}
                <QuestionsSection
                  questions={isQuickMode ? suggestedQuestions.slice(0, 1) : suggestedQuestions}
                  newQuestion={newQuestion}
                  onNewQuestionChange={setNewQuestion}
                  onToggle={handleQuestionToggle}
                  onAdd={handleAddQuestion}
                  isQuickMode={isQuickMode}
                />
              </>
            )}
          </div>

          {/* Footer */}
          <div className="border-t border-gray-200 p-4">
            <div className="flex gap-3">
              <motion.button
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
                onClick={handleComplete}
                className="flex-[2] h-11 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg flex items-center justify-center gap-2 transition-colors"
              >
                ì¤€ë¹„ ì™„ë£Œ
                <span>â†’</span>
              </motion.button>
              <button
                onClick={handleSkip}
                className="flex-1 h-11 border border-gray-300 text-gray-500 font-medium rounded-lg hover:bg-gray-50 transition-colors"
              >
                ë‚˜ì¤‘ì—
              </button>
            </div>
            <p className="text-center text-xs text-gray-400 mt-3 flex items-center justify-center gap-1">
              <Clock className="w-3.5 h-3.5" />
              ì˜ˆìƒ ì¤€ë¹„ ì‹œê°„: 2ë¶„
            </p>
          </div>
        </motion.div>
      </motion.div>
    </AnimatePresence>
  );
}

// ì§€ë‚œ ë¯¸íŒ… ì„¹ì…˜ ì»´í¬ë„ŒíŠ¸
function PastMeetingsSection({
  meetings,
  meetingNumber,
  isExpanded,
  onToggle,
  isQuickMode,
}: {
  meetings: PastMeeting[];
  meetingNumber: number;
  isExpanded: boolean;
  onToggle: () => void;
  isQuickMode: boolean;
}) {
  // ì²« ë¯¸íŒ…ì¸ ê²½ìš°
  if (meetingNumber === 1 || meetings.length === 0) {
    return (
      <div className="bg-gray-50 border border-gray-200 rounded-xl p-6 text-center mb-4">
        <FileText className="w-10 h-10 text-gray-300 mx-auto mb-3" />
        <p className="font-semibold text-gray-500">ì²« ë¯¸íŒ…ì…ë‹ˆë‹¤</p>
        <p className="text-sm text-gray-400">ì´ì „ ë¯¸íŒ… ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>
      </div>
    );
  }

  return (
    <div className={`bg-gray-50 border border-gray-200 rounded-xl mb-4 overflow-hidden ${isQuickMode ? 'opacity-70' : ''}`}>
      <button
        onClick={onToggle}
        className="w-full px-4 py-3 flex items-center justify-between hover:bg-gray-100 transition-colors"
      >
        <span className="flex items-center gap-2 font-semibold text-gray-700">
          <span>ğŸ“œ</span>
          ì§€ë‚œ ë¯¸íŒ… ìš”ì•½ ({meetings.length}íšŒ)
        </span>
        {isExpanded ? (
          <ChevronUp className="w-4 h-4 text-gray-400" />
        ) : (
          <ChevronDown className="w-4 h-4 text-gray-400" />
        )}
      </button>

      <AnimatePresence>
        {isExpanded && (
          <motion.div
            initial={{ height: 0 }}
            animate={{ height: 'auto' }}
            exit={{ height: 0 }}
            transition={{ duration: 0.3 }}
            className="overflow-hidden"
          >
            <div className="px-4 pb-4 space-y-2">
              {meetings.map((meeting) => (
                <div key={meeting.id} className="bg-white border border-gray-200 rounded-lg p-3">
                  <p className="font-semibold text-sm text-gray-900 mb-2">{meeting.date}</p>
                  <ul className="text-sm text-gray-500 space-y-1 list-disc list-inside">
                    {meeting.summary.map((item, idx) => (
                      <li key={idx}>{item}</li>
                    ))}
                  </ul>
                </div>
              ))}
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}

// ë¯¸í™•ì¸ ì‚¬í•­ ì„¹ì…˜
function UnconfirmedSection({
  items,
  onToggle,
}: {
  items: UnconfirmedItem[];
  onToggle: (id: string) => void;
}) {
  if (items.length === 0) return null;

  return (
    <div className="mb-4">
      <h3 className="flex items-center gap-2 font-semibold text-gray-700 mb-3">
        <span>âš ï¸</span>
        ë¯¸í™•ì¸ ì‚¬í•­
        <span className="bg-amber-100 text-amber-800 text-xs font-semibold px-2 py-0.5 rounded-full">
          {items.length}
        </span>
      </h3>
      <div className="bg-amber-50 border border-amber-300 rounded-lg p-3 space-y-2">
        {items.map((item) => (
          <div key={item.id} className="flex items-center gap-3 py-2 border-b border-amber-200 last:border-0">
            <input
              type="checkbox"
              checked={item.isChecked}
              onChange={() => onToggle(item.id)}
              className="w-5 h-5 rounded border-2 border-amber-600 accent-amber-600 cursor-pointer"
            />
            <div className="flex-1">
              <p className="font-medium text-amber-800">{item.label}</p>
              {item.description && (
                <p className="text-xs text-amber-700">{item.description}</p>
              )}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

// AI ì¶”ì²œ ì§ˆë¬¸ ì„¹ì…˜
function QuestionsSection({
  questions,
  newQuestion,
  onNewQuestionChange,
  onToggle,
  onAdd,
  isQuickMode,
}: {
  questions: SuggestedQuestion[];
  newQuestion: string;
  onNewQuestionChange: (value: string) => void;
  onToggle: (id: string, isChecked: boolean) => void;
  onAdd: () => void;
  isQuickMode: boolean;
}) {
  return (
    <div className="mb-4">
      <h3 className="flex items-center gap-2 font-semibold text-gray-700 mb-3">
        <span>ğŸ’¡</span>
        AI ì¶”ì²œ ì§ˆë¬¸
      </h3>
      <div className="bg-green-50 border border-green-300 rounded-lg p-3">
        <div className="space-y-2">
          {questions.map((question) => (
            <div key={question.id} className="flex items-start gap-3 py-2 border-b border-green-200 last:border-0">
              <input
                type="checkbox"
                checked={question.isChecked}
                onChange={() => onToggle(question.id, question.isChecked)}
                className="w-5 h-5 mt-0.5 rounded border-2 border-green-500 accent-green-500 cursor-pointer"
              />
              <p className="flex-1 text-green-800 text-sm leading-relaxed">
                "{question.text}"
                {!question.isAI && (
                  <span className="ml-2 text-xs text-gray-500">(ì§ì ‘ ì¶”ê°€)</span>
                )}
              </p>
            </div>
          ))}
        </div>

        {!isQuickMode && (
          <div className="mt-3">
            <div className="flex gap-2">
              <input
                type="text"
                value={newQuestion}
                onChange={(e) => onNewQuestionChange(e.target.value)}
                placeholder="ì§ˆë¬¸ ì¶”ê°€..."
                className="flex-1 h-9 px-3 text-sm border border-green-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"
                onKeyDown={(e) => e.key === 'Enter' && onAdd()}
              />
              <button
                onClick={onAdd}
                disabled={!newQuestion.trim()}
                className="h-9 px-3 bg-green-500 text-white rounded-md hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
              >
                <Plus className="w-4 h-4" />
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

// ì—ëŸ¬ ìƒíƒœ ì»´í¬ë„ŒíŠ¸
function ErrorState({
  onRetry,
  onSkip,
}: {
  onRetry: () => void;
  onSkip: () => void;
}) {
  return (
    <div className="bg-red-100 border border-red-500 rounded-lg p-4 text-center">
      <AlertTriangle className="w-6 h-6 text-red-500 mx-auto mb-2" />
      <p className="font-semibold text-red-800 mb-1">ì¤€ë¹„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
      <p className="text-sm text-red-700 mb-3">ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”</p>
      <button
        onClick={onRetry}
        className="w-full h-9 bg-red-500 text-white font-semibold rounded-md hover:bg-red-600 transition-colors mb-2"
      >
        ë‹¤ì‹œ ì‹œë„
      </button>
      <button
        onClick={onSkip}
        className="text-sm text-gray-500 hover:underline"
      >
        ì¤€ë¹„ ì—†ì´ ì‹œì‘í•˜ê¸°
      </button>
    </div>
  );
}
```

### 14.2 useMeetingPrep í›…

```typescript
// src/hooks/useMeetingPrep.ts
import { useState, useEffect, useCallback } from 'react';
import { meetingApi } from '@/services/meetingApi';

interface PrepData {
  pastMeetings: Array<{
    id: string;
    date: string;
    summary: string[];
  }>;
  unconfirmedItems: Array<{
    id: string;
    label: string;
    description?: string;
    isChecked: boolean;
  }>;
  suggestedQuestions: Array<{
    id: string;
    text: string;
    isChecked: boolean;
    isAI: boolean;
  }>;
  minutesUntilMeeting: number;
}

export function useMeetingPrep(meetingId: string) {
  const [data, setData] = useState<PrepData | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);

  const isQuickMode = data ? data.minutesUntilMeeting <= 5 : false;

  const fetchPrepData = useCallback(async () => {
    setIsLoading(true);
    setError(null);

    try {
      const response = await meetingApi.getMeetingPrepData(meetingId);
      setData({
        pastMeetings: response.pastMeetings,
        unconfirmedItems: response.unconfirmedItems.map(item => ({
          ...item,
          isChecked: false,
        })),
        suggestedQuestions: response.suggestedQuestions.map(q => ({
          ...q,
          isChecked: true, // AI ì¶”ì²œì€ ê¸°ë³¸ ì²´í¬
          isAI: true,
        })),
        minutesUntilMeeting: response.minutesUntilMeeting,
      });
    } catch (err) {
      setError(err instanceof Error ? err : new Error('Failed to fetch prep data'));
    } finally {
      setIsLoading(false);
    }
  }, [meetingId]);

  useEffect(() => {
    fetchPrepData();
  }, [fetchPrepData]);

  const toggleUnconfirmed = (itemId: string) => {
    if (!data) return;
    setData({
      ...data,
      unconfirmedItems: data.unconfirmedItems.map(item =>
        item.id === itemId ? { ...item, isChecked: !item.isChecked } : item
      ),
    });
  };

  const toggleQuestion = (questionId: string) => {
    if (!data) return;
    setData({
      ...data,
      suggestedQuestions: data.suggestedQuestions.map(q =>
        q.id === questionId ? { ...q, isChecked: !q.isChecked } : q
      ),
    });
  };

  const addUserQuestion = (text: string) => {
    if (!data) return;
    const newQuestion = {
      id: `user-${Date.now()}`,
      text,
      isChecked: true,
      isAI: false,
    };
    setData({
      ...data,
      suggestedQuestions: [...data.suggestedQuestions, newQuestion],
    });
  };

  return {
    pastMeetings: data?.pastMeetings ?? [],
    unconfirmedItems: data?.unconfirmedItems ?? [],
    suggestedQuestions: data?.suggestedQuestions ?? [],
    isLoading,
    error,
    isQuickMode,
    minutesUntilMeeting: data?.minutesUntilMeeting ?? 0,
    toggleUnconfirmed,
    toggleQuestion,
    addUserQuestion,
    refetch: fetchPrepData,
  };
}
```

### 14.3 API ì„œë¹„ìŠ¤

```typescript
// src/services/meetingApi.ts (ì¶”ê°€)

interface PrepDataResponse {
  pastMeetings: Array<{
    id: string;
    date: string;
    summary: string[];
  }>;
  unconfirmedItems: Array<{
    id: string;
    label: string;
    description?: string;
  }>;
  suggestedQuestions: Array<{
    id: string;
    text: string;
  }>;
  minutesUntilMeeting: number;
}

// ê¸°ì¡´ meetingApiì— ì¶”ê°€
export const meetingApi = {
  // ... ê¸°ì¡´ ë©”ì„œë“œë“¤ ...

  // Part 1.5: ë¯¸íŒ… ì¤€ë¹„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  getMeetingPrepData: async (meetingId: string): Promise<PrepDataResponse> => {
    const response = await api.get(`/meetings/${meetingId}/prep`);
    return response.data;
  },

  // Part 1.5: ì¤€ë¹„ ì™„ë£Œ ì €ì¥
  savePrepCompletion: async (meetingId: string, data: {
    checkedQuestions: string[];
    userQuestions: string[];
    prepTimeSeconds: number;
  }): Promise<void> => {
    await api.post(`/meetings/${meetingId}/prep/complete`, data);
  },
};
```

### 14.4 ì´ë²¤íŠ¸ ë¡œê¹… íƒ€ì… (Part 1.5)

```typescript
// src/types/analytics.ts (ì¶”ê°€)

// Part 1.5: ë¯¸íŒ… ì¤€ë¹„ ì´ë²¤íŠ¸ íƒ€ì…
type PrepEventType =
  | 'prep_reminder_pushed'      // 10ë¶„ ì „ ì•Œë¦¼ ë°œì†¡
  | 'prep_reminder_clicked'     // ì•Œë¦¼ì—ì„œ ì§ì ‘ í´ë¦­
  | 'prep_card_shown'           // ì˜¤ëŠ˜ í™”ë©´ì—ì„œ ì¹´ë“œ í‘œì‹œ
  | 'prep_button_clicked'       // [ì¤€ë¹„í•˜ê¸°] í´ë¦­
  | 'prep_modal_opened'         // ëª¨ë‹¬ ì—´ë¦¼
  | 'prep_past_expanded'        // ì§€ë‚œ ë¯¸íŒ… ì„¹ì…˜ í™•ì¥
  | 'prep_unconfirmed_viewed'   // ë¯¸í™•ì¸ í•­ëª© í™•ì¸
  | 'prep_question_unchecked'   // AI ì§ˆë¬¸ ì²´í¬ í•´ì œ
  | 'prep_question_added'       // ì‚¬ìš©ì ì§ˆë¬¸ ì¶”ê°€
  | 'prep_completed'            // ì¤€ë¹„ ì™„ë£Œ í´ë¦­
  | 'prep_skipped'              // ë‚˜ì¤‘ì— í´ë¦­
  | 'prep_direct_start';        // ë°”ë¡œ ì‹œì‘ í´ë¦­ (ì¤€ë¹„ ê±´ë„ˆëœ€)

interface PrepEventMetadata {
  meetingId: string;
  companyName?: string;
  meetingNumber?: number;
  pastMeetingCount?: number;
  unconfirmedCount?: number;
  suggestedQuestionCount?: number;
  userQuestionCount?: number;
  checkedQuestionCount?: number;
  prepTimeSeconds?: number;
  isQuickMode?: boolean;
  itemId?: string;
  questionId?: string;
  text?: string;
}

// Part 1.5 í•µì‹¬ ì§€í‘œ
interface PrepMetrics {
  prepRate: number;           // ì¤€ë¹„ ì™„ë£Œìœ¨ (ëª©í‘œ: >70%)
  avgPrepTime: number;        // í‰ê·  ì¤€ë¹„ ì‹œê°„ (ëª©í‘œ: <120ì´ˆ)
  questionAdoptionRate: number; // AI ì§ˆë¬¸ ì±„íƒë¥  (ëª©í‘œ: >80%)
  skipRate: number;           // ê±´ë„ˆë›°ê¸° ë¹„ìœ¨ (ëª©í‘œ: <30%)
}
```

### 14.5 í‘¸ì‹œ ì•Œë¦¼ íŠ¸ë¦¬ê±° (ë¯¸íŒ… 10ë¶„ ì „)

```typescript
// src/services/notifications.ts

export const scheduleNotifications = () => {
  // ì„œë¹„ìŠ¤ ì›Œì»¤ì—ì„œ ìŠ¤ì¼€ì¤„ë§
  if ('serviceWorker' in navigator && 'PushManager' in window) {
    navigator.serviceWorker.ready.then(registration => {
      // ë°±ê·¸ë¼ìš´ë“œ ì•Œë¦¼ ìŠ¤ì¼€ì¤„ë§ì€ ì„œë²„ì—ì„œ ì²˜ë¦¬
      // ì—¬ê¸°ì„œëŠ” ê¶Œí•œ í™•ì¸ë§Œ
    });
  }
};

// ì•Œë¦¼ í´ë¦­ í•¸ë“¤ëŸ¬
export const handleNotificationClick = (meetingId: string) => {
  // prep_reminder_clicked ì´ë²¤íŠ¸ ë¡œê¹…
  track('prep_reminder_clicked', { meetingId });

  // ì¤€ë¹„ ëª¨ë‹¬ ì—´ê¸°
  window.dispatchEvent(new CustomEvent('openPrepModal', {
    detail: { meetingId }
  }));
};
```

### 14.6 Today í™”ë©´ ì„¹ì…˜ êµ¬ì¡° (Part 2.1)

```typescript
// src/components/screens/TodayScreen/Section.tsx

import { useState, useCallback, memo, ReactNode } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ChevronDown } from 'lucide-react';
import { cn } from '@/lib/utils';
import { track } from '@/services/analytics';

// ì„¹ì…˜ íƒ€ì… ì •ì˜
type SectionType = 'urgent' | 'today' | 'later';

interface SectionConfig {
  icon: ReactNode;
  title: string;
  iconColor: string;
  badgeBg: string;
  badgeColor: string;
  defaultExpanded: boolean;
}

const SECTION_CONFIG: Record<SectionType, SectionConfig> = {
  urgent: {
    icon: 'ğŸ”´',
    title: 'ì§€ê¸ˆ ë°”ë¡œ ì²˜ë¦¬',
    iconColor: 'text-red-500',
    badgeBg: 'bg-red-100',
    badgeColor: 'text-red-800',
    defaultExpanded: true,
  },
  today: {
    icon: 'ğŸ“…',
    title: 'ì˜¤ëŠ˜ ë¯¸íŒ…',
    iconColor: 'text-blue-500',
    badgeBg: 'bg-blue-100',
    badgeColor: 'text-blue-800',
    defaultExpanded: true,
  },
  later: {
    icon: 'â°',
    title: 'ë‚˜ì¤‘ì—',
    iconColor: 'text-gray-500',
    badgeBg: 'bg-gray-200',
    badgeColor: 'text-gray-700',
    defaultExpanded: false,
  },
};

interface SectionProps {
  type: SectionType;
  count: number;
  children: ReactNode;
  className?: string;
}

export const Section = memo(function Section({
  type,
  count,
  children,
  className,
}: SectionProps) {
  const config = SECTION_CONFIG[type];
  const [isExpanded, setIsExpanded] = useState(config.defaultExpanded);

  const toggleSection = useCallback(() => {
    const newState = !isExpanded;
    setIsExpanded(newState);

    // ì´ë²¤íŠ¸ ë¡œê¹…
    track(newState ? 'today_section_expanded' : 'today_section_collapsed', {
      sectionType: type,
      itemCount: count,
    });
  }, [isExpanded, type, count]);

  return (
    <div className={cn('mb-5 border-b border-gray-200 last:border-b-0', className)}>
      {/* ì„¹ì…˜ í—¤ë” */}
      <button
        onClick={toggleSection}
        className="w-full flex items-center justify-between py-2 cursor-pointer
                   transition-opacity hover:opacity-80"
        aria-expanded={isExpanded}
        aria-controls={`section-content-${type}`}
      >
        <div className="flex items-center gap-2">
          <span className={cn('text-xl', config.iconColor)}>{config.icon}</span>
          <span className="font-semibold text-base text-gray-900">
            {config.title}
          </span>
          <span
            className={cn(
              'px-2.5 py-0.5 rounded-full text-xs font-bold min-w-[24px] text-center',
              config.badgeBg,
              config.badgeColor
            )}
          >
            {count}
          </span>
        </div>

        <motion.span
          animate={{ rotate: isExpanded ? 180 : 0 }}
          transition={{ duration: 0.2 }}
        >
          <ChevronDown className="w-4 h-4 text-gray-400" />
        </motion.span>
      </button>

      {/* ì„¹ì…˜ ì½˜í…ì¸  */}
      <AnimatePresence initial={false}>
        {isExpanded && (
          <motion.div
            id={`section-content-${type}`}
            initial={{ height: 0, opacity: 0 }}
            animate={{ height: 'auto', opacity: 1 }}
            exit={{ height: 0, opacity: 0 }}
            transition={{ duration: 0.3, ease: [0.4, 0, 0.2, 1] }}
            className="overflow-hidden"
          >
            <div className="py-3 flex flex-col gap-3">
              {children}
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
});
```

#### Empty States ì»´í¬ë„ŒíŠ¸

```typescript
// src/components/screens/TodayScreen/EmptyState.tsx

import { memo } from 'react';
import { motion } from 'framer-motion';
import { Calendar, Coffee, AlertTriangle } from 'lucide-react';
import { Button } from '@/components/ui/Button';
import { track } from '@/services/analytics';

type EmptyStateType = 'new-user' | 'no-meetings' | 'overload';

interface EmptyStateProps {
  type: EmptyStateType;
  overloadCount?: number;
  onConnectCalendar?: () => void;
  onTryDemo?: () => void;
  onShowMore?: () => void;
}

export const EmptyState = memo(function EmptyState({
  type,
  overloadCount,
  onConnectCalendar,
  onTryDemo,
  onShowMore,
}: EmptyStateProps) {
  // ë¹ˆ ìƒíƒœ í‘œì‹œ ì‹œ ì´ë²¤íŠ¸ ë¡œê¹…
  useEffect(() => {
    track('today_empty_state_shown', { emptyStateType: type });
  }, [type]);

  if (type === 'new-user') {
    return (
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        className="p-12 text-center bg-gray-50 border-2 border-dashed
                   border-gray-200 rounded-2xl"
      >
        <div className="mb-6 opacity-80">
          <Calendar className="w-24 h-24 mx-auto text-gray-300" />
        </div>
        <h3 className="text-xl font-bold text-gray-900 mb-2">
          í™˜ì˜í•´ìš”! ğŸ‰
        </h3>
        <p className="text-sm text-gray-500 mb-6 leading-relaxed">
          ì²« ë¯¸íŒ…ì„ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”<br />
          ìº˜ë¦°ë”ë¥¼ ì—°ë™í•˜ë©´ ìë™ìœ¼ë¡œ ë¯¸íŒ…ì´ ë‚˜íƒ€ë‚˜ìš”
        </p>
        <div className="flex flex-col gap-3">
          <Button
            onClick={onConnectCalendar}
            className="w-full"
          >
            ìº˜ë¦°ë” ì—°ë™í•˜ê¸°
          </Button>
          <Button
            variant="outline"
            onClick={onTryDemo}
            className="w-full"
          >
            ë°ëª¨ ë¯¸íŒ… ì²´í—˜
          </Button>
        </div>
      </motion.div>
    );
  }

  if (type === 'no-meetings') {
    return (
      <motion.div
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        className="p-6 text-center bg-green-50 rounded-xl"
      >
        <Coffee className="w-8 h-8 mx-auto text-green-600 mb-2" />
        <p className="text-sm font-medium text-green-800">
          ì˜¤ëŠ˜ì€ ì—¬ìœ ë¡­ë„¤ìš”! â˜•
        </p>
        <p className="text-xs text-green-600 mt-1">
          ë‚´ì¼ ë¯¸íŒ… ì¤€ë¹„í•´ë³¼ê¹Œìš”?
        </p>
      </motion.div>
    );
  }

  if (type === 'overload') {
    return (
      <motion.div
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        className="p-3 bg-yellow-100 border border-yellow-500 rounded-lg mb-3"
      >
        <div className="flex items-center gap-2">
          <AlertTriangle className="w-4 h-4 text-yellow-800" />
          <span className="text-sm font-medium text-yellow-800">
            ì˜¤ëŠ˜ ë¯¸íŒ…ì´ ë§ë„¤ìš”. ì¤‘ìš”í•œ ê²ƒë§Œ ì§‘ì¤‘í•˜ì„¸ìš”
          </span>
        </div>
        {overloadCount && overloadCount > 3 && (
          <button
            onClick={onShowMore}
            className="w-full mt-3 py-3 text-sm font-medium text-blue-500
                       bg-gray-100 rounded-lg hover:bg-gray-200 transition"
          >
            + {overloadCount - 3}ê°œ ë” ë³´ê¸° â–¼
          </button>
        )}
      </motion.div>
    );
  }

  return null;
});
```

### 14.7 ì¹´ë“œ ìƒíƒœ ê´€ë¦¬ (Part 2.2)

```typescript
// src/types/meeting-card.ts

export type CardState =
  | 'pending'    // ë‚®ì€ ìš°ì„ ìˆœìœ„
  | 'urgent'     // ê¸´ê¸‰ (24ì‹œê°„ ì´ë‚´)
  | 'prepping'   // ì¤€ë¹„ ì¤‘
  | 'ready'      // ì¤€ë¹„ ì™„ë£Œ
  | 'live'       // ì§„í–‰ ì¤‘
  | 'skipped';   // ê±´ë„ˆëœ€

export interface MeetingCardData {
  id: string;
  companyName: string;
  meetingNumber: number;
  scheduledAt: Date;
  state: CardState;
  hasUnconfirmed: boolean;
  unconfirmedCount: number;
  unconfirmedItems: string[];
  prepTimeEstimate: number; // seconds
  suggestedQuestions: string[];
}

// ìƒíƒœ ì „í™˜ ê·œì¹™
export const STATE_TRANSITIONS: Record<CardState, CardState[]> = {
  pending: ['urgent', 'skipped'],
  urgent: ['prepping', 'skipped'],
  prepping: ['ready'],
  ready: ['live', 'skipped'],
  live: [],
  skipped: ['prepping'],
};
```

#### MeetingCard ì»´í¬ë„ŒíŠ¸ (ìƒíƒœ ê¸°ë°˜)

```typescript
// src/components/screens/TodayScreen/MeetingCard.tsx

import { memo, useMemo, useCallback } from 'react';
import { motion } from 'framer-motion';
import { Play, Clock, Check, AlertTriangle, Zap, Radio } from 'lucide-react';
import { cn } from '@/lib/utils';
import { CardState, MeetingCardData } from '@/types/meeting-card';
import { Button } from '@/components/ui/Button';
import { track } from '@/services/analytics';
import { formatDistanceToNow, differenceInMinutes } from 'date-fns';
import { ko } from 'date-fns/locale';

// ìƒíƒœë³„ ìŠ¤íƒ€ì¼ ì„¤ì •
const STATE_STYLES: Record<CardState, {
  border: string;
  bg: string;
  titleColor: string;
  badge?: { bg: string; color: string; text: string };
}> = {
  pending: {
    border: 'border-gray-200',
    bg: 'bg-white',
    titleColor: 'text-gray-500',
  },
  urgent: {
    border: 'border-red-500 border-2',
    bg: 'bg-red-50',
    titleColor: 'text-red-800 font-bold',
    badge: { bg: 'bg-red-500', color: 'text-white', text: '' },
  },
  prepping: {
    border: 'border-blue-500 border-2',
    bg: 'bg-blue-50',
    titleColor: 'text-blue-800',
    badge: { bg: 'bg-blue-500', color: 'text-white', text: '' },
  },
  ready: {
    border: 'border-green-500 border-2',
    bg: 'bg-green-50',
    titleColor: 'text-green-800',
    badge: { bg: 'bg-green-500', color: 'text-white', text: '' },
  },
  live: {
    border: 'border-purple-500 border-2',
    bg: 'bg-purple-50',
    titleColor: 'text-purple-800',
    badge: { bg: 'bg-purple-500', color: 'text-white', text: 'LIVE' },
  },
  skipped: {
    border: 'border-gray-200',
    bg: 'bg-gray-50',
    titleColor: 'text-gray-600',
    badge: { bg: 'bg-yellow-100', color: 'text-yellow-800', text: 'âš ï¸ ì¤€ë¹„ ì•ˆ ë¨' },
  },
};

interface MeetingCardProps {
  meeting: MeetingCardData;
  onPrepClick: (meetingId: string) => void;
  onStartClick: (meetingId: string) => void;
  onViewClick: (meetingId: string) => void;
}

export const MeetingCard = memo(function MeetingCard({
  meeting,
  onPrepClick,
  onStartClick,
  onViewClick,
}: MeetingCardProps) {
  const styles = STATE_STYLES[meeting.state];
  const minutesUntil = differenceInMinutes(meeting.scheduledAt, new Date());
  const isImminent = minutesUntil <= 5 && minutesUntil > 0;

  // ì¹´ë“œ ë·°í¬íŠ¸ ì§„ì… ì‹œ ì´ë²¤íŠ¸ ë¡œê¹…
  const handleInView = useCallback(() => {
    track('card_viewed', {
      cardId: meeting.id,
      meetingId: meeting.id,
      companyName: meeting.companyName,
      cardState: meeting.state,
      timeUntilMeeting: minutesUntil,
      hasUnconfirmed: meeting.hasUnconfirmed,
    });
  }, [meeting, minutesUntil]);

  // ì¤€ë¹„í•˜ê¸° í´ë¦­
  const handlePrepClick = useCallback(() => {
    track('card_prep_clicked', {
      cardId: meeting.id,
      cardState: meeting.state,
      timeUntilMeeting: minutesUntil,
    });
    onPrepClick(meeting.id);
  }, [meeting.id, meeting.state, minutesUntil, onPrepClick]);

  // ë°”ë¡œ ì‹œì‘ í´ë¦­
  const handleStartClick = useCallback(() => {
    track('card_start_clicked', {
      cardId: meeting.id,
      cardState: meeting.state,
      hasUnconfirmed: meeting.hasUnconfirmed,
    });
    onStartClick(meeting.id);
  }, [meeting.id, meeting.state, meeting.hasUnconfirmed, onStartClick]);

  // CTA ë Œë”ë§
  const renderCTA = useMemo(() => {
    switch (meeting.state) {
      case 'pending':
        return null;

      case 'urgent':
      case 'skipped':
        return (
          <div className="flex gap-3 mt-4">
            <Button onClick={handlePrepClick} className="flex-1">
              {isImminent ? (
                <>
                  <Zap className="w-4 h-4 mr-2" />
                  ë¹ ë¥¸ ì¤€ë¹„ 30ì´ˆ
                </>
              ) : (
                'ì¤€ë¹„í•˜ê¸°'
              )}
            </Button>
            <Button
              variant="outline"
              onClick={handleStartClick}
              className="text-gray-500"
            >
              ë°”ë¡œ ì‹œì‘
            </Button>
          </div>
        );

      case 'ready':
        return (
          <Button
            onClick={handleStartClick}
            className="w-full mt-4 bg-green-500 hover:bg-green-600"
          >
            <Play className="w-4 h-4 mr-2" />
            ë¯¸íŒ… ì‹œì‘
          </Button>
        );

      case 'live':
        return (
          <Button
            onClick={() => onViewClick(meeting.id)}
            className="w-full mt-4 bg-purple-500 hover:bg-purple-600"
          >
            <Radio className="w-4 h-4 mr-2 animate-pulse" />
            íšŒì˜ ë³´ê¸°
          </Button>
        );

      case 'prepping':
        return (
          <div className="mt-4">
            <div className="h-1 bg-blue-100 rounded-full overflow-hidden">
              <motion.div
                className="h-full bg-blue-500"
                initial={{ width: '0%' }}
                animate={{ width: '60%' }}
                transition={{ duration: 0.5 }}
              />
            </div>
            <p className="text-xs text-blue-600 text-center mt-2">
              ì¤€ë¹„ ì¤‘...
            </p>
          </div>
        );

      default:
        return null;
    }
  }, [meeting.state, isImminent, handlePrepClick, handleStartClick, onViewClick, meeting.id]);

  return (
    <motion.div
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      whileHover={{ y: -2 }}
      onViewportEnter={handleInView}
      className={cn(
        'relative p-4 rounded-xl border transition-shadow',
        'hover:shadow-md cursor-pointer',
        styles.border,
        styles.bg,
        meeting.state === 'pending' && 'opacity-90'
      )}
    >
      {/* ìƒíƒœ ë°°ì§€ */}
      {styles.badge && (
        <motion.div
          initial={{ scale: 0 }}
          animate={{ scale: 1 }}
          className={cn(
            'absolute -top-1.5 -right-1.5 px-2 py-0.5 rounded-full text-xs font-bold',
            styles.badge.bg,
            styles.badge.color
          )}
        >
          {meeting.state === 'urgent' && (
            <span className="w-3 h-3 rounded-full bg-red-500 animate-pulse inline-block" />
          )}
          {meeting.state === 'ready' && <Check className="w-3 h-3" />}
          {styles.badge.text}
        </motion.div>
      )}

      {/* ì¹´ìš´íŠ¸ë‹¤ìš´ (ë¯¸íŒ… ì„ë°• ì‹œ) */}
      {isImminent && (
        <div className="absolute top-3 right-3 flex items-center gap-1.5
                        px-2 py-1 bg-red-100 rounded-md">
          <Clock className="w-3.5 h-3.5 text-red-500" />
          <span className="text-sm font-bold text-red-800 tabular-nums">
            {minutesUntil}:{String(Math.floor((minutesUntil * 60) % 60)).padStart(2, '0')}
          </span>
        </div>
      )}

      {/* ì¹´ë“œ í—¤ë” */}
      <div className={cn('text-base', styles.titleColor)}>
        <span className="text-blue-500 font-medium mr-2">
          {new Date(meeting.scheduledAt).toLocaleTimeString('ko-KR', {
            hour: '2-digit',
            minute: '2-digit',
          })}
        </span>
        {meeting.companyName} {meeting.meetingNumber}ì°¨
      </div>

      {/* ì¤€ë¹„ ì •ë³´ */}
      {meeting.hasUnconfirmed && meeting.state !== 'ready' && (
        <div className="mt-3">
          <div className="inline-flex items-center gap-1 px-2 py-1
                          bg-blue-100 text-blue-800 rounded-md text-xs font-medium">
            ğŸ’¡ ì¤€ë¹„ í•„ìš”
          </div>
          <ul className="mt-2 text-sm text-gray-700 list-disc list-inside">
            {meeting.unconfirmedItems.slice(0, 2).map((item, i) => (
              <li key={i}>ë¯¸í™•ì¸: {item}</li>
            ))}
          </ul>
          <p className="mt-2 text-xs text-gray-500">
            ì˜ˆìƒ ì¤€ë¹„ ì‹œê°„: {Math.ceil(meeting.prepTimeEstimate / 60)}ë¶„
          </p>
        </div>
      )}

      {/* CTA ë²„íŠ¼ */}
      {renderCTA}
    </motion.div>
  );
});
```

#### useTodayScreen í›…

```typescript
// src/hooks/useTodayScreen.ts

import { useState, useEffect, useMemo, useCallback } from 'react';
import { useQuery } from '@tanstack/react-query';
import { MeetingCardData, CardState } from '@/types/meeting-card';
import { track } from '@/services/analytics';
import { differenceInHours } from 'date-fns';

interface TodayScreenData {
  urgent: MeetingCardData[];
  today: MeetingCardData[];
  later: MeetingCardData[];
}

// ì¹´ë“œ ìƒíƒœ ê³„ì‚°
const calculateCardState = (meeting: MeetingCardData): CardState => {
  const now = new Date();
  const meetingTime = new Date(meeting.scheduledAt);
  const hoursUntil = differenceInHours(meetingTime, now);

  // í˜„ì¬ ì§„í–‰ ì¤‘
  if (meeting.state === 'live') return 'live';

  // ì¤€ë¹„ ì™„ë£Œ ìƒíƒœ
  if (meeting.state === 'ready') return 'ready';

  // ì¤€ë¹„ ì¤‘
  if (meeting.state === 'prepping') return 'prepping';

  // ê±´ë„ˆëœ€
  if (meeting.state === 'skipped') return 'skipped';

  // 24ì‹œê°„ ì´ë‚´ = ê¸´ê¸‰
  if (hoursUntil <= 24 && hoursUntil > 0 && meeting.hasUnconfirmed) {
    return 'urgent';
  }

  return 'pending';
};

// ìš°ì„ ìˆœìœ„ ì •ë ¬
const sortByPriority = (meetings: MeetingCardData[]): MeetingCardData[] => {
  return [...meetings].sort((a, b) => {
    // ìƒíƒœë³„ ìš°ì„ ìˆœìœ„
    const stateOrder: Record<CardState, number> = {
      live: 0,
      urgent: 1,
      prepping: 2,
      ready: 3,
      skipped: 4,
      pending: 5,
    };

    const stateCompare = stateOrder[a.state] - stateOrder[b.state];
    if (stateCompare !== 0) return stateCompare;

    // ê°™ì€ ìƒíƒœë©´ ì‹œê°„ìˆœ
    return new Date(a.scheduledAt).getTime() - new Date(b.scheduledAt).getTime();
  });
};

export function useTodayScreen() {
  const { data: meetings = [], isLoading, error, refetch } = useQuery({
    queryKey: ['today-meetings'],
    queryFn: async () => {
      const response = await fetch('/api/meetings/today');
      return response.json() as Promise<MeetingCardData[]>;
    },
    refetchInterval: 60000, // 1ë¶„ë§ˆë‹¤ ê°±ì‹ 
    staleTime: 30000,
  });

  // í™”ë©´ ì§„ì… ì‹œ ì´ë²¤íŠ¸ ë¡œê¹…
  useEffect(() => {
    const hour = new Date().getHours();
    const timeOfDay = hour < 12 ? 'morning' : hour < 18 ? 'afternoon' : 'evening';

    track('today_screen_viewed', {
      timeOfDay,
      totalMeetings: meetings.length,
    });
  }, [meetings.length]);

  // ì„¹ì…˜ë³„ ë¶„ë¥˜
  const categorized = useMemo((): TodayScreenData => {
    const now = new Date();
    const today = now.toDateString();

    const withState = meetings.map(m => ({
      ...m,
      state: calculateCardState(m),
    }));

    const urgent = sortByPriority(
      withState.filter(m =>
        m.state === 'urgent' ||
        (m.hasUnconfirmed && differenceInHours(new Date(m.scheduledAt), now) <= 24)
      )
    );

    const todayMeetings = sortByPriority(
      withState.filter(m =>
        new Date(m.scheduledAt).toDateString() === today &&
        !urgent.find(u => u.id === m.id)
      )
    );

    const later = sortByPriority(
      withState.filter(m =>
        new Date(m.scheduledAt).toDateString() !== today &&
        !urgent.find(u => u.id === m.id)
      )
    );

    return { urgent, today: todayMeetings, later };
  }, [meetings]);

  // ê³¼ë¶€í•˜ ê²½ê³ 
  const isOverloaded = categorized.today.length >= 5;

  // ìƒˆë¡œê³ ì¹¨ í•¸ë“¤ëŸ¬
  const handleRefresh = useCallback(() => {
    track('today_refresh_triggered');
    refetch();
  }, [refetch]);

  return {
    ...categorized,
    isLoading,
    error,
    isOverloaded,
    refresh: handleRefresh,
    totalCount: meetings.length,
  };
}
```

#### ì´ë²¤íŠ¸ ë¡œê¹… íƒ€ì… (Part 2)

```typescript
// src/types/analytics-part2.ts

// Part 2.1: Today í™”ë©´ ì´ë²¤íŠ¸ íƒ€ì…
export type TodayEventType =
  | 'today_screen_viewed'       // Today í™”ë©´ ì§„ì…
  | 'today_section_expanded'    // ì„¹ì…˜ í¼ì¹¨
  | 'today_section_collapsed'   // ì„¹ì…˜ ì ‘ìŒ
  | 'today_card_clicked'        // ì¹´ë“œ í´ë¦­
  | 'today_empty_state_shown'   // ë¹ˆ ìƒíƒœ í‘œì‹œ
  | 'today_refresh_triggered'   // ìƒˆë¡œê³ ì¹¨
  | 'today_overload_shown';     // ê³¼ë¶€í•˜ ê²½ê³  í‘œì‹œ

export interface TodayMetadata {
  urgentCount: number;
  todayCount: number;
  laterCount: number;
  totalUnconfirmed: number;
  timeOfDay: 'morning' | 'afternoon' | 'evening';
  sessionDuration: number;
}

// Part 2.2: ì¹´ë“œ ì´ë²¤íŠ¸ íƒ€ì…
export type CardEventType =
  | 'card_viewed'              // ì¹´ë“œ ë·°í¬íŠ¸ ì§„ì…
  | 'card_clicked'             // ì¹´ë“œ í´ë¦­
  | 'card_prep_clicked'        // [ì¤€ë¹„í•˜ê¸°] í´ë¦­
  | 'card_start_clicked'       // [ë°”ë¡œ ì‹œì‘] í´ë¦­
  | 'card_state_changed'       // ìƒíƒœ ì „í™˜
  | 'card_urgent_triggered'    // ê¸´ê¸‰ ìƒíƒœ ì „í™˜
  | 'card_pulse_shown';        // í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ

export interface CardMetadata {
  cardId: string;
  meetingId: string;
  companyName: string;
  meetingNumber: number;
  cardState: CardState;
  timeUntilMeeting: number;
  hasUnconfirmed: boolean;
  unconfirmedCount: number;
  prepTimeEstimate: number;
}

// Part 2 í•µì‹¬ ì§€í‘œ
export const part2Metrics = {
  // í‰ê·  ìŠ¤ìº” ì‹œê°„
  avgScanTime: 'avg(sessionDuration WHERE today_screen_viewed)',
  // ëª©í‘œ: < 10ì´ˆ

  // ê¸´ê¸‰ í•­ëª© ì²˜ë¦¬ìœ¨
  urgentClearRate: 'count(urgent_completed) / count(urgent_shown)',
  // ëª©í‘œ: > 80%

  // ì¤€ë¹„í•˜ê¸° í´ë¦­ë¥ 
  prepClickRate: 'count(card_prep_clicked) / count(card_viewed)',
  // ëª©í‘œ: > 70%

  // ê±´ë„ˆë›°ê¸°ìœ¨
  skipRate: 'count(card_start_clicked) / count(card_viewed WHERE hasUnconfirmed)',
  // ëª©í‘œ: < 30%

  // í‰ê·  í–‰ë™ê¹Œì§€ ì‹œê°„
  avgTimeToAction: 'avg(timeToClick WHERE card_viewed to card_prep_clicked)',
  // ëª©í‘œ: < 5ì´ˆ
};
```

### 14.8 HUD ìë™ ì‹œì‘ ì‹œìŠ¤í…œ (Part 3.1)

```typescript
// src/hooks/useMeetingDetection.ts
import { useEffect, useRef, useCallback } from 'react';
import { useHUDStore } from '@/stores/hudStore';
import { useAnalytics } from './useAnalytics';

interface MeetingDetectionConfig {
  platforms: ('zoom' | 'meet' | 'teams')[];
  checkInterval: number; // ms
  enabled: boolean;
}

const DEFAULT_CONFIG: MeetingDetectionConfig = {
  platforms: ['zoom', 'meet', 'teams'],
  checkInterval: 1000,
  enabled: true,
};

// í”Œë«í¼ë³„ URL íŒ¨í„´
const PLATFORM_PATTERNS = {
  zoom: /^https:\/\/([\w-]+\.)?zoom\.us\/(j|wc)\/\d+/,
  meet: /^https:\/\/meet\.google\.com\/[a-z]{3}-[a-z]{4}-[a-z]{3}/,
  teams: /^https:\/\/teams\.(microsoft|live)\.com\/.*\/meeting/,
} as const;

export function useMeetingDetection(config: Partial<MeetingDetectionConfig> = {}) {
  const mergedConfig = { ...DEFAULT_CONFIG, ...config };
  const { trackEvent } = useAnalytics();
  const setMeetingState = useHUDStore((s) => s.setMeetingState);
  const showNewMeetingPrompt = useHUDStore((s) => s.showNewMeetingPrompt);

  const lastDetectedUrlRef = useRef<string | null>(null);
  const checkIntervalRef = useRef<number | null>(null);

  // URLì—ì„œ í”Œë«í¼ ê°ì§€
  const detectPlatform = useCallback((url: string): 'zoom' | 'meet' | 'teams' | null => {
    for (const platform of mergedConfig.platforms) {
      if (PLATFORM_PATTERNS[platform].test(url)) {
        return platform;
      }
    }
    return null;
  }, [mergedConfig.platforms]);

  // íƒ­ URL ì²´í¬ (Chrome Extension API)
  const checkCurrentTab = useCallback(async () => {
    if (!chrome?.tabs) return;

    try {
      const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
      if (!tab?.url) return;

      const platform = detectPlatform(tab.url);

      if (platform && tab.url !== lastDetectedUrlRef.current) {
        lastDetectedUrlRef.current = tab.url;

        // ë¯¸íŒ… ê°ì§€ ì´ë²¤íŠ¸
        trackEvent('meeting_detected', {
          platform,
          url: tab.url,
          timestamp: Date.now(),
        });

        // ìƒˆ ë¯¸íŒ… í”„ë¡¬í”„íŠ¸ í‘œì‹œ
        showNewMeetingPrompt({
          platform,
          meetingUrl: tab.url,
          detectedAt: Date.now(),
        });
      } else if (!platform && lastDetectedUrlRef.current) {
        // ë¯¸íŒ… ì¢…ë£Œ ê°ì§€
        trackEvent('meeting_ended', {
          previousUrl: lastDetectedUrlRef.current,
        });
        lastDetectedUrlRef.current = null;
      }
    } catch (error) {
      console.error('Tab check failed:', error);
    }
  }, [detectPlatform, showNewMeetingPrompt, trackEvent]);

  useEffect(() => {
    if (!mergedConfig.enabled) return;

    // ì´ˆê¸° ì²´í¬
    checkCurrentTab();

    // ì£¼ê¸°ì  ì²´í¬
    checkIntervalRef.current = window.setInterval(checkCurrentTab, mergedConfig.checkInterval);

    // íƒ­ ë³€ê²½ ê°ì§€
    const handleTabChange = () => checkCurrentTab();
    chrome?.tabs?.onActivated?.addListener(handleTabChange);
    chrome?.tabs?.onUpdated?.addListener(handleTabChange);

    return () => {
      if (checkIntervalRef.current) {
        clearInterval(checkIntervalRef.current);
      }
      chrome?.tabs?.onActivated?.removeListener(handleTabChange);
      chrome?.tabs?.onUpdated?.removeListener(handleTabChange);
    };
  }, [mergedConfig.enabled, mergedConfig.checkInterval, checkCurrentTab]);

  return {
    isEnabled: mergedConfig.enabled,
    lastDetectedUrl: lastDetectedUrlRef.current,
  };
}
```

```typescript
// src/components/hud/NewMeetingPrompt.tsx
import { motion, AnimatePresence } from 'framer-motion';
import { Video, X, Clock } from 'lucide-react';
import { useHUDStore } from '@/stores/hudStore';
import { useAnalytics } from '@/hooks/useAnalytics';
import { useState, useEffect } from 'react';

interface NewMeetingPromptProps {
  onStart: () => void;
  onDismiss: () => void;
}

export function NewMeetingPrompt({ onStart, onDismiss }: NewMeetingPromptProps) {
  const prompt = useHUDStore((s) => s.newMeetingPrompt);
  const { trackEvent } = useAnalytics();
  const [countdown, setCountdown] = useState(5);

  // 5ì´ˆ ìë™ ì‹œì‘ ì¹´ìš´íŠ¸ë‹¤ìš´
  useEffect(() => {
    if (!prompt) return;

    const timer = setInterval(() => {
      setCountdown((prev) => {
        if (prev <= 1) {
          clearInterval(timer);
          trackEvent('meeting_auto_started', { platform: prompt.platform });
          onStart();
          return 0;
        }
        return prev - 1;
      });
    }, 1000);

    return () => clearInterval(timer);
  }, [prompt, onStart, trackEvent]);

  if (!prompt) return null;

  const platformLabels = {
    zoom: 'Zoom',
    meet: 'Google Meet',
    teams: 'Teams',
  };

  return (
    <AnimatePresence>
      <motion.div
        initial={{ opacity: 0, scale: 0.95, y: -20 }}
        animate={{ opacity: 1, scale: 1, y: 0 }}
        exit={{ opacity: 0, scale: 0.95, y: -20 }}
        className="fixed top-5 right-5 z-[9999] w-[320px] bg-white rounded-2xl
                   shadow-lg border border-gray-200 overflow-hidden"
      >
        {/* í—¤ë” */}
        <div className="flex items-center justify-between px-4 py-3 bg-blue-50">
          <div className="flex items-center gap-2">
            <Video size={18} className="text-blue-600" />
            <span className="font-medium text-gray-800">
              {platformLabels[prompt.platform]} ê°ì§€
            </span>
          </div>
          <button
            onClick={() => {
              trackEvent('meeting_prompt_dismissed');
              onDismiss();
            }}
            className="p-1 hover:bg-gray-200 rounded-full transition-colors"
          >
            <X size={16} className="text-gray-500" />
          </button>
        </div>

        {/* ë³¸ë¬¸ */}
        <div className="p-4">
          <p className="text-sm text-gray-600 mb-4">
            ë¯¸íŒ…ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. Onnoê°€ ìë™ìœ¼ë¡œ ê¸°ë¡ì„ ì‹œì‘í• ê¹Œìš”?
          </p>

          {/* ì¹´ìš´íŠ¸ë‹¤ìš´ í”„ë¡œê·¸ë ˆìŠ¤ */}
          <div className="mb-4">
            <div className="flex items-center justify-between text-xs text-gray-500 mb-1">
              <span className="flex items-center gap-1">
                <Clock size={12} />
                ìë™ ì‹œì‘ê¹Œì§€
              </span>
              <span className="font-medium">{countdown}ì´ˆ</span>
            </div>
            <div className="h-1 bg-gray-200 rounded-full overflow-hidden">
              <motion.div
                className="h-full bg-blue-500"
                initial={{ width: '100%' }}
                animate={{ width: '0%' }}
                transition={{ duration: 5, ease: 'linear' }}
              />
            </div>
          </div>

          {/* ë²„íŠ¼ */}
          <div className="flex gap-2">
            <button
              onClick={() => {
                trackEvent('meeting_start_clicked', { platform: prompt.platform });
                onStart();
              }}
              className="flex-1 px-4 py-2 bg-blue-500 text-white text-sm font-medium
                         rounded-lg hover:bg-blue-600 transition-colors"
            >
              ì§€ê¸ˆ ì‹œì‘
            </button>
            <button
              onClick={() => {
                trackEvent('meeting_prompt_dismissed');
                onDismiss();
              }}
              className="px-4 py-2 text-gray-600 text-sm hover:bg-gray-100
                         rounded-lg transition-colors"
            >
              ì´ë²ˆì—” íŒ¨ìŠ¤
            </button>
          </div>
        </div>
      </motion.div>
    </AnimatePresence>
  );
}
```

### 14.9 HUD ê³ ë„í™” Store (Part 3.1-3.4)

```typescript
// src/stores/hudStore.ts (Part 3 í™•ì¥)
import { create } from 'zustand';
import { devtools, subscribeWithSelector } from 'zustand/middleware';

// íƒ€ì… ì •ì˜
export type HUDState = 'hidden' | 'idle' | 'alert' | 'expanded';
export type AlertLevel = 1 | 2 | 3;
export type OpacityState = 'active' | 'default' | 'inactive';

export interface Alert {
  id: string;
  level: AlertLevel;
  icon: string;
  title: string;
  message: string;
  suggestedQuestion?: string;
  reason?: string[];
  timestamp: number;
  category: 'gap' | 'decision' | 'action' | 'risk';
}

export interface NewMeetingPrompt {
  platform: 'zoom' | 'meet' | 'teams';
  meetingUrl: string;
  detectedAt: number;
}

export interface DeferredItem {
  id: string;
  alertId: string;
  question: string;
  deferredAt: number;
  category: Alert['category'];
}

export interface MeetingSession {
  id: string;
  platform: 'zoom' | 'meet' | 'teams';
  startTime: number;
  isActive: boolean;
  totalAlerts: { level1: number; level2: number; level3: number };
  alertsActioned: number;
  gapsIdentified: number;
  gapsResolved: number;
}

interface HUDStore {
  // Part 3.1: ìë™ ì‹œì‘ ìƒíƒœ
  state: HUDState;
  newMeetingPrompt: NewMeetingPrompt | null;
  currentSession: MeetingSession | null;

  // Part 3.2: Idle ìƒíƒœ
  opacityState: OpacityState;
  isExpanded: boolean;
  lastInteractionTime: number;

  // Part 3.3: ì•Œë¦¼ ìƒíƒœ
  currentAlert: Alert | null;
  alertQueue: Alert[];
  infoAlerts: Alert[];
  alertHistory: Alert[];

  // Part 3.4: ì‚¬ìš©ì ì‘ë‹µ ìƒíƒœ
  deferredItems: DeferredItem[];
  showRiskDialog: boolean;
  pendingRiskAlert: Alert | null;

  // Part 3.1: ìë™ ì‹œì‘ ì•¡ì…˜
  showNewMeetingPrompt: (prompt: NewMeetingPrompt) => void;
  dismissNewMeetingPrompt: () => void;
  startMeetingSession: (platform: 'zoom' | 'meet' | 'teams') => void;
  endMeetingSession: () => void;
  setMeetingState: (state: HUDState) => void;

  // Part 3.2: Idle ìƒíƒœ ì•¡ì…˜
  setOpacityState: (state: OpacityState) => void;
  setExpanded: (expanded: boolean) => void;
  recordInteraction: () => void;

  // Part 3.3: ì•Œë¦¼ ì•¡ì…˜
  showAlert: (alert: Omit<Alert, 'id' | 'timestamp'>) => void;
  dismissAlert: () => void;
  processNextAlert: () => void;

  // Part 3.4: ì‚¬ìš©ì ì‘ë‹µ ì•¡ì…˜
  askQuestion: (alertId: string) => void;
  deferAlert: (alertId: string) => void;
  acceptRisk: (alertId: string) => void;
  showRiskConfirmation: (alert: Alert) => void;
  hideRiskConfirmation: () => void;
  removeDeferredItem: (itemId: string) => void;

  // ê³„ì‚°ëœ ê°’
  hasAlerts: () => boolean;
  getAlertCount: () => number;
  getDeferredCount: () => number;
  getSessionStats: () => MeetingSession | null;
}

export const useHUDStore = create<HUDStore>()(
  devtools(
    subscribeWithSelector((set, get) => ({
      // ì´ˆê¸° ìƒíƒœ
      state: 'hidden',
      newMeetingPrompt: null,
      currentSession: null,
      opacityState: 'default',
      isExpanded: false,
      lastInteractionTime: Date.now(),
      currentAlert: null,
      alertQueue: [],
      infoAlerts: [],
      alertHistory: [],
      deferredItems: [],
      showRiskDialog: false,
      pendingRiskAlert: null,

      // Part 3.1: ìë™ ì‹œì‘ ì•¡ì…˜
      showNewMeetingPrompt: (prompt) => {
        set({ newMeetingPrompt: prompt, state: 'idle' });
      },

      dismissNewMeetingPrompt: () => {
        set({ newMeetingPrompt: null });
      },

      startMeetingSession: (platform) => {
        const session: MeetingSession = {
          id: crypto.randomUUID(),
          platform,
          startTime: Date.now(),
          isActive: true,
          totalAlerts: { level1: 0, level2: 0, level3: 0 },
          alertsActioned: 0,
          gapsIdentified: 0,
          gapsResolved: 0,
        };
        set({
          currentSession: session,
          state: 'idle',
          newMeetingPrompt: null,
        });
      },

      endMeetingSession: () => {
        const session = get().currentSession;
        if (session) {
          set({
            currentSession: { ...session, isActive: false },
            state: 'hidden',
          });
        }
      },

      setMeetingState: (state) => {
        set({ state });
      },

      // Part 3.2: Idle ìƒíƒœ ì•¡ì…˜
      setOpacityState: (opacityState) => {
        set({ opacityState });
      },

      setExpanded: (isExpanded) => {
        set({ isExpanded });
        get().recordInteraction();
      },

      recordInteraction: () => {
        set({
          lastInteractionTime: Date.now(),
          opacityState: 'active',
        });
      },

      // Part 3.3: ì•Œë¦¼ ì•¡ì…˜
      showAlert: (alert) => {
        const newAlert: Alert = {
          ...alert,
          id: crypto.randomUUID(),
          timestamp: Date.now(),
        };

        const session = get().currentSession;
        if (session) {
          const levelKey = `level${alert.level}` as keyof typeof session.totalAlerts;
          session.totalAlerts[levelKey]++;
          if (alert.category === 'gap') {
            session.gapsIdentified++;
          }
        }

        // Level 1 (Info): íì—ë§Œ ì¶”ê°€, í‘œì‹œ ì•ˆ í•¨
        if (newAlert.level === 1) {
          set((state) => ({
            infoAlerts: [...state.infoAlerts, newAlert],
            alertHistory: [...state.alertHistory, newAlert],
          }));
          return;
        }

        // Level 3 (Critical): ìœ„í—˜ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
        if (newAlert.level === 3 && newAlert.category === 'risk') {
          get().showRiskConfirmation(newAlert);
          return;
        }

        // Level 2: ì¦‰ì‹œ í‘œì‹œ
        set((state) => ({
          state: 'alert',
          currentAlert: newAlert,
          alertQueue: [...state.alertQueue, newAlert],
          alertHistory: [...state.alertHistory, newAlert],
          opacityState: 'active',
        }));

        // Level 2: 10ì´ˆ í›„ ìë™ ë‹«í˜
        if (newAlert.level === 2) {
          setTimeout(() => {
            const current = get().currentAlert;
            if (current?.id === newAlert.id) {
              get().dismissAlert();
            }
          }, 10000);
        }
      },

      dismissAlert: () => {
        set({
          state: 'idle',
          currentAlert: null,
        });
        // ë‹¤ìŒ ì•Œë¦¼ ì²˜ë¦¬
        setTimeout(() => get().processNextAlert(), 500);
      },

      processNextAlert: () => {
        const { alertQueue, currentAlert } = get();
        if (currentAlert) return;

        const pendingAlerts = alertQueue.filter(
          (a) => a.level >= 2 && !get().alertHistory.some((h) => h.id === a.id)
        );

        if (pendingAlerts.length > 0) {
          const nextAlert = pendingAlerts[0];
          set({
            state: 'alert',
            currentAlert: nextAlert,
            opacityState: 'active',
          });
        }
      },

      // Part 3.4: ì‚¬ìš©ì ì‘ë‹µ ì•¡ì…˜
      askQuestion: (alertId) => {
        const alert = get().alertQueue.find((a) => a.id === alertId);
        if (alert?.suggestedQuestion) {
          navigator.clipboard.writeText(alert.suggestedQuestion);
        }

        const session = get().currentSession;
        if (session) {
          session.alertsActioned++;
          if (alert?.category === 'gap') {
            session.gapsResolved++;
          }
        }

        get().dismissAlert();
      },

      deferAlert: (alertId) => {
        const alert = get().alertQueue.find((a) => a.id === alertId);
        if (!alert) return;

        const deferredItem: DeferredItem = {
          id: crypto.randomUUID(),
          alertId,
          question: alert.suggestedQuestion || alert.message,
          deferredAt: Date.now(),
          category: alert.category,
        };

        set((state) => ({
          deferredItems: [...state.deferredItems, deferredItem],
        }));

        get().dismissAlert();
      },

      acceptRisk: (alertId) => {
        const session = get().currentSession;
        if (session) {
          session.alertsActioned++;
        }
        get().hideRiskConfirmation();
        get().dismissAlert();
      },

      showRiskConfirmation: (alert) => {
        set({
          showRiskDialog: true,
          pendingRiskAlert: alert,
          state: 'alert',
          currentAlert: alert,
        });
      },

      hideRiskConfirmation: () => {
        set({
          showRiskDialog: false,
          pendingRiskAlert: null,
        });
      },

      removeDeferredItem: (itemId) => {
        set((state) => ({
          deferredItems: state.deferredItems.filter((item) => item.id !== itemId),
        }));
      },

      // ê³„ì‚°ëœ ê°’
      hasAlerts: () => {
        const state = get();
        return state.alertQueue.length > 0 || state.infoAlerts.length > 0;
      },

      getAlertCount: () => {
        return get().infoAlerts.length;
      },

      getDeferredCount: () => {
        return get().deferredItems.length;
      },

      getSessionStats: () => {
        return get().currentSession;
      },
    })),
    { name: 'hud-store' }
  )
);

// íˆ¬ëª…ë„ ìë™ ì¡°ì ˆ í›…
export function useOpacityAutoAdjust() {
  const { opacityState, lastInteractionTime, setOpacityState } = useHUDStore();

  useEffect(() => {
    const INACTIVE_TIMEOUT = 5 * 60 * 1000; // 5ë¶„
    const ACTIVE_TIMEOUT = 3000; // 3ì´ˆ

    const checkOpacity = () => {
      const now = Date.now();
      const timeSinceInteraction = now - lastInteractionTime;

      if (opacityState === 'active' && timeSinceInteraction > ACTIVE_TIMEOUT) {
        setOpacityState('default');
      } else if (opacityState === 'default' && timeSinceInteraction > INACTIVE_TIMEOUT) {
        setOpacityState('inactive');
      }
    };

    const interval = setInterval(checkOpacity, 1000);
    return () => clearInterval(interval);
  }, [opacityState, lastInteractionTime, setOpacityState]);

  const opacityValues = {
    active: 1.0,
    default: 0.8,
    inactive: 0.6,
  };

  return opacityValues[opacityState];
}
```

### 14.10 HUD Idle í™•ì¥ ì»´í¬ë„ŒíŠ¸ (Part 3.2)

```typescript
// src/components/hud/HUDIdleExpanded.tsx
import { motion, AnimatePresence } from 'framer-motion';
import { ChevronDown, ChevronUp, Clock, AlertCircle } from 'lucide-react';
import { useHUDStore, useOpacityAutoAdjust } from '@/stores/hudStore';
import { useMeetingStore } from '@/stores/meetingStore';
import { formatDuration } from '@/utils/date';

export function HUDIdleExpanded() {
  const isExpanded = useHUDStore((s) => s.isExpanded);
  const setExpanded = useHUDStore((s) => s.setExpanded);
  const recordInteraction = useHUDStore((s) => s.recordInteraction);
  const alertCount = useHUDStore((s) => s.getAlertCount());
  const deferredCount = useHUDStore((s) => s.getDeferredCount());
  const session = useHUDStore((s) => s.currentSession);

  const meeting = useMeetingStore((s) => s.currentMeeting);
  const opacity = useOpacityAutoAdjust();

  const elapsed = meeting ? Date.now() - meeting.startTime.getTime() : 0;

  return (
    <motion.div
      style={{ opacity }}
      onMouseEnter={recordInteraction}
      onClick={recordInteraction}
      className="w-[300px] bg-white/95 backdrop-blur-sm border border-gray-200
                 rounded-2xl shadow-md overflow-hidden transition-opacity"
    >
      {/* ê¸°ë³¸ Idle ë°” */}
      <div
        className="flex items-center gap-3 px-4 h-[60px] cursor-pointer
                   hover:bg-gray-50 transition-colors"
        onClick={() => setExpanded(!isExpanded)}
      >
        {/* ë…¹í™” í‘œì‹œë“± */}
        <div className="relative">
          <div className="w-3 h-3 bg-green-500 rounded-full" />
          <div className="absolute inset-0 w-3 h-3 bg-green-500 rounded-full
                          animate-ping opacity-75" />
        </div>

        {/* ê²½ê³¼ ì‹œê°„ */}
        <span className="text-base font-medium text-gray-700">
          {formatDuration(elapsed)}
        </span>

        {/* ë°°ì§€ë“¤ */}
        <div className="ml-auto flex items-center gap-2">
          {/* ì—°ê¸°ëœ í•­ëª© ë°°ì§€ */}
          {deferredCount > 0 && (
            <span className="min-w-[24px] h-6 px-2 flex items-center justify-center
                           bg-amber-100 text-amber-700 text-xs font-semibold rounded-full">
              {deferredCount}
            </span>
          )}

          {/* ì•Œë¦¼ ë°°ì§€ */}
          {alertCount > 0 && (
            <span className="min-w-[24px] h-6 px-2 flex items-center justify-center
                           bg-blue-500 text-white text-xs font-semibold rounded-full">
              {alertCount}
            </span>
          )}

          {/* í™•ì¥ í† ê¸€ */}
          {isExpanded ? (
            <ChevronUp size={18} className="text-gray-400" />
          ) : (
            <ChevronDown size={18} className="text-gray-400" />
          )}
        </div>
      </div>

      {/* í™•ì¥ëœ ì½˜í…ì¸  */}
      <AnimatePresence>
        {isExpanded && (
          <motion.div
            initial={{ height: 0, opacity: 0 }}
            animate={{ height: 'auto', opacity: 1 }}
            exit={{ height: 0, opacity: 0 }}
            transition={{ duration: 0.2 }}
            className="border-t border-gray-100"
          >
            <div className="p-4 space-y-3">
              {/* ì„¸ì…˜ í†µê³„ */}
              {session && (
                <div className="grid grid-cols-2 gap-2 text-sm">
                  <div className="flex items-center gap-2 text-gray-600">
                    <AlertCircle size={14} />
                    <span>ì•Œë¦¼: {session.totalAlerts.level1 + session.totalAlerts.level2 + session.totalAlerts.level3}</span>
                  </div>
                  <div className="flex items-center gap-2 text-gray-600">
                    <Clock size={14} />
                    <span>ì²˜ë¦¬: {session.alertsActioned}</span>
                  </div>
                </div>
              )}

              {/* ì—°ê¸°ëœ í•­ëª© ë¯¸ë¦¬ë³´ê¸° */}
              {deferredCount > 0 && (
                <DeferredItemsPreview />
              )}
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </motion.div>
  );
}

// ì—°ê¸°ëœ í•­ëª© ë¯¸ë¦¬ë³´ê¸° ì»´í¬ë„ŒíŠ¸
function DeferredItemsPreview() {
  const deferredItems = useHUDStore((s) => s.deferredItems);
  const removeDeferredItem = useHUDStore((s) => s.removeDeferredItem);

  return (
    <div className="space-y-2">
      <div className="text-xs font-medium text-gray-500 uppercase">
        ë‚˜ì¤‘ì— í•  ì§ˆë¬¸
      </div>
      {deferredItems.slice(0, 3).map((item) => (
        <div
          key={item.id}
          className="flex items-start gap-2 p-2 bg-amber-50 rounded-lg text-sm"
        >
          <span className="flex-1 text-gray-700 line-clamp-2">
            {item.question}
          </span>
          <button
            onClick={() => {
              navigator.clipboard.writeText(item.question);
              removeDeferredItem(item.id);
            }}
            className="text-amber-600 hover:text-amber-700 text-xs font-medium
                       whitespace-nowrap"
          >
            ë³µì‚¬
          </button>
        </div>
      ))}
    </div>
  );
}
```

### 14.11 ì•Œë¦¼ ì¹´ë“œ ê³ ë„í™” (Part 3.3)

```typescript
// src/components/hud/HUDAlertCard.tsx
import { motion } from 'framer-motion';
import { ArrowRight, Clock, AlertTriangle, Lightbulb, CheckCircle } from 'lucide-react';
import { Alert } from '@/stores/hudStore';
import { useAnalytics } from '@/hooks/useAnalytics';

interface HUDAlertCardProps {
  alert: Alert;
  onAsk: () => void;
  onLater: () => void;
  onDismiss: () => void;
  timeRemaining?: number; // ì´ˆ ë‹¨ìœ„
}

// ì¹´í…Œê³ ë¦¬ë³„ ì•„ì´ì½˜ ë° ìƒ‰ìƒ
const CATEGORY_STYLES = {
  gap: {
    icon: Lightbulb,
    bg: 'bg-blue-50',
    border: 'border-blue-200',
    iconColor: 'text-blue-500',
    buttonBg: 'bg-blue-500 hover:bg-blue-600',
  },
  decision: {
    icon: CheckCircle,
    bg: 'bg-green-50',
    border: 'border-green-200',
    iconColor: 'text-green-500',
    buttonBg: 'bg-green-500 hover:bg-green-600',
  },
  action: {
    icon: ArrowRight,
    bg: 'bg-purple-50',
    border: 'border-purple-200',
    iconColor: 'text-purple-500',
    buttonBg: 'bg-purple-500 hover:bg-purple-600',
  },
  risk: {
    icon: AlertTriangle,
    bg: 'bg-red-50',
    border: 'border-red-200',
    iconColor: 'text-red-500',
    buttonBg: 'bg-red-500 hover:bg-red-600',
  },
};

export function HUDAlertCard({
  alert,
  onAsk,
  onLater,
  onDismiss,
  timeRemaining = 10,
}: HUDAlertCardProps) {
  const { trackEvent } = useAnalytics();
  const style = CATEGORY_STYLES[alert.category];
  const Icon = style.icon;

  const handleAsk = () => {
    trackEvent('alert_ask_clicked', {
      alertId: alert.id,
      category: alert.category,
      level: alert.level,
    });
    onAsk();
  };

  const handleLater = () => {
    trackEvent('alert_later_clicked', {
      alertId: alert.id,
      category: alert.category,
    });
    onLater();
  };

  return (
    <motion.div
      initial={{ opacity: 0, scale: 0.95, y: -20 }}
      animate={{ opacity: 1, scale: 1, y: 0 }}
      exit={{ opacity: 0, scale: 0.95, y: -20 }}
      className={`w-[320px] ${style.bg} border ${style.border} rounded-2xl
                  shadow-lg overflow-hidden`}
    >
      {/* íƒ€ì´ë° ì¸ë””ì¼€ì´í„° */}
      <div className="h-1 bg-gray-200">
        <motion.div
          className="h-full bg-gray-400"
          initial={{ width: '100%' }}
          animate={{ width: '0%' }}
          transition={{ duration: timeRemaining, ease: 'linear' }}
        />
      </div>

      {/* í—¤ë” */}
      <div className="flex items-start gap-3 p-4 pb-2">
        <div className={`p-2 rounded-full ${style.bg}`}>
          <Icon size={18} className={style.iconColor} />
        </div>
        <div className="flex-1">
          <h4 className="font-medium text-gray-800">{alert.title}</h4>
          <p className="text-sm text-gray-600 mt-1">{alert.message}</p>
        </div>
      </div>

      {/* ì¶”ì²œ ì§ˆë¬¸ */}
      {alert.suggestedQuestion && (
        <div className="mx-4 p-3 bg-white rounded-lg border border-gray-200">
          <p className="text-xs text-gray-500 mb-1">ì¶”ì²œ ì§ˆë¬¸</p>
          <p className="text-sm text-gray-800 font-medium">
            "{alert.suggestedQuestion}"
          </p>
        </div>
      )}

      {/* ê·¼ê±° (ìˆëŠ” ê²½ìš°) */}
      {alert.reason && alert.reason.length > 0 && (
        <div className="mx-4 mt-2">
          <p className="text-xs text-gray-500">ê·¼ê±°:</p>
          <ul className="text-xs text-gray-600 mt-1 space-y-1">
            {alert.reason.map((r, i) => (
              <li key={i} className="flex items-start gap-1">
                <span className="text-gray-400">â€¢</span>
                <span>{r}</span>
              </li>
            ))}
          </ul>
        </div>
      )}

      {/* ë²„íŠ¼ ì˜ì—­ */}
      <div className="flex gap-2 p-4 pt-3">
        <button
          onClick={handleAsk}
          className={`flex-1 flex items-center justify-center gap-2 px-4 py-2.5
                     ${style.buttonBg} text-white text-sm font-medium
                     rounded-lg transition-colors`}
        >
          <span>ì§ˆë¬¸í•˜ê¸°</span>
          <ArrowRight size={16} />
        </button>
        <button
          onClick={handleLater}
          className="flex items-center gap-1 px-3 py-2.5 text-gray-600 text-sm
                     hover:bg-gray-100 rounded-lg transition-colors"
        >
          <Clock size={14} />
          <span>ë‚˜ì¤‘ì—</span>
        </button>
      </div>
    </motion.div>
  );
}
```

### 14.12 ìœ„í—˜ ê°ìˆ˜ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ (Part 3.4)

```typescript
// src/components/hud/RiskAcceptanceDialog.tsx
import { motion, AnimatePresence } from 'framer-motion';
import { AlertTriangle, X } from 'lucide-react';
import { useHUDStore } from '@/stores/hudStore';
import { useAnalytics } from '@/hooks/useAnalytics';

export function RiskAcceptanceDialog() {
  const { showRiskDialog, pendingRiskAlert, hideRiskConfirmation, acceptRisk, askQuestion } = useHUDStore();
  const { trackEvent } = useAnalytics();

  if (!showRiskDialog || !pendingRiskAlert) return null;

  const handleAsk = () => {
    trackEvent('risk_question_asked', { alertId: pendingRiskAlert.id });
    askQuestion(pendingRiskAlert.id);
  };

  const handleAcceptRisk = () => {
    trackEvent('alert_risk_accepted', { alertId: pendingRiskAlert.id });
    acceptRisk(pendingRiskAlert.id);
  };

  const handleDismiss = () => {
    trackEvent('risk_dialog_dismissed', { alertId: pendingRiskAlert.id });
    hideRiskConfirmation();
  };

  return (
    <AnimatePresence>
      <motion.div
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        exit={{ opacity: 0 }}
        className="fixed inset-0 z-[10000] flex items-center justify-center
                   bg-black/30 backdrop-blur-sm"
        onClick={handleDismiss}
      >
        <motion.div
          initial={{ scale: 0.95, y: 20 }}
          animate={{ scale: 1, y: 0 }}
          exit={{ scale: 0.95, y: 20 }}
          onClick={(e) => e.stopPropagation()}
          className="w-[400px] bg-white rounded-2xl shadow-xl overflow-hidden"
        >
          {/* í—¤ë” */}
          <div className="flex items-center justify-between px-6 py-4 bg-red-50 border-b border-red-100">
            <div className="flex items-center gap-3">
              <div className="p-2 bg-red-100 rounded-full">
                <AlertTriangle size={20} className="text-red-600" />
              </div>
              <h3 className="text-lg font-semibold text-gray-800">
                ì¤‘ìš” ì •ë³´ ëˆ„ë½ ê°ì§€
              </h3>
            </div>
            <button
              onClick={handleDismiss}
              className="p-1 hover:bg-red-100 rounded-full transition-colors"
            >
              <X size={20} className="text-gray-500" />
            </button>
          </div>

          {/* ë³¸ë¬¸ */}
          <div className="p-6">
            <p className="text-gray-700 mb-4">{pendingRiskAlert.message}</p>

            {/* ì¶”ì²œ ì§ˆë¬¸ */}
            {pendingRiskAlert.suggestedQuestion && (
              <div className="p-4 bg-gray-50 rounded-lg mb-4">
                <p className="text-xs text-gray-500 mb-2">ì´ ì§ˆë¬¸ìœ¼ë¡œ í™•ì¸í•˜ì„¸ìš”:</p>
                <p className="text-sm font-medium text-gray-800">
                  "{pendingRiskAlert.suggestedQuestion}"
                </p>
              </div>
            )}

            {/* ê·¼ê±° */}
            {pendingRiskAlert.reason && pendingRiskAlert.reason.length > 0 && (
              <div className="mb-4">
                <p className="text-xs font-medium text-gray-500 mb-2">ê°ì§€ ê·¼ê±°:</p>
                <ul className="space-y-1">
                  {pendingRiskAlert.reason.map((r, i) => (
                    <li key={i} className="flex items-start gap-2 text-sm text-gray-600">
                      <span className="text-red-400 mt-1">â€¢</span>
                      <span>{r}</span>
                    </li>
                  ))}
                </ul>
              </div>
            )}

            {/* ê²½ê³  ë©”ì‹œì§€ */}
            <div className="p-3 bg-amber-50 border border-amber-200 rounded-lg">
              <p className="text-sm text-amber-800">
                ì´ ì •ë³´ê°€ í™•ì •ë˜ì§€ ì•Šìœ¼ë©´ ë‚˜ì¤‘ì— ë¬¸ì œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                ì •ë§ ì§ˆë¬¸í•˜ì§€ ì•Šê³  ë„˜ì–´ê°€ì‹œê² ìŠµë‹ˆê¹Œ?
              </p>
            </div>
          </div>

          {/* ë²„íŠ¼ ì˜ì—­ */}
          <div className="flex gap-3 px-6 py-4 bg-gray-50 border-t border-gray-100">
            <button
              onClick={handleAsk}
              className="flex-1 px-4 py-3 bg-red-500 text-white font-medium
                         rounded-lg hover:bg-red-600 transition-colors"
            >
              ì§€ê¸ˆ ì§ˆë¬¸í•˜ê¸°
            </button>
            <button
              onClick={handleAcceptRisk}
              className="px-4 py-3 text-gray-600 font-medium
                         hover:bg-gray-100 rounded-lg transition-colors"
            >
              ìœ„í—˜ ê°ìˆ˜í•˜ê³  ë„˜ì–´ê°€ê¸°
            </button>
          </div>
        </motion.div>
      </motion.div>
    </AnimatePresence>
  );
}
```

### 14.13 ì§ˆë¬¸ ìˆ˜í–‰ í”¼ë“œë°± ì»´í¬ë„ŒíŠ¸ (Part 3.4)

```typescript
// src/components/hud/QuestionFeedback.tsx
import { motion, AnimatePresence } from 'framer-motion';
import { CheckCircle, Copy, Mic } from 'lucide-react';
import { useState, useEffect } from 'react';

interface QuestionFeedbackProps {
  question: string;
  onComplete: () => void;
}

type FeedbackStep = 'copied' | 'speaking' | 'complete';

export function QuestionFeedback({ question, onComplete }: QuestionFeedbackProps) {
  const [step, setStep] = useState<FeedbackStep>('copied');

  useEffect(() => {
    // ë³µì‚¬ë¨ â†’ ë§í•˜ëŠ” ì¤‘ (1ì´ˆ í›„)
    const timer1 = setTimeout(() => setStep('speaking'), 1000);

    // ë§í•˜ëŠ” ì¤‘ â†’ ì™„ë£Œ (3ì´ˆ í›„)
    const timer2 = setTimeout(() => setStep('complete'), 4000);

    // ì™„ë£Œ í›„ ìë™ ë‹«í˜ (5ì´ˆ í›„)
    const timer3 = setTimeout(() => onComplete(), 5500);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
      clearTimeout(timer3);
    };
  }, [onComplete]);

  const stepConfig = {
    copied: {
      icon: Copy,
      title: 'ì§ˆë¬¸ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤',
      subtitle: 'ë¯¸íŒ…ì—ì„œ ì§ˆë¬¸í•´ì£¼ì„¸ìš”',
      color: 'text-blue-500',
      bg: 'bg-blue-50',
    },
    speaking: {
      icon: Mic,
      title: 'ì§ˆë¬¸ ì¤‘...',
      subtitle: question,
      color: 'text-purple-500',
      bg: 'bg-purple-50',
    },
    complete: {
      icon: CheckCircle,
      title: 'ì§ˆë¬¸ ì™„ë£Œ',
      subtitle: 'AIê°€ ë‹µë³€ì„ ë¶„ì„í•©ë‹ˆë‹¤',
      color: 'text-green-500',
      bg: 'bg-green-50',
    },
  };

  const current = stepConfig[step];
  const Icon = current.icon;

  return (
    <AnimatePresence mode="wait">
      <motion.div
        key={step}
        initial={{ opacity: 0, y: 10 }}
        animate={{ opacity: 1, y: 0 }}
        exit={{ opacity: 0, y: -10 }}
        className={`w-[300px] ${current.bg} rounded-2xl shadow-lg p-4`}
      >
        <div className="flex items-center gap-3">
          <div className={`p-2 rounded-full bg-white`}>
            <Icon size={20} className={current.color} />
          </div>
          <div className="flex-1">
            <p className="font-medium text-gray-800">{current.title}</p>
            <p className="text-sm text-gray-600 line-clamp-2">
              {current.subtitle}
            </p>
          </div>
        </div>

        {/* Speaking ìƒíƒœì¼ ë•Œ íŒŒë™ ì• ë‹ˆë©”ì´ì…˜ */}
        {step === 'speaking' && (
          <div className="flex justify-center gap-1 mt-3">
            {[0, 1, 2, 3, 4].map((i) => (
              <motion.div
                key={i}
                className="w-1 bg-purple-400 rounded-full"
                animate={{
                  height: [12, 24, 12],
                }}
                transition={{
                  duration: 0.5,
                  repeat: Infinity,
                  delay: i * 0.1,
                }}
              />
            ))}
          </div>
        )}
      </motion.div>
    </AnimatePresence>
  );
}
```

#### ì´ë²¤íŠ¸ ë¡œê¹… íƒ€ì… (Part 3)

```typescript
// src/types/analytics-part3.ts

// Part 3.1: ìë™ ì‹œì‘ ì´ë²¤íŠ¸ íƒ€ì…
export type AutoStartEventType =
  | 'meeting_detected'           // ë¯¸íŒ… í”Œë«í¼ ê°ì§€
  | 'meeting_prompt_shown'       // ì‹œì‘ í”„ë¡¬í”„íŠ¸ í‘œì‹œ
  | 'meeting_auto_started'       // ìë™ ì‹œì‘ ì™„ë£Œ
  | 'meeting_start_clicked'      // ìˆ˜ë™ ì‹œì‘ í´ë¦­
  | 'meeting_prompt_dismissed'   // í”„ë¡¬í”„íŠ¸ ë‹«í˜
  | 'meeting_ended';             // ë¯¸íŒ… ì¢…ë£Œ

export interface AutoStartMetadata {
  platform: 'zoom' | 'meet' | 'teams';
  meetingUrl?: string;
  autoStarted: boolean;
  timeToStart: number; // ê°ì§€ â†’ ì‹œì‘ê¹Œì§€ ì‹œê°„
}

// Part 3.2: HUD Idle ì´ë²¤íŠ¸ íƒ€ì…
export type HUDIdleEventType =
  | 'hud_idle_shown'            // Idle ìƒíƒœ í‘œì‹œ
  | 'hud_idle_expanded'         // Idle í™•ì¥
  | 'hud_idle_collapsed'        // Idle ì¶•ì†Œ
  | 'hud_opacity_changed'       // íˆ¬ëª…ë„ ë³€ê²½
  | 'hud_interaction';          // ì‚¬ìš©ì ìƒí˜¸ì‘ìš©

export interface HUDIdleMetadata {
  expandedDuration?: number;
  opacityState: 'active' | 'default' | 'inactive';
  idleRatio: number; // idle ì‹œê°„ / ì „ì²´ ì‹œê°„
}

// Part 3.3: ì•Œë¦¼ ì´ë²¤íŠ¸ íƒ€ì…
export type AlertEventType =
  | 'alert_shown'               // ì•Œë¦¼ í‘œì‹œ
  | 'alert_ask_clicked'         // [ì§ˆë¬¸í•˜ê¸°] í´ë¦­
  | 'alert_later_clicked'       // [ë‚˜ì¤‘ì—] í´ë¦­
  | 'alert_risk_accepted'       // ìœ„í—˜ ê°ìˆ˜ ì„ íƒ
  | 'alert_timeout'             // ì•Œë¦¼ íƒ€ì„ì•„ì›ƒ
  | 'alert_dismissed';          // ì•Œë¦¼ ë‹«í˜

export interface AlertMetadata {
  alertId: string;
  level: 1 | 2 | 3;
  category: 'gap' | 'decision' | 'action' | 'risk';
  timeToAction?: number; // ì•Œë¦¼ í‘œì‹œ â†’ ì•¡ì…˜ê¹Œì§€ ì‹œê°„
  suggestedQuestion?: string;
  reasonCount?: number;
}

// Part 3.4: ì‚¬ìš©ì ì‘ë‹µ ì´ë²¤íŠ¸ íƒ€ì…
export type ResponseEventType =
  | 'question_copied'           // ì§ˆë¬¸ ë³µì‚¬
  | 'question_asked'            // ì§ˆë¬¸ ìˆ˜í–‰ (ì¶”ì •)
  | 'answer_detected'           // ë‹µë³€ ê°ì§€ (AI)
  | 'gap_resolved'              // Gap í•´ê²°
  | 'deferred_item_added'       // ì—°ê¸° í•­ëª© ì¶”ê°€
  | 'deferred_item_resolved'    // ì—°ê¸° í•­ëª© í•´ê²°
  | 'risk_dialog_shown'         // ìœ„í—˜ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
  | 'risk_question_asked'       // ìœ„í—˜ ê´€ë ¨ ì§ˆë¬¸
  | 'risk_accepted';            // ìœ„í—˜ ê°ìˆ˜

export interface ResponseMetadata {
  alertId?: string;
  question?: string;
  deferredCount?: number;
  gapResolved?: boolean;
  riskLevel?: number;
}

// Part 3 ë¯¸íŒ… ì¢…ë£Œ ë©”íƒ€ë°ì´í„°
export interface MeetingEndMetadata {
  meetingId: string;
  duration: number;
  platform: 'zoom' | 'meet' | 'teams';
  totalAlerts: { level1: number; level2: number; level3: number };
  alertsActioned: number;
  alertsDeferred: number;
  alertsIgnored: number;
  gapsIdentified: number;
  gapsResolved: number;
  risksAccepted: number;
  idleRatio: number;
}

// Part 3 í•µì‹¬ ì§€í‘œ
export const part3Metrics = {
  // ìë™ ì‹œì‘ë¥ 
  autoStartRate: 'count(meeting_auto_started) / count(meeting_detected)',
  // ëª©í‘œ: > 90%

  // í‰ê·  Idle ë¹„ìœ¨
  avgIdleRatio: 'avg(idleRatio WHERE meeting_ended)',
  // ëª©í‘œ: > 95%

  // ì•Œë¦¼ ì‹¤í–‰ë¥ 
  alertActionRate: 'count(alert_ask_clicked) / count(alert_shown WHERE level >= 2)',
  // ëª©í‘œ: > 50%

  // Gap í•´ê²°ë¥ 
  gapResolutionRate: 'count(gap_resolved) / count(alert_shown WHERE category = gap)',
  // ëª©í‘œ: > 70%

  // ì—°ê¸° ì™„ë£Œìœ¨
  deferredCompletionRate: 'count(deferred_item_resolved) / count(deferred_item_added)',
  // ëª©í‘œ: > 80%

  // ìœ„í—˜ ê°ìˆ˜ìœ¨ (ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ)
  riskAcceptanceRate: 'count(risk_accepted) / count(risk_dialog_shown)',
  // ëª©í‘œ: < 20%

  // í‰ê·  ì‘ë‹µ ì‹œê°„
  avgResponseTime: 'avg(timeToAction WHERE alert_ask_clicked)',
  // ëª©í‘œ: < 5ì´ˆ
};
```

### 14.14 Part 3 Analytics Hook í™•ì¥

```typescript
// src/hooks/useAnalytics.ts (Part 3 í™•ì¥)

// ê¸°ì¡´ useAnalyticsì— ì¶”ê°€í•  Part 3 íŠ¸ë˜í‚¹ í•¨ìˆ˜ë“¤
export function useHUDAnalytics() {
  const { trackEvent } = useAnalytics();

  // Part 3.1: ìë™ ì‹œì‘ ì´ë²¤íŠ¸
  const trackMeetingDetected = (platform: string, url: string) =>
    trackEvent('meeting_detected', { platform, url });

  const trackMeetingAutoStarted = (platform: string, timeToStart: number) =>
    trackEvent('meeting_auto_started', { platform, timeToStart, autoStarted: true });

  const trackMeetingStartClicked = (platform: string) =>
    trackEvent('meeting_start_clicked', { platform, autoStarted: false });

  const trackMeetingEnded = (metadata: MeetingEndMetadata) =>
    trackEvent('meeting_ended', metadata);

  // Part 3.2: HUD Idle ì´ë²¤íŠ¸
  const trackHUDIdleShown = () =>
    trackEvent('hud_idle_shown');

  const trackHUDExpanded = () =>
    trackEvent('hud_idle_expanded');

  const trackHUDCollapsed = (expandedDuration: number) =>
    trackEvent('hud_idle_collapsed', { expandedDuration });

  const trackOpacityChanged = (opacityState: string) =>
    trackEvent('hud_opacity_changed', { opacityState });

  // Part 3.3: ì•Œë¦¼ ì´ë²¤íŠ¸
  const trackAlertShown = (metadata: AlertMetadata) =>
    trackEvent('alert_shown', metadata);

  const trackAlertAskClicked = (alertId: string, timeToAction: number) =>
    trackEvent('alert_ask_clicked', { alertId, timeToAction });

  const trackAlertLaterClicked = (alertId: string) =>
    trackEvent('alert_later_clicked', { alertId });

  const trackAlertRiskAccepted = (alertId: string) =>
    trackEvent('alert_risk_accepted', { alertId });

  const trackAlertTimeout = (alertId: string) =>
    trackEvent('alert_timeout', { alertId });

  // Part 3.4: ì‚¬ìš©ì ì‘ë‹µ ì´ë²¤íŠ¸
  const trackQuestionCopied = (question: string) =>
    trackEvent('question_copied', { question });

  const trackGapResolved = (alertId: string) =>
    trackEvent('gap_resolved', { alertId, gapResolved: true });

  const trackDeferredItemAdded = (alertId: string, deferredCount: number) =>
    trackEvent('deferred_item_added', { alertId, deferredCount });

  const trackDeferredItemResolved = (itemId: string) =>
    trackEvent('deferred_item_resolved', { itemId });

  const trackRiskDialogShown = (alertId: string) =>
    trackEvent('risk_dialog_shown', { alertId });

  return {
    // Part 3.1
    trackMeetingDetected,
    trackMeetingAutoStarted,
    trackMeetingStartClicked,
    trackMeetingEnded,
    // Part 3.2
    trackHUDIdleShown,
    trackHUDExpanded,
    trackHUDCollapsed,
    trackOpacityChanged,
    // Part 3.3
    trackAlertShown,
    trackAlertAskClicked,
    trackAlertLaterClicked,
    trackAlertRiskAccepted,
    trackAlertTimeout,
    // Part 3.4
    trackQuestionCopied,
    trackGapResolved,
    trackDeferredItemAdded,
    trackDeferredItemResolved,
    trackRiskDialogShown,
  };
}
```

### 14.15 í™•ì • ëª¨ë‹¬ Store (Part 4)

```typescript
// src/stores/confirmationStore.ts (Part 4)

import { create } from 'zustand';
import { immer } from 'zustand/middleware/immer';

// Part 4 ìƒíƒœ íƒ€ì…
interface Decision {
  id: string;
  content: string;
  assignee: string | null;
  deadline: string | null;
  isComplete: boolean;        // ë¹ˆì¹¸ ì—†ì´ ëª¨ë‘ ì±„ì›Œì¡ŒëŠ”ì§€
  isEdited: boolean;          // ì‚¬ìš©ìê°€ ìˆ˜ì •í–ˆëŠ”ì§€
}

interface ConfirmationState {
  // Part 4.1: ì „í™˜ ìƒíƒœ
  isTransitioning: boolean;
  transitionPhase: 'idle' | 'hud_fadeout' | 'delay' | 'modal_fadein';

  // Part 4.2: í™•ì • ëª¨ë‹¬ ìƒíƒœ
  isModalOpen: boolean;
  modalState: 'reviewing' | 'filling' | 'ready' | 'saving' | 'complete' | 'error';
  meeting: {
    id: string;
    title: string;
    startTime: Date;
    endTime: Date;
    duration: number;
  } | null;
  decisions: Decision[];
  insights: string[];
  totalGaps: number;
  filledGaps: number;

  // Part 4.3: Notion í†µí•© ìƒíƒœ
  saveToNotion: boolean;
  notionSaveStatus: 'idle' | 'saving' | 'success' | 'error';
  notionPageUrl: string | null;
  notionError: string | null;

  // Part 4: ì™„ë£Œ í™”ë©´ ìƒíƒœ
  showCompletionScreen: boolean;
  autoRedirectCountdown: number;
}

interface ConfirmationActions {
  // Part 4.1: ì „í™˜ ì•¡ì…˜
  startTransition: (meeting: ConfirmationState['meeting']) => void;
  setTransitionPhase: (phase: ConfirmationState['transitionPhase']) => void;

  // Part 4.2: ëª¨ë‹¬ ì•¡ì…˜
  openModal: () => void;
  closeModal: () => void;
  updateDecision: (id: string, updates: Partial<Decision>) => void;
  addDecision: (content: string) => void;
  deleteDecision: (id: string) => void;
  fillGap: (decisionId: string, field: 'assignee' | 'deadline', value: string) => void;

  // Part 4.3: ì €ì¥ ì•¡ì…˜
  toggleNotionSave: () => void;
  confirmAndSave: () => Promise<void>;
  retryNotionSave: () => Promise<void>;

  // Part 4: ì™„ë£Œ ì•¡ì…˜
  showCompletion: () => void;
  startAutoRedirect: () => void;
  navigateToNotion: () => void;
  navigateToToday: () => void;

  // ë¦¬ì…‹
  reset: () => void;
}

const initialState: ConfirmationState = {
  isTransitioning: false,
  transitionPhase: 'idle',
  isModalOpen: false,
  modalState: 'reviewing',
  meeting: null,
  decisions: [],
  insights: [],
  totalGaps: 0,
  filledGaps: 0,
  saveToNotion: true,  // ê¸°ë³¸ê°’ ON (Default Effect)
  notionSaveStatus: 'idle',
  notionPageUrl: null,
  notionError: null,
  showCompletionScreen: false,
  autoRedirectCountdown: 3,
};

export const useConfirmationStore = create<ConfirmationState & ConfirmationActions>()(
  immer((set, get) => ({
    ...initialState,

    // Part 4.1: ì „í™˜ ì•¡ì…˜
    startTransition: (meeting) => {
      set((state) => {
        state.isTransitioning = true;
        state.transitionPhase = 'hud_fadeout';
        state.meeting = meeting;
      });

      // ì „í™˜ ì‹œí€€ìŠ¤ ì‹¤í–‰
      setTimeout(() => {
        set((state) => { state.transitionPhase = 'delay'; });
      }, 200);  // HUD fadeout ì™„ë£Œ

      setTimeout(() => {
        set((state) => {
          state.transitionPhase = 'modal_fadein';
          state.isModalOpen = true;
        });
      }, 700);  // delay ì™„ë£Œ

      setTimeout(() => {
        set((state) => {
          state.transitionPhase = 'idle';
          state.isTransitioning = false;
        });
      }, 1100);  // modal fadein ì™„ë£Œ
    },

    setTransitionPhase: (phase) => {
      set((state) => { state.transitionPhase = phase; });
    },

    // Part 4.2: ëª¨ë‹¬ ì•¡ì…˜
    openModal: () => {
      set((state) => { state.isModalOpen = true; });
    },

    closeModal: () => {
      set((state) => { state.isModalOpen = false; });
    },

    updateDecision: (id, updates) => {
      set((state) => {
        const decision = state.decisions.find(d => d.id === id);
        if (decision) {
          Object.assign(decision, updates);
          decision.isEdited = true;

          // ë¹ˆì¹¸ ìƒíƒœ ì¬ê³„ì‚°
          decision.isComplete = !!decision.assignee && !!decision.deadline;
          state.filledGaps = state.decisions.filter(d => d.isComplete).length;

          // ëª¨ë‹¬ ìƒíƒœ ì—…ë°ì´íŠ¸
          if (state.filledGaps === state.totalGaps) {
            state.modalState = 'ready';
          } else {
            state.modalState = 'filling';
          }
        }
      });
    },

    addDecision: (content) => {
      set((state) => {
        state.decisions.push({
          id: `decision-${Date.now()}`,
          content,
          assignee: null,
          deadline: null,
          isComplete: false,
          isEdited: false,
        });
        state.totalGaps += 1;
      });
    },

    deleteDecision: (id) => {
      set((state) => {
        const idx = state.decisions.findIndex(d => d.id === id);
        if (idx !== -1) {
          const wasComplete = state.decisions[idx].isComplete;
          state.decisions.splice(idx, 1);
          if (!wasComplete) {
            state.totalGaps -= 1;
          } else {
            state.filledGaps -= 1;
            state.totalGaps -= 1;
          }
        }
      });
    },

    fillGap: (decisionId, field, value) => {
      const { updateDecision } = get();
      updateDecision(decisionId, { [field]: value });
    },

    // Part 4.3: ì €ì¥ ì•¡ì…˜
    toggleNotionSave: () => {
      set((state) => {
        state.saveToNotion = !state.saveToNotion;
      });
    },

    confirmAndSave: async () => {
      const { meeting, decisions, insights, saveToNotion } = get();

      set((state) => { state.modalState = 'saving'; });

      try {
        // ë¡œì»¬ ì €ì¥ (í•­ìƒ)
        await saveMeetingLocally({
          meeting,
          decisions,
          insights,
        });

        // Notion ì €ì¥ (ì„ íƒì )
        if (saveToNotion) {
          set((state) => { state.notionSaveStatus = 'saving'; });

          const result = await saveToNotionAPI({
            meeting,
            decisions,
            insights,
          });

          set((state) => {
            state.notionSaveStatus = 'success';
            state.notionPageUrl = result.pageUrl;
          });
        }

        set((state) => {
          state.modalState = 'complete';
          state.showCompletionScreen = true;
        });

        // ìë™ ë¦¬ë””ë ‰íŠ¸ ì‹œì‘
        get().startAutoRedirect();

      } catch (error) {
        set((state) => {
          state.modalState = 'error';
          state.notionSaveStatus = 'error';
          state.notionError = error instanceof Error ? error.message : 'ì €ì¥ ì‹¤íŒ¨';
        });
      }
    },

    retryNotionSave: async () => {
      const { meeting, decisions, insights } = get();

      set((state) => { state.notionSaveStatus = 'saving'; });

      try {
        const result = await saveToNotionAPI({ meeting, decisions, insights });

        set((state) => {
          state.notionSaveStatus = 'success';
          state.notionPageUrl = result.pageUrl;
          state.notionError = null;
        });
      } catch (error) {
        set((state) => {
          state.notionSaveStatus = 'error';
          state.notionError = error instanceof Error ? error.message : 'ì¬ì‹œë„ ì‹¤íŒ¨';
        });
      }
    },

    // Part 4: ì™„ë£Œ ì•¡ì…˜
    showCompletion: () => {
      set((state) => { state.showCompletionScreen = true; });
    },

    startAutoRedirect: () => {
      const countdown = setInterval(() => {
        set((state) => {
          state.autoRedirectCountdown -= 1;
          if (state.autoRedirectCountdown <= 0) {
            clearInterval(countdown);
            get().navigateToToday();
          }
        });
      }, 1000);
    },

    navigateToNotion: () => {
      const { notionPageUrl } = get();
      if (notionPageUrl) {
        window.open(notionPageUrl, '_blank');
      }
    },

    navigateToToday: () => {
      get().reset();
      // ë¼ìš°í„° ë„¤ë¹„ê²Œì´ì…˜
      window.location.hash = '#/today';
    },

    reset: () => {
      set(initialState);
    },
  }))
);

// Helper í•¨ìˆ˜ë“¤
async function saveMeetingLocally(data: any): Promise<void> {
  // IndexedDB ë˜ëŠ” ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
  const db = await openMeetingDB();
  await db.put('meetings', data);
}

async function saveToNotionAPI(data: any): Promise<{ pageUrl: string }> {
  const response = await fetch('/api/notion/save', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data),
  });

  if (!response.ok) {
    throw new Error('Notion ì €ì¥ ì‹¤íŒ¨');
  }

  return response.json();
}
```

### 14.16 í™•ì • ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸ (Part 4.2)

```tsx
// src/components/confirmation/ConfirmationModal.tsx

import { motion, AnimatePresence } from 'framer-motion';
import { useConfirmationStore } from '@/stores/confirmationStore';
import { DecisionCard } from './DecisionCard';
import { GapField } from './GapField';
import { NotionSection } from './NotionSection';
import { ConfirmButton } from './ConfirmButton';

export function ConfirmationModal() {
  const {
    isModalOpen,
    modalState,
    meeting,
    decisions,
    insights,
    totalGaps,
    filledGaps,
    closeModal,
  } = useConfirmationStore();

  if (!meeting) return null;

  const progressPercent = totalGaps > 0
    ? Math.round((filledGaps / totalGaps) * 100)
    : 100;

  return (
    <AnimatePresence>
      {isModalOpen && (
        <>
          {/* Overlay */}
          <motion.div
            className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[10000]"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.15 }}
            onClick={() => {/* ë‚˜ì¤‘ì— ì²˜ë¦¬ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ */}}
          />

          {/* Modal */}
          <motion.div
            className="fixed inset-0 flex items-center justify-center z-[10001] p-4"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
          >
            <motion.div
              className="w-full max-w-[480px] max-h-[80vh] bg-white rounded-2xl shadow-xl overflow-hidden"
              initial={{ scale: 0.97, y: 20, opacity: 0 }}
              animate={{ scale: 1, y: 0, opacity: 1 }}
              exit={{ scale: 0.97, y: 20, opacity: 0 }}
              transition={{
                type: 'spring',
                damping: 25,
                stiffness: 300,
              }}
            >
              {/* Header */}
              <div className="sticky top-0 bg-gray-50 border-b border-gray-200 p-5">
                <div className="flex items-start justify-between">
                  <div>
                    <h2 className="text-xl font-bold text-gray-900 flex items-center gap-2">
                      <span>ğŸ“‹</span>
                      {meeting.title}
                    </h2>
                    <p className="text-sm text-gray-500 mt-1">
                      {formatMeetingTime(meeting.startTime, meeting.endTime, meeting.duration)}
                    </p>
                  </div>

                  <button
                    onClick={closeModal}
                    className="p-2 hover:bg-gray-200 rounded-lg transition-colors"
                  >
                    <XIcon className="w-5 h-5 text-gray-500" />
                  </button>
                </div>
              </div>

              {/* Body */}
              <div className="overflow-y-auto max-h-[calc(80vh-160px)] p-5">
                {/* í•µì‹¬ ê²°ì • ì‚¬í•­ */}
                <section className="mb-6">
                  <div className="flex items-center justify-between mb-3">
                    <h3 className="text-sm font-semibold text-gray-500 flex items-center gap-2">
                      <span>ğŸ¯</span>
                      í•µì‹¬ ê²°ì • ì‚¬í•­
                    </h3>

                    {/* ì§„í–‰ë¥  ì¸ë””ì¼€ì´í„° */}
                    <ProgressIndicator
                      filled={filledGaps}
                      total={totalGaps}
                    />
                  </div>

                  <div className="space-y-3">
                    {decisions.map((decision, index) => (
                      <motion.div
                        key={decision.id}
                        initial={{ opacity: 0, y: 10 }}
                        animate={{ opacity: 1, y: 0 }}
                        transition={{ delay: index * 0.05 }}
                      >
                        <DecisionCard
                          decision={decision}
                          index={index + 1}
                        />
                      </motion.div>
                    ))}
                  </div>
                </section>

                {/* ì¸ì‚¬ì´íŠ¸ ìš”ì•½ */}
                <section className="mb-6">
                  <InsightSection insights={insights} />
                </section>

                {/* Notion ì €ì¥ ì˜µì…˜ */}
                <section className="pt-5 border-t border-gray-200">
                  <NotionSection />
                </section>
              </div>

              {/* Footer */}
              <div className="sticky bottom-0 bg-white border-t border-gray-200 p-4">
                <ConfirmButton modalState={modalState} />

                <button
                  onClick={() => {/* ë‚˜ì¤‘ì— ì²˜ë¦¬ ë‹¤ì´ì–¼ë¡œê·¸ */}}
                  className="w-full text-center text-gray-500 text-sm mt-3 hover:text-gray-700"
                >
                  ë‚˜ì¤‘ì— ì²˜ë¦¬ â†’
                </button>
              </div>
            </motion.div>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
}

// ì§„í–‰ë¥  ì¸ë””ì¼€ì´í„°
function ProgressIndicator({ filled, total }: { filled: number; total: number }) {
  const isComplete = filled === total;

  return (
    <div className="flex items-center gap-2">
      <span className={`text-xs font-medium ${isComplete ? 'text-green-600' : 'text-gray-500'}`}>
        {isComplete ? 'ëª¨ë‘ ì™„ë£Œ!' : `ì§„í–‰ë¥ : ${filled}/${total}`}
      </span>

      <div className="flex gap-1">
        {Array.from({ length: total }).map((_, i) => (
          <motion.div
            key={i}
            className={`w-2 h-2 rounded-full ${
              i < filled ? 'bg-green-500' : 'bg-gray-200'
            }`}
            initial={false}
            animate={{
              scale: i < filled ? [1, 1.2, 1] : 1,
              backgroundColor: i < filled ? '#10B981' : '#E5E7EB',
            }}
            transition={{ duration: 0.3 }}
          />
        ))}
      </div>
    </div>
  );
}
```

### 14.17 ë¹ˆì¹¸ í•„ë“œ ì»´í¬ë„ŒíŠ¸ (Part 4.2)

```tsx
// src/components/confirmation/GapField.tsx

import { useState, useRef, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useConfirmationStore } from '@/stores/confirmationStore';

interface GapFieldProps {
  decisionId: string;
  field: 'assignee' | 'deadline';
  value: string | null;
  placeholder: string;
  suggestions?: string[];
}

export function GapField({
  decisionId,
  field,
  value,
  placeholder,
  suggestions = [],
}: GapFieldProps) {
  const [isFocused, setIsFocused] = useState(false);
  const [showSuggestions, setShowSuggestions] = useState(false);
  const [inputValue, setInputValue] = useState(value || '');
  const inputRef = useRef<HTMLInputElement>(null);

  const { fillGap } = useConfirmationStore();

  const isEmpty = !value;
  const isFilled = !!value;

  // ìƒíƒœë³„ ìŠ¤íƒ€ì¼
  const getFieldStyles = () => {
    if (isFilled) {
      return 'border-green-500 bg-green-50';
    }
    if (isFocused) {
      return 'border-blue-500 bg-white ring-4 ring-blue-500/20';
    }
    if (isEmpty) {
      return 'border-yellow-300 bg-yellow-50 animate-pulse-border';
    }
    return 'border-gray-300 bg-white';
  };

  const handleBlur = () => {
    setIsFocused(false);
    setShowSuggestions(false);

    if (inputValue && inputValue !== value) {
      fillGap(decisionId, field, inputValue);
    }
  };

  const handleSuggestionClick = (suggestion: string) => {
    setInputValue(suggestion);
    fillGap(decisionId, field, suggestion);
    setShowSuggestions(false);
  };

  return (
    <div className="relative">
      <div className="flex items-center gap-2">
        <span className="text-sm text-gray-500">
          {field === 'assignee' ? 'ğŸ‘¤ ë‹´ë‹¹' : 'ğŸ“… ê¸°í•œ'}
        </span>

        <div className="relative flex-1">
          <input
            ref={inputRef}
            type={field === 'deadline' ? 'date' : 'text'}
            value={inputValue}
            placeholder={placeholder}
            onChange={(e) => setInputValue(e.target.value)}
            onFocus={() => {
              setIsFocused(true);
              setShowSuggestions(suggestions.length > 0);
            }}
            onBlur={handleBlur}
            className={`
              w-full h-9 px-3 rounded-md text-sm transition-all duration-200
              ${getFieldStyles()}
              focus:outline-none
            `}
          />

          {/* ì™„ë£Œ ì²´í¬ ì•„ì´ì½˜ */}
          <AnimatePresence>
            {isFilled && (
              <motion.div
                className="absolute right-3 top-1/2 -translate-y-1/2"
                initial={{ scale: 0, opacity: 0 }}
                animate={{ scale: 1, opacity: 1 }}
                exit={{ scale: 0, opacity: 0 }}
              >
                <CheckIcon className="w-4 h-4 text-green-500" />
              </motion.div>
            )}
          </AnimatePresence>

          {/* ê²½ê³  ì•„ì´ì½˜ */}
          <AnimatePresence>
            {isEmpty && !isFocused && (
              <motion.div
                className="absolute right-3 top-1/2 -translate-y-1/2"
                initial={{ scale: 0 }}
                animate={{ scale: 1 }}
                exit={{ scale: 0 }}
              >
                <AlertIcon className="w-4 h-4 text-yellow-500" />
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      </div>

      {/* ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ */}
      <AnimatePresence>
        {showSuggestions && suggestions.length > 0 && (
          <motion.div
            className="absolute left-0 right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 overflow-hidden"
            initial={{ opacity: 0, y: -5 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -5 }}
          >
            {suggestions.map((suggestion, index) => (
              <button
                key={index}
                className="w-full px-4 py-2.5 text-left text-sm hover:bg-gray-100 transition-colors"
                onMouseDown={(e) => {
                  e.preventDefault();
                  handleSuggestionClick(suggestion);
                }}
              >
                {suggestion}
              </button>
            ))}
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}

// í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ CSS
const pulseAnimation = `
  @keyframes pulse-border {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(252, 211, 77, 0);
    }
    50% {
      box-shadow: 0 0 0 4px rgba(252, 211, 77, 0.4);
    }
  }

  .animate-pulse-border {
    animation: pulse-border 1.5s infinite;
  }
`;
```

### 14.18 ì™„ë£Œ í™”ë©´ ì»´í¬ë„ŒíŠ¸ (Part 4.3)

```tsx
// src/components/confirmation/CompletionScreen.tsx

import { motion } from 'framer-motion';
import { useConfirmationStore } from '@/stores/confirmationStore';

export function CompletionScreen() {
  const {
    showCompletionScreen,
    notionPageUrl,
    autoRedirectCountdown,
    navigateToNotion,
    navigateToToday,
  } = useConfirmationStore();

  if (!showCompletionScreen) return null;

  return (
    <motion.div
      className="fixed inset-0 bg-white z-[10002] flex items-center justify-center"
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
    >
      <div className="text-center px-8">
        {/* ì„±ê³µ ì•„ì´ì½˜ */}
        <motion.div
          className="w-20 h-20 mx-auto mb-6 text-green-500"
          initial={{ scale: 0 }}
          animate={{ scale: [0, 1.2, 1] }}
          transition={{
            duration: 0.5,
            times: [0, 0.6, 1],
            type: 'spring',
          }}
        >
          <svg
            viewBox="0 0 24 24"
            fill="none"
            className="w-full h-full"
            style={{
              filter: 'drop-shadow(0 0 20px rgba(16, 185, 129, 0.3))',
            }}
          >
            <motion.circle
              cx="12"
              cy="12"
              r="10"
              fill="#10B981"
              initial={{ scale: 0 }}
              animate={{ scale: 1 }}
              transition={{ duration: 0.3 }}
            />
            <motion.path
              d="M8 12l2.5 2.5L16 9"
              stroke="white"
              strokeWidth="2.5"
              strokeLinecap="round"
              strokeLinejoin="round"
              initial={{ pathLength: 0 }}
              animate={{ pathLength: 1 }}
              transition={{ duration: 0.3, delay: 0.2 }}
            />
          </svg>
        </motion.div>

        {/* ì œëª© */}
        <motion.h2
          className="text-2xl font-bold text-gray-900"
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.2 }}
        >
          ì €ì¥ ì™„ë£Œ!
        </motion.h2>

        {/* ì„¤ëª… */}
        <motion.p
          className="text-gray-500 mt-2"
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.3 }}
        >
          {notionPageUrl
            ? 'Notion "íˆ¬ì ë¯¸íŒ… DB"ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤'
            : 'ë¡œì»¬ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤'}
        </motion.p>

        {/* ë²„íŠ¼ë“¤ */}
        <motion.div
          className="flex gap-3 justify-center mt-8"
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.4 }}
        >
          {notionPageUrl && (
            <button
              onClick={navigateToNotion}
              className="flex items-center gap-2 px-6 py-3 bg-black text-white rounded-lg font-semibold hover:opacity-90 transition-opacity"
            >
              <NotionIcon className="w-4 h-4" />
              Notionì—ì„œ ë³´ê¸°
            </button>
          )}

          <button
            onClick={navigateToToday}
            className="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors"
          >
            Todayë¡œ ëŒì•„ê°€ê¸°
          </button>
        </motion.div>

        {/* ìë™ ë¦¬ë””ë ‰íŠ¸ íƒ€ì´ë¨¸ */}
        <motion.div
          className="mt-8 text-xs text-gray-400 flex items-center justify-center gap-2"
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.5 }}
        >
          <span>{autoRedirectCountdown}ì´ˆ í›„ ìë™ ì´ë™</span>

          {/* í”„ë¡œê·¸ë ˆìŠ¤ ë°” */}
          <div className="w-24 h-0.5 bg-gray-200 rounded overflow-hidden">
            <motion.div
              className="h-full bg-green-500"
              initial={{ width: '0%' }}
              animate={{ width: '100%' }}
              transition={{ duration: 3, ease: 'linear' }}
            />
          </div>
        </motion.div>
      </div>
    </motion.div>
  );
}
```

### 14.19 ì—ëŸ¬ í† ìŠ¤íŠ¸ ì»´í¬ë„ŒíŠ¸ (Part 4.3)

```tsx
// src/components/confirmation/ErrorToast.tsx

import { motion, AnimatePresence } from 'framer-motion';
import { useConfirmationStore } from '@/stores/confirmationStore';

export function NotionErrorToast() {
  const {
    notionSaveStatus,
    notionError,
    retryNotionSave,
  } = useConfirmationStore();

  const isVisible = notionSaveStatus === 'error';

  return (
    <AnimatePresence>
      {isVisible && (
        <motion.div
          className="fixed bottom-6 left-1/2 -translate-x-1/2 z-[10003]"
          initial={{ opacity: 0, y: 50 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: 50 }}
        >
          <div className="flex items-center gap-4 px-4 py-3 bg-red-50 border border-red-200 border-l-4 border-l-red-500 rounded-lg shadow-lg">
            <div className="flex-1">
              <p className="text-sm font-medium text-red-800">
                âš ï¸ Notion ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤
              </p>
              <p className="text-xs text-red-600 mt-0.5">
                ë¡œì»¬ì—ëŠ” ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤
              </p>
            </div>

            <div className="flex gap-2">
              <button
                onClick={retryNotionSave}
                className="px-3 py-1.5 bg-red-500 text-white text-xs font-semibold rounded hover:bg-red-600 transition-colors"
              >
                ì¬ì‹œë„
              </button>

              <button
                onClick={() => {/* dismiss */}}
                className="px-3 py-1.5 text-red-600 text-xs font-medium hover:bg-red-100 rounded transition-colors"
              >
                ë‹«ê¸°
              </button>
            </div>
          </div>
        </motion.div>
      )}
    </AnimatePresence>
  );
}
```

### 14.20 ë‚˜ì¤‘ì— ì²˜ë¦¬ ë‹¤ì´ì–¼ë¡œê·¸ (Part 4)

```tsx
// src/components/confirmation/LaterDialog.tsx

import { motion, AnimatePresence } from 'framer-motion';

interface LaterDialogProps {
  isOpen: boolean;
  onConfirm: () => void;
  onCancel: () => void;
}

export function LaterDialog({ isOpen, onConfirm, onCancel }: LaterDialogProps) {
  return (
    <AnimatePresence>
      {isOpen && (
        <>
          {/* Overlay */}
          <motion.div
            className="fixed inset-0 bg-black/30 z-[10004]"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={onCancel}
          />

          {/* Dialog */}
          <motion.div
            className="fixed inset-0 flex items-center justify-center z-[10005]"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
          >
            <motion.div
              className="w-80 bg-white rounded-2xl shadow-xl p-6 text-center"
              initial={{ scale: 0.95, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              exit={{ scale: 0.95, opacity: 0 }}
            >
              <h3 className="text-lg font-semibold text-gray-900">
                ë‚˜ì¤‘ì— ì²˜ë¦¬í• ê¹Œìš”?
              </h3>

              <p className="text-sm text-gray-500 mt-2">
                Today í™”ë©´ì—ì„œ ë‹¤ì‹œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”
              </p>

              <div className="flex gap-3 mt-6">
                <button
                  onClick={onCancel}
                  className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors"
                >
                  ì•„ë‹ˆìš”
                </button>

                <button
                  onClick={onConfirm}
                  className="flex-1 py-3 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition-colors"
                >
                  ë„¤
                </button>
              </div>
            </motion.div>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
}
```

### 14.21 Part 4 ì´ë²¤íŠ¸ ë¡œê¹… íƒ€ì…

```typescript
// src/types/analytics.ts (Part 4 í™•ì¥)

// Part 4.1: ì „í™˜ ì´ë²¤íŠ¸ íƒ€ì…
export type TransitionEventType =
  | 'meeting_ended'              // ë¯¸íŒ… ì¢…ë£Œ ê°ì§€
  | 'meeting_end_false_positive' // ì˜¤íƒ
  | 'confirmation_modal_shown'   // í™•ì • ëª¨ë‹¬ í‘œì‹œ
  | 'confirmation_modal_skipped' // ê±´ë„ˆëœ€ (ì§§ì€ ë¯¸íŒ…)
  | 'modal_auto_transition'      // ìë™ ì „í™˜ ì™„ë£Œ
  | 'transition_cancelled';      // ì „í™˜ ì·¨ì†Œ

export interface TransitionMetadata {
  meetingDuration: number;
  triggerType: 'app_closed' | 'call_ended' | 'manual';
  transitionDelay: number;
  isShortMeeting: boolean;
}

// Part 4.2: í™•ì • ëª¨ë‹¬ ì´ë²¤íŠ¸ íƒ€ì…
export type ConfirmationEventType =
  | 'modal_viewed'
  | 'decision_reviewed'
  | 'gap_field_focused'
  | 'gap_field_filled'
  | 'gap_field_skipped'
  | 'insight_expanded'
  | 'insight_edited'
  | 'decision_added'
  | 'decision_deleted'
  | 'confirm_clicked'
  | 'modal_abandoned'
  | 'later_clicked';

export interface ConfirmationMetadata {
  totalGaps: number;
  filledGaps: number;
  totalDecisions: number;
  editedDecisions: number;
  addedDecisions: number;
  timeSpent: number;
  abandonReason?: 'x_clicked' | 'outside_click' | 'later_button';
}

// Part 4.3: í†µí•© ì €ì¥ ì´ë²¤íŠ¸ íƒ€ì…
export type IntegrationEventType =
  | 'notion_checkbox_checked'
  | 'notion_checkbox_unchecked'
  | 'notion_save_started'
  | 'notion_save_completed'
  | 'notion_save_failed'
  | 'notion_save_retried'
  | 'notion_view_clicked'
  | 'completion_screen_shown'
  | 'today_screen_returned';

export interface IntegrationMetadata {
  notionConnected: boolean;
  saveToNotion: boolean;
  workspaceId?: string;
  pageUrl?: string;
  errorType?: 'network' | 'auth' | 'permission' | 'quota';
  retryCount: number;
  localSaved: boolean;
}

// Part 4 í•µì‹¬ ì§€í‘œ
export const part4Metrics = {
  confirmationRate: 'count(confirm_clicked) / count(meeting_ended WHERE duration > 300)',
  avgConfirmationTime: 'avg(timeSpent WHERE confirm_clicked)',
  gapFillRate: 'sum(filledGaps) / sum(totalGaps)',
  abandonRate: 'count(modal_abandoned + later_clicked) / count(modal_viewed)',
  notionSaveRate: 'count(notion_save_completed) / count(confirm_clicked WHERE notionConnected)',
  laterRecoveryRate: 'count(confirm_clicked WHERE fromLater) / count(later_clicked)',
};
```

### 14.22 Part 4 Analytics Hook í™•ì¥

```typescript
// src/hooks/useAnalytics.ts (Part 4 í™•ì¥)

import { track } from '@/services/analytics';
import type {
  TransitionEventType,
  TransitionMetadata,
  ConfirmationEventType,
  ConfirmationMetadata,
  IntegrationEventType,
  IntegrationMetadata,
} from '@/types/analytics';

export function usePart4Analytics() {
  // Part 4.1: ì „í™˜ ì´ë²¤íŠ¸
  const trackTransition = (
    event: TransitionEventType,
    metadata: TransitionMetadata
  ) => {
    track(`part4_transition_${event}`, metadata);
  };

  // Part 4.2: í™•ì • ëª¨ë‹¬ ì´ë²¤íŠ¸
  const trackConfirmation = (
    event: ConfirmationEventType,
    metadata: Partial<ConfirmationMetadata>
  ) => {
    track(`part4_confirmation_${event}`, metadata);
  };

  // Part 4.3: í†µí•© ì €ì¥ ì´ë²¤íŠ¸
  const trackIntegration = (
    event: IntegrationEventType,
    metadata: Partial<IntegrationMetadata>
  ) => {
    track(`part4_integration_${event}`, metadata);
  };

  return {
    // Part 4.1
    trackMeetingEnded: (metadata: TransitionMetadata) =>
      trackTransition('meeting_ended', metadata),
    trackModalShown: (metadata: TransitionMetadata) =>
      trackTransition('confirmation_modal_shown', metadata),
    trackModalSkipped: (metadata: TransitionMetadata) =>
      trackTransition('confirmation_modal_skipped', metadata),

    // Part 4.2
    trackModalViewed: (metadata: Partial<ConfirmationMetadata>) =>
      trackConfirmation('modal_viewed', metadata),
    trackGapFilled: (decisionId: string, field: string) =>
      trackConfirmation('gap_field_filled', { decisionId, field } as any),
    trackConfirmClicked: (metadata: Partial<ConfirmationMetadata>) =>
      trackConfirmation('confirm_clicked', metadata),
    trackModalAbandoned: (reason: ConfirmationMetadata['abandonReason']) =>
      trackConfirmation('modal_abandoned', { abandonReason: reason }),
    trackLaterClicked: () =>
      trackConfirmation('later_clicked', {}),

    // Part 4.3
    trackNotionCheckboxChanged: (checked: boolean) =>
      trackIntegration(
        checked ? 'notion_checkbox_checked' : 'notion_checkbox_unchecked',
        { saveToNotion: checked }
      ),
    trackNotionSaveCompleted: (pageUrl: string) =>
      trackIntegration('notion_save_completed', { pageUrl }),
    trackNotionSaveFailed: (errorType: IntegrationMetadata['errorType']) =>
      trackIntegration('notion_save_failed', { errorType }),
    trackCompletionShown: () =>
      trackIntegration('completion_screen_shown', {}),
    trackTodayReturned: () =>
      trackIntegration('today_screen_returned', {}),
  };
}
```

---

### 14.23 ê²€ìƒ‰ Store (Part 5)

```typescript
// src/stores/searchStore.ts (Part 5)
import { create } from 'zustand';
import { devtools } from 'zustand/middleware';

// Part 5 ê²€ìƒ‰ íƒ€ì…
interface SearchQuery {
  raw: string;
  parsed?: ParsedQuery;
}

interface ParsedQuery {
  timeRange?: { start: Date; end: Date };
  person?: string;
  company?: string;
  topic?: string;
  decisionElement?: 'decision' | 'action' | 'risk' | 'assumption';
  keywords: string[];
}

interface SearchResult {
  meetingId: string;
  meetingTitle: string;
  meetingDate: Date;
  company?: string;
  attendees: string[];
  snippets: Snippet[];
  decisionSummary?: string;
  mentionCount: number;
  relevanceScore: number;
}

interface Snippet {
  text: string;
  speaker?: string;
  highlightRanges: Array<{ start: number; end: number }>;
}

interface SearchFilter {
  dateRange: 'all' | 'week' | 'month' | '3months' | 'custom';
  customDateRange?: { start: Date; end: Date };
  companies: string[];
  persons: string[];
  decisionElements: string[];
}

type SearchState = 'idle' | 'typing' | 'searching' | 'results' | 'detail' | 'error';

interface SearchStore {
  // Part 5.1: ê²€ìƒ‰ ì§„ì… ìƒíƒœ
  state: SearchState;
  query: SearchQuery;
  recentSearches: Array<{ query: string; timestamp: Date }>;
  suggestions: string[];
  frequentTopics: Array<{ topic: string; count: number }>;

  // Part 5.2: ê²€ìƒ‰ ê²°ê³¼ ìƒíƒœ
  results: SearchResult[];
  resultCount: number;
  searchTime: number;
  sortBy: 'relevance' | 'date';
  filter: SearchFilter;
  isFilterOpen: boolean;

  // Part 5.3: ìƒì„¸ ì¡°íšŒ ìƒíƒœ
  selectedResult: SearchResult | null;
  highlightPositions: number[];
  currentHighlightIndex: number;
  relatedMeetings: SearchResult[];

  // ì—ëŸ¬ ìƒíƒœ
  error: string | null;

  // Part 5.1: ê²€ìƒ‰ ì§„ì… ì•¡ì…˜
  setQuery: (query: string) => void;
  parseQuery: (query: string) => ParsedQuery;
  submitSearch: () => Promise<void>;
  clickRecentSearch: (query: string) => void;
  clickSuggestion: (suggestion: string) => void;
  clearQuery: () => void;

  // Part 5.2: ê²€ìƒ‰ ê²°ê³¼ ì•¡ì…˜
  setSortBy: (sort: 'relevance' | 'date') => void;
  setFilter: (filter: Partial<SearchFilter>) => void;
  toggleFilter: () => void;
  applyFilter: () => void;
  resetFilter: () => void;
  clickResult: (result: SearchResult) => void;

  // Part 5.3: ìƒì„¸ ì¡°íšŒ ì•¡ì…˜
  navigateHighlight: (direction: 'prev' | 'next') => void;
  clickRelatedMeeting: (meetingId: string) => void;
  backToResults: () => void;
  exitDetail: () => void;

  // ê³µí†µ ì•¡ì…˜
  reset: () => void;
}

const initialFilter: SearchFilter = {
  dateRange: 'all',
  companies: [],
  persons: [],
  decisionElements: [],
};

export const useSearchStore = create<SearchStore>()(
  devtools(
    (set, get) => ({
      // ì´ˆê¸° ìƒíƒœ
      state: 'idle',
      query: { raw: '' },
      recentSearches: [],
      suggestions: [],
      frequentTopics: [],

      results: [],
      resultCount: 0,
      searchTime: 0,
      sortBy: 'relevance',
      filter: initialFilter,
      isFilterOpen: false,

      selectedResult: null,
      highlightPositions: [],
      currentHighlightIndex: 0,
      relatedMeetings: [],

      error: null,

      // Part 5.1: ê²€ìƒ‰ ì§„ì… ì•¡ì…˜
      setQuery: (raw) => {
        set({
          query: { raw, parsed: get().parseQuery(raw) },
          state: raw.length > 0 ? 'typing' : 'idle'
        });
      },

      parseQuery: (raw) => {
        // ì‹œë§¨í‹± ì¿¼ë¦¬ íŒŒì‹± ë¡œì§
        const keywords: string[] = [];
        let timeRange: ParsedQuery['timeRange'];
        let person: string | undefined;
        let company: string | undefined;

        // ì‹œê°„ í‘œí˜„ íŒŒì‹±
        const timePatterns = [
          { regex: /(\d+)ê°œì›”\s*ì „/g, handler: (m: number) => {
            const end = new Date();
            const start = new Date();
            start.setMonth(start.getMonth() - m);
            return { start, end };
          }},
          { regex: /ì§€ë‚œ\s*ì£¼/g, handler: () => {
            const end = new Date();
            const start = new Date();
            start.setDate(start.getDate() - 7);
            return { start, end };
          }},
          { regex: /ì§€ë‚œ\s*ë‹¬/g, handler: () => {
            const end = new Date();
            const start = new Date();
            start.setMonth(start.getMonth() - 1);
            return { start, end };
          }},
        ];

        for (const { regex, handler } of timePatterns) {
          const match = raw.match(regex);
          if (match) {
            const num = parseInt(match[0]) || 1;
            timeRange = handler(num);
            break;
          }
        }

        // íšŒì‚¬ëª… ì¶”ì¶œ (ì˜ˆ: "Aì‚¬", "Bì‚¬")
        const companyMatch = raw.match(/([A-Zê°€-í£]+ì‚¬)/);
        if (companyMatch) {
          company = companyMatch[1];
        }

        // ì‚¬ëŒ ì´ë¦„ ì¶”ì¶œ (ì˜ˆ: "ê¹€ëŒ€í‘œ", "ì´ê³¼ì¥")
        const personMatch = raw.match(/([ê°€-í£]{2,4}(ëŒ€í‘œ|ê³¼ì¥|ë¶€ì¥|íŒ€ì¥|ë‹˜))/);
        if (personMatch) {
          person = personMatch[1];
        }

        // ë‚¨ì€ í‚¤ì›Œë“œ ì¶”ì¶œ
        const cleanedQuery = raw
          .replace(/\d+ê°œì›”\s*ì „/g, '')
          .replace(/ì§€ë‚œ\s*(ì£¼|ë‹¬)/g, '')
          .replace(/([A-Zê°€-í£]+ì‚¬)/g, '')
          .replace(/([ê°€-í£]{2,4}(ëŒ€í‘œ|ê³¼ì¥|ë¶€ì¥|íŒ€ì¥|ë‹˜))/g, '')
          .trim();

        if (cleanedQuery) {
          keywords.push(...cleanedQuery.split(/\s+/).filter(k => k.length > 0));
        }

        return { timeRange, person, company, keywords };
      },

      submitSearch: async () => {
        const { query, filter, sortBy } = get();
        if (!query.raw.trim()) return;

        set({ state: 'searching', error: null });

        try {
          const startTime = performance.now();

          // API í˜¸ì¶œ
          const response = await fetch('/api/search', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              query: query.raw,
              parsedQuery: query.parsed,
              filter,
              sortBy,
            }),
          });

          if (!response.ok) throw new Error('Search failed');

          const data = await response.json();
          const searchTime = performance.now() - startTime;

          // ìµœê·¼ ê²€ìƒ‰ ì—…ë°ì´íŠ¸
          const recentSearches = [
            { query: query.raw, timestamp: new Date() },
            ...get().recentSearches.filter(r => r.query !== query.raw).slice(0, 9),
          ];

          set({
            state: 'results',
            results: data.results,
            resultCount: data.totalCount,
            searchTime: Math.round(searchTime) / 1000,
            recentSearches,
          });
        } catch (error) {
          set({
            state: 'error',
            error: error instanceof Error ? error.message : 'Search failed',
          });
        }
      },

      clickRecentSearch: (query) => {
        set({ query: { raw: query, parsed: get().parseQuery(query) } });
        get().submitSearch();
      },

      clickSuggestion: (suggestion) => {
        const currentQuery = get().query.raw;
        const newQuery = currentQuery ? `${currentQuery} ${suggestion}` : suggestion;
        set({ query: { raw: newQuery, parsed: get().parseQuery(newQuery) } });
        get().submitSearch();
      },

      clearQuery: () => {
        set({ query: { raw: '' }, state: 'idle', results: [], resultCount: 0 });
      },

      // Part 5.2: ê²€ìƒ‰ ê²°ê³¼ ì•¡ì…˜
      setSortBy: (sort) => {
        set({ sortBy: sort });
        get().submitSearch();
      },

      setFilter: (partial) => {
        set({ filter: { ...get().filter, ...partial } });
      },

      toggleFilter: () => {
        set({ isFilterOpen: !get().isFilterOpen });
      },

      applyFilter: () => {
        set({ isFilterOpen: false });
        get().submitSearch();
      },

      resetFilter: () => {
        set({ filter: initialFilter });
      },

      clickResult: async (result) => {
        set({
          state: 'detail',
          selectedResult: result,
          currentHighlightIndex: 0,
        });

        // ê´€ë ¨ ë¯¸íŒ… ë¡œë“œ
        try {
          const response = await fetch(`/api/meetings/${result.meetingId}/related`);
          const data = await response.json();
          set({ relatedMeetings: data.meetings });
        } catch (error) {
          console.error('Failed to load related meetings:', error);
        }
      },

      // Part 5.3: ìƒì„¸ ì¡°íšŒ ì•¡ì…˜
      navigateHighlight: (direction) => {
        const { highlightPositions, currentHighlightIndex } = get();
        const maxIndex = highlightPositions.length - 1;

        let newIndex = currentHighlightIndex;
        if (direction === 'next' && currentHighlightIndex < maxIndex) {
          newIndex = currentHighlightIndex + 1;
        } else if (direction === 'prev' && currentHighlightIndex > 0) {
          newIndex = currentHighlightIndex - 1;
        }

        set({ currentHighlightIndex: newIndex });
      },

      clickRelatedMeeting: async (meetingId) => {
        const { results } = get();
        const meeting = results.find(r => r.meetingId === meetingId);

        if (meeting) {
          get().clickResult(meeting);
        } else {
          // ìƒˆë¡œìš´ ë¯¸íŒ… ë¡œë“œ
          try {
            const response = await fetch(`/api/meetings/${meetingId}`);
            const data = await response.json();
            set({
              selectedResult: data,
              currentHighlightIndex: 0,
            });
          } catch (error) {
            console.error('Failed to load meeting:', error);
          }
        }
      },

      backToResults: () => {
        set({ state: 'results', selectedResult: null, relatedMeetings: [] });
      },

      exitDetail: () => {
        set({ state: 'idle', selectedResult: null, relatedMeetings: [], query: { raw: '' } });
      },

      reset: () => {
        set({
          state: 'idle',
          query: { raw: '' },
          results: [],
          resultCount: 0,
          searchTime: 0,
          filter: initialFilter,
          isFilterOpen: false,
          selectedResult: null,
          highlightPositions: [],
          currentHighlightIndex: 0,
          relatedMeetings: [],
          error: null,
        });
      },
    }),
    { name: 'search-store' }
  )
);
```

---

### 14.24 ê²€ìƒ‰ í™”ë©´ ì»´í¬ë„ŒíŠ¸ (Part 5.1)

```tsx
// src/components/Search/SearchScreen.tsx (Part 5.1)
import { useState, useCallback, useEffect, useRef } from 'react';
import { useSearchStore } from '@/stores/searchStore';
import { useDebounce } from '@/hooks/useDebounce';
import { SearchInput } from './SearchInput';
import { SuggestionChips } from './SuggestionChips';
import { RecentSearches } from './RecentSearches';
import { FrequentTopics } from './FrequentTopics';
import { SearchResults } from './SearchResults';
import { SearchDetail } from './SearchDetail';
import { SearchFilterPanel } from './SearchFilterPanel';
import { useSearchAnalytics } from '@/hooks/useSearchAnalytics';

export function SearchScreen() {
  const {
    state,
    query,
    recentSearches,
    suggestions,
    frequentTopics,
    results,
    isFilterOpen,
    selectedResult,
    setQuery,
    submitSearch,
    clearQuery,
    toggleFilter,
  } = useSearchStore();

  const analytics = useSearchAnalytics();
  const inputRef = useRef<HTMLInputElement>(null);

  // ë””ë°”ìš´ìŠ¤ëœ ê²€ìƒ‰
  const debouncedQuery = useDebounce(query.raw, 300);

  useEffect(() => {
    if (debouncedQuery && state === 'typing') {
      submitSearch();
    }
  }, [debouncedQuery]);

  // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ì´ë²¤íŠ¸
  useEffect(() => {
    analytics.trackSearchTabOpened();
  }, []);

  const handleFocus = useCallback(() => {
    analytics.trackSearchFocused(recentSearches.length > 0);
  }, [recentSearches.length]);

  const handleSubmit = useCallback((e: React.FormEvent) => {
    e.preventDefault();
    analytics.trackSearchSubmitted(query.raw);
    submitSearch();
  }, [query.raw]);

  // ìƒíƒœë³„ ë Œë”ë§
  if (state === 'detail' && selectedResult) {
    return <SearchDetail />;
  }

  return (
    <div className="flex flex-col h-full bg-gray-50">
      {/* í—¤ë” */}
      <div className="p-4 bg-white border-b">
        <h1 className="text-2xl font-bold text-gray-900 flex items-center gap-2">
          ğŸ” ê²€ìƒ‰
        </h1>
      </div>

      {/* ê²€ìƒ‰ ì…ë ¥ */}
      <div className="p-4">
        <form onSubmit={handleSubmit}>
          <SearchInput
            ref={inputRef}
            value={query.raw}
            onChange={setQuery}
            onFocus={handleFocus}
            onClear={clearQuery}
            placeholder="ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš” (ì˜ˆ: 'Aì‚¬ ì˜ˆì‚°', 'ì§€ë‚œì£¼ ë¦¬ìŠ¤í¬')"
            isLoading={state === 'searching'}
          />
        </form>
      </div>

      {/* ê²€ìƒ‰ ìƒíƒœë³„ ì½˜í…ì¸  */}
      <div className="flex-1 overflow-auto">
        {state === 'idle' && (
          <div className="p-4 space-y-6">
            {/* ì¶”ì²œ ê²€ìƒ‰ */}
            <SuggestionChips suggestions={suggestions} />

            {/* ìµœê·¼ ê²€ìƒ‰ */}
            {recentSearches.length > 0 && (
              <RecentSearches searches={recentSearches} />
            )}

            {/* ìì£¼ ê²€ìƒ‰ë˜ëŠ” ì£¼ì œ */}
            {frequentTopics.length > 0 && (
              <FrequentTopics topics={frequentTopics} />
            )}

            {/* ë¹ˆ ìƒíƒœ */}
            {recentSearches.length === 0 && frequentTopics.length === 0 && (
              <EmptyState />
            )}
          </div>
        )}

        {(state === 'results' || state === 'searching') && (
          <SearchResults />
        )}

        {state === 'error' && (
          <ErrorState onRetry={submitSearch} />
        )}
      </div>

      {/* í•„í„° íŒ¨ë„ */}
      {isFilterOpen && <SearchFilterPanel />}
    </div>
  );
}

function EmptyState() {
  return (
    <div className="flex flex-col items-center justify-center p-12 text-center">
      <div className="w-16 h-16 mb-4 text-gray-300">ğŸ”</div>
      <p className="text-gray-500 mb-6">ê³¼ê±° íšŒì˜ ë‚´ìš©ì„ ê²€ìƒ‰í•˜ì„¸ìš”</p>
      <div className="text-sm text-gray-400">
        <p className="mb-2">ì˜ˆì‹œ:</p>
        <ul className="space-y-1">
          <li>â€¢ "Aì‚¬ ì˜ˆì‚°"</li>
          <li>â€¢ "ì§€ë‚œë‹¬ ì‹¤íŒ¨í•œ ë”œ"</li>
          <li>â€¢ "ê¹€ëŒ€í‘œ ì•½ì†"</li>
        </ul>
      </div>
    </div>
  );
}

function ErrorState({ onRetry }: { onRetry: () => void }) {
  return (
    <div className="flex flex-col items-center justify-center p-12 text-center">
      <div className="w-16 h-16 mb-4 text-red-300">âš ï¸</div>
      <p className="text-gray-700 mb-4">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</p>
      <button
        onClick={onRetry}
        className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
      >
        ë‹¤ì‹œ ì‹œë„
      </button>
    </div>
  );
}
```

---

### 14.25 ê²€ìƒ‰ ê²°ê³¼ ì»´í¬ë„ŒíŠ¸ (Part 5.2)

```tsx
// src/components/Search/SearchResults.tsx (Part 5.2)
import { useSearchStore } from '@/stores/searchStore';
import { SearchResultCard } from './SearchResultCard';
import { useSearchAnalytics } from '@/hooks/useSearchAnalytics';
import { Spinner } from '@/components/common/Spinner';

export function SearchResults() {
  const {
    state,
    results,
    resultCount,
    searchTime,
    sortBy,
    setSortBy,
    toggleFilter,
    filter,
    clickResult,
  } = useSearchStore();

  const analytics = useSearchAnalytics();

  const handleSortChange = (newSort: 'relevance' | 'date') => {
    analytics.trackSortChanged(sortBy, newSort);
    setSortBy(newSort);
  };

  const handleResultClick = (result: SearchResult, index: number) => {
    analytics.trackResultClicked(result.meetingId, index);
    clickResult(result);
  };

  const activeFilterCount =
    (filter.companies.length > 0 ? 1 : 0) +
    (filter.persons.length > 0 ? 1 : 0) +
    (filter.decisionElements.length > 0 ? 1 : 0) +
    (filter.dateRange !== 'all' ? 1 : 0);

  if (state === 'searching') {
    return (
      <div className="flex items-center justify-center p-12">
        <Spinner size="lg" />
        <span className="ml-3 text-gray-500">ê²€ìƒ‰ ì¤‘...</span>
      </div>
    );
  }

  return (
    <div className="p-4">
      {/* ê²°ê³¼ í—¤ë” */}
      <div className="flex items-center justify-between pb-3 mb-4 border-b">
        <span className="text-sm text-gray-500">
          ê²°ê³¼ {resultCount}ê±´ ({searchTime}ì´ˆ)
        </span>

        <div className="flex items-center gap-2">
          {/* ì •ë ¬ */}
          <select
            value={sortBy}
            onChange={(e) => handleSortChange(e.target.value as 'relevance' | 'date')}
            className="h-8 px-3 text-sm border rounded-lg bg-white"
          >
            <option value="relevance">ê´€ë ¨ë„ìˆœ</option>
            <option value="date">ìµœì‹ ìˆœ</option>
          </select>

          {/* í•„í„° */}
          <button
            onClick={toggleFilter}
            className="flex items-center gap-1 h-8 px-3 text-sm border rounded-lg bg-white hover:bg-gray-50"
          >
            í•„í„°
            {activeFilterCount > 0 && (
              <span className="px-1.5 py-0.5 text-xs bg-blue-100 text-blue-700 rounded-full">
                {activeFilterCount}
              </span>
            )}
            <ChevronDownIcon className="w-4 h-4" />
          </button>
        </div>
      </div>

      {/* ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ */}
      {results.length > 0 ? (
        <div className="space-y-3">
          {results.map((result, index) => (
            <SearchResultCard
              key={result.meetingId}
              result={result}
              onClick={() => handleResultClick(result, index)}
            />
          ))}

          {/* ê²°ê³¼ ë í‘œì‹œ */}
          <div className="py-6 text-center text-sm text-gray-400 border-t border-dashed">
            â€” ê·¸ê²Œ ì „ë¶€ì…ë‹ˆë‹¤ â€”
          </div>
        </div>
      ) : (
        <NoResults />
      )}
    </div>
  );
}

function NoResults() {
  const { query, submitSearch } = useSearchStore();
  const analytics = useSearchAnalytics();

  // ê²€ìƒ‰ì–´ ë¶„í•´ ì œì•ˆ
  const suggestions = query.raw.split(/\s+/).filter(w => w.length > 1);

  useEffect(() => {
    analytics.trackNoResultsShown(query.raw, suggestions);
  }, [query.raw]);

  return (
    <div className="flex flex-col items-center p-12 text-center">
      <div className="text-4xl mb-4">ğŸ˜•</div>
      <p className="text-gray-700 mb-6">
        "<span className="font-semibold">{query.raw}</span>" ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤
      </p>

      {suggestions.length > 1 && (
        <div className="w-full max-w-sm p-4 bg-gray-50 rounded-xl mb-4">
          <p className="flex items-center gap-2 text-sm text-gray-500 mb-3">
            ğŸ’¡ ì´ëŸ° ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”:
          </p>
          <div className="flex flex-wrap gap-2">
            {suggestions.map((s, i) => (
              <button
                key={i}
                onClick={() => {
                  useSearchStore.getState().setQuery(s);
                  submitSearch();
                }}
                className="px-4 py-2 bg-white border rounded-lg hover:border-blue-500 transition-colors"
              >
                {s}
              </button>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}
```

---

### 14.26 ê²€ìƒ‰ ìƒì„¸ ì¡°íšŒ ì»´í¬ë„ŒíŠ¸ (Part 5.3)

```tsx
// src/components/Search/SearchDetail.tsx (Part 5.3)
import { useEffect, useRef } from 'react';
import { useSearchStore } from '@/stores/searchStore';
import { useSearchAnalytics } from '@/hooks/useSearchAnalytics';
import { HighlightNavigator } from './HighlightNavigator';
import { TranscriptWithHighlights } from './TranscriptWithHighlights';
import { DecisionSummaryBox } from './DecisionSummaryBox';
import { RelatedMeetings } from './RelatedMeetings';
import { ArrowLeftIcon } from '@heroicons/react/24/outline';

export function SearchDetail() {
  const {
    query,
    selectedResult,
    highlightPositions,
    currentHighlightIndex,
    relatedMeetings,
    navigateHighlight,
    backToResults,
    exitDetail,
  } = useSearchStore();

  const analytics = useSearchAnalytics();
  const contentRef = useRef<HTMLDivElement>(null);

  // ìƒì„¸ ì¡°íšŒ íŠ¸ë˜í‚¹
  useEffect(() => {
    if (selectedResult) {
      analytics.trackDetailViewed(
        selectedResult.meetingId,
        query.raw,
        highlightPositions.length
      );
    }
  }, [selectedResult?.meetingId]);

  // í•˜ì´ë¼ì´íŠ¸ ìœ„ì¹˜ë¡œ ìŠ¤í¬ë¡¤
  useEffect(() => {
    if (contentRef.current && highlightPositions.length > 0) {
      const highlightEl = contentRef.current.querySelector(
        `[data-highlight-index="${currentHighlightIndex}"]`
      );
      if (highlightEl) {
        highlightEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }
  }, [currentHighlightIndex]);

  if (!selectedResult) return null;

  const handleBack = () => {
    analytics.trackDetailExited('back_to_results');
    backToResults();
  };

  const handleNavigate = (direction: 'prev' | 'next') => {
    analytics.trackHighlightNavigated(direction, currentHighlightIndex);
    navigateHighlight(direction);
  };

  const handleRelatedClick = (meetingId: string) => {
    analytics.trackRelatedMeetingClicked(selectedResult.meetingId, meetingId);
  };

  return (
    <div className="flex flex-col h-full bg-white">
      {/* í—¤ë” */}
      <header className="flex items-center justify-between h-14 px-4 border-b sticky top-0 bg-white z-10">
        <button
          onClick={handleBack}
          className="flex items-center gap-2 text-gray-500 hover:text-gray-900"
        >
          <ArrowLeftIcon className="w-5 h-5" />
          <span className="text-sm font-medium">ê²€ìƒ‰ ê²°ê³¼</span>
        </button>
        <h1 className="text-lg font-semibold text-gray-900">
          {selectedResult.meetingTitle}
        </h1>
        <div className="w-20" /> {/* Spacer */}
      </header>

      {/* í•˜ì´ë¼ì´íŠ¸ ë„¤ë¹„ê²Œì´í„° */}
      {highlightPositions.length > 0 && (
        <HighlightNavigator
          query={query.raw}
          current={currentHighlightIndex + 1}
          total={highlightPositions.length}
          onPrev={() => handleNavigate('prev')}
          onNext={() => handleNavigate('next')}
          disablePrev={currentHighlightIndex === 0}
          disableNext={currentHighlightIndex === highlightPositions.length - 1}
        />
      )}

      {/* ë¯¸íŒ… ì •ë³´ */}
      <div className="p-4 bg-gray-50 border-b space-y-2">
        <div className="flex items-center gap-2 text-sm text-gray-700">
          <span>ğŸ“…</span>
          <span>{formatDate(selectedResult.meetingDate)}</span>
        </div>
        <div className="flex items-center gap-2 text-sm text-gray-700">
          <span>ğŸ‘¥</span>
          <span>{selectedResult.attendees.join(', ')}</span>
        </div>
        {selectedResult.company && (
          <div className="flex items-center gap-2 text-sm text-gray-700">
            <span>ğŸ¢</span>
            <span>{selectedResult.company}</span>
          </div>
        )}
      </div>

      {/* ëŒ€í™” ë‚´ìš© */}
      <div ref={contentRef} className="flex-1 overflow-auto p-4">
        <TranscriptWithHighlights
          meetingId={selectedResult.meetingId}
          query={query.raw}
          currentHighlightIndex={currentHighlightIndex}
        />
      </div>

      {/* ê²°ì • ì‚¬í•­ ìš”ì•½ */}
      {selectedResult.decisionSummary && (
        <DecisionSummaryBox meetingId={selectedResult.meetingId} />
      )}

      {/* ê´€ë ¨ ë¯¸íŒ… */}
      {relatedMeetings.length > 0 && (
        <RelatedMeetings
          meetings={relatedMeetings}
          onMeetingClick={handleRelatedClick}
        />
      )}
    </div>
  );
}

function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('ko-KR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    weekday: 'short',
    hour: '2-digit',
    minute: '2-digit',
  }).format(new Date(date));
}
```

---

### 14.27 ê²€ìƒ‰ í•„í„° íŒ¨ë„ ì»´í¬ë„ŒíŠ¸ (Part 5)

```tsx
// src/components/Search/SearchFilterPanel.tsx (Part 5)
import { useSearchStore } from '@/stores/searchStore';
import { useSearchAnalytics } from '@/hooks/useSearchAnalytics';
import { XMarkIcon } from '@heroicons/react/24/outline';
import { motion, AnimatePresence } from 'framer-motion';

const dateRangeOptions = [
  { value: 'all', label: 'ì „ì²´' },
  { value: 'week', label: 'ìµœê·¼ 1ì£¼' },
  { value: 'month', label: 'ìµœê·¼ 1ê°œì›”' },
  { value: '3months', label: 'ìµœê·¼ 3ê°œì›”' },
  { value: 'custom', label: 'ì§ì ‘ì„ íƒ' },
] as const;

const decisionElementOptions = [
  { value: 'decision', label: 'ê²°ì •' },
  { value: 'action', label: 'ì•¡ì…˜' },
  { value: 'risk', label: 'ë¦¬ìŠ¤í¬' },
  { value: 'assumption', label: 'ë¯¸í™•ì¸' },
] as const;

export function SearchFilterPanel() {
  const {
    filter,
    setFilter,
    applyFilter,
    resetFilter,
    toggleFilter,
  } = useSearchStore();

  const analytics = useSearchAnalytics();

  const handleApply = () => {
    analytics.trackFilterApplied(filter);
    applyFilter();
  };

  const handleReset = () => {
    analytics.trackFilterReset();
    resetFilter();
  };

  const activeFilterCount =
    (filter.companies.length > 0 ? 1 : 0) +
    (filter.persons.length > 0 ? 1 : 0) +
    (filter.decisionElements.length > 0 ? 1 : 0) +
    (filter.dateRange !== 'all' ? 1 : 0);

  return (
    <AnimatePresence>
      <motion.div
        initial={{ y: '100%' }}
        animate={{ y: 0 }}
        exit={{ y: '100%' }}
        transition={{ type: 'spring', damping: 25, stiffness: 300 }}
        className="fixed inset-x-0 bottom-0 bg-white rounded-t-2xl shadow-2xl z-50 max-h-[70vh] overflow-auto"
      >
        {/* í—¤ë” */}
        <div className="sticky top-0 flex items-center justify-between p-4 border-b bg-white">
          <h2 className="text-lg font-semibold text-gray-900">í•„í„°</h2>
          <button
            onClick={toggleFilter}
            className="w-8 h-8 flex items-center justify-center bg-gray-100 rounded-full"
          >
            <XMarkIcon className="w-5 h-5 text-gray-500" />
          </button>
        </div>

        <div className="p-5 space-y-6">
          {/* ê¸°ê°„ */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-3">
              ê¸°ê°„
            </label>
            <div className="flex flex-wrap gap-3">
              {dateRangeOptions.map((option) => (
                <label
                  key={option.value}
                  className="flex items-center gap-2 cursor-pointer"
                >
                  <input
                    type="radio"
                    name="dateRange"
                    value={option.value}
                    checked={filter.dateRange === option.value}
                    onChange={(e) => setFilter({ dateRange: e.target.value as any })}
                    className="w-4 h-4 text-blue-500 border-gray-300 focus:ring-blue-500"
                  />
                  <span className="text-sm text-gray-700">{option.label}</span>
                </label>
              ))}
            </div>
          </div>

          {/* ê²°ì • ìš”ì†Œ */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-3">
              ê²°ì • ìš”ì†Œ
            </label>
            <div className="flex flex-wrap gap-4">
              {decisionElementOptions.map((option) => (
                <label
                  key={option.value}
                  className="flex items-center gap-2 cursor-pointer"
                >
                  <input
                    type="checkbox"
                    checked={filter.decisionElements.includes(option.value)}
                    onChange={(e) => {
                      const newElements = e.target.checked
                        ? [...filter.decisionElements, option.value]
                        : filter.decisionElements.filter(el => el !== option.value);
                      setFilter({ decisionElements: newElements });
                    }}
                    className="w-4 h-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500"
                  />
                  <span className="text-sm text-gray-700">{option.label}</span>
                </label>
              ))}
            </div>
          </div>
        </div>

        {/* í‘¸í„° */}
        <div className="sticky bottom-0 flex items-center justify-between p-4 border-t bg-white">
          <button
            onClick={handleReset}
            className="text-sm font-medium text-gray-500 hover:text-gray-900"
          >
            ì´ˆê¸°í™”
          </button>
          <button
            onClick={handleApply}
            className="h-11 px-6 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors"
          >
            ì ìš©{activeFilterCount > 0 ? ` (í•„í„° ${activeFilterCount})` : ''}
          </button>
        </div>
      </motion.div>
    </AnimatePresence>
  );
}
```

---

### 14.28 ê²€ìƒ‰ Analytics Hook (Part 5)

```typescript
// src/hooks/useSearchAnalytics.ts (Part 5)
import { useCallback } from 'react';
import { track } from '@/services/analytics';

type SearchQueryType = 'keyword' | 'natural' | 'time' | 'person' | 'decision_element';

export function useSearchAnalytics() {
  // Part 5.1: ê²€ìƒ‰ ì§„ì… ì´ë²¤íŠ¸
  const trackSearchTabOpened = useCallback((source: 'nav' | 'shortcut' | 'deep_link' = 'nav') => {
    track('search_tab_opened', { source });
  }, []);

  const trackSearchFocused = useCallback((hasRecentSearches: boolean) => {
    track('search_focused', { hasRecentSearches });
  }, []);

  const trackRecentSearchClicked = useCallback((query: string, ageInDays: number) => {
    track('recent_search_clicked', { query, ageInDays });
  }, []);

  const trackSuggestionClicked = useCallback((suggestion: string, position: number) => {
    track('suggestion_clicked', { suggestion, position });
  }, []);

  const trackSearchSubmitted = useCallback((query: string, queryType?: SearchQueryType) => {
    track('search_submitted', {
      query,
      queryLength: query.length,
      queryType: queryType || detectQueryType(query),
    });
  }, []);

  // Part 5.2: ê²€ìƒ‰ ê²°ê³¼ ì´ë²¤íŠ¸
  const trackSearchCompleted = useCallback((
    query: string,
    resultCount: number,
    searchTimeMs: number,
    semanticSuccess: boolean
  ) => {
    track('search_completed', { query, resultCount, searchTimeMs, semanticSuccess });
  }, []);

  const trackResultClicked = useCallback((meetingId: string, resultIndex: number, timeToClickMs?: number) => {
    track('result_clicked', { meetingId, resultIndex, timeToClickMs });
  }, []);

  const trackFilterOpened = useCallback((query: string) => {
    track('filter_opened', { query });
  }, []);

  const trackFilterApplied = useCallback((filter: Record<string, any>) => {
    track('filter_applied', filter);
  }, []);

  const trackFilterReset = useCallback(() => {
    track('filter_reset', {});
  }, []);

  const trackSortChanged = useCallback((from: string, to: string) => {
    track('sort_changed', { from, to });
  }, []);

  const trackNoResultsShown = useCallback((query: string, suggestions: string[]) => {
    track('no_results_shown', { query, suggestionCount: suggestions.length });
  }, []);

  // Part 5.3: ìƒì„¸ ì¡°íšŒ ì´ë²¤íŠ¸
  const trackDetailViewed = useCallback((meetingId: string, query: string, highlightCount: number) => {
    track('detail_viewed', { meetingId, query, highlightCount });
  }, []);

  const trackHighlightNavigated = useCallback((direction: 'prev' | 'next', position: number) => {
    track('highlight_navigated', { direction, position });
  }, []);

  const trackRelatedMeetingClicked = useCallback((fromMeetingId: string, toMeetingId: string) => {
    track('related_meeting_clicked', { fromMeetingId, toMeetingId });
  }, []);

  const trackDetailExited = useCallback((exitType: 'back_to_results' | 'new_search' | 'close') => {
    track('detail_exited', { exitType });
  }, []);

  return {
    // Part 5.1
    trackSearchTabOpened,
    trackSearchFocused,
    trackRecentSearchClicked,
    trackSuggestionClicked,
    trackSearchSubmitted,
    // Part 5.2
    trackSearchCompleted,
    trackResultClicked,
    trackFilterOpened,
    trackFilterApplied,
    trackFilterReset,
    trackSortChanged,
    trackNoResultsShown,
    // Part 5.3
    trackDetailViewed,
    trackHighlightNavigated,
    trackRelatedMeetingClicked,
    trackDetailExited,
  };
}

// ì¿¼ë¦¬ íƒ€ì… ê°ì§€
function detectQueryType(query: string): SearchQueryType {
  if (/\d+ê°œì›”|ì§€ë‚œ\s*(ì£¼|ë‹¬)|ìµœê·¼/.test(query)) return 'time';
  if (/[ê°€-í£]{2,4}(ëŒ€í‘œ|ê³¼ì¥|ë¶€ì¥|íŒ€ì¥|ë‹˜)/.test(query)) return 'person';
  if (/(ê²°ì •|ì•¡ì…˜|ë¦¬ìŠ¤í¬|ë¯¸í™•ì¸)/.test(query)) return 'decision_element';
  if (query.split(/\s+/).length > 3) return 'natural';
  return 'keyword';
}
```

### 14.29 ì„¤ì • Store (Part 5.2)

```typescript
// src/stores/settingsStore.ts (Part 5.2)
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

// Part 5.2 ì„¤ì • íƒ€ì…
type SettingsState = 'main' | 'category' | 'editing' | 'saving' | 'oauth' | 'confirming';

type SettingsCategory =
  | 'integration'
  | 'notification'
  | 'hud'
  | 'subscription'
  | 'privacy'
  | 'data'
  | 'help';

type IntegrationType = 'notion' | 'google_calendar' | 'outlook' | 'slack' | 'salesforce';

type NotificationFrequency = 'low' | 'medium' | 'high';

interface Integration {
  type: IntegrationType;
  connected: boolean;
  workspaceName?: string;
  accountEmail?: string;
  lastSyncAt?: Date;
  settings?: Record<string, any>;
}

interface NotificationSettings {
  frequency: NotificationFrequency;
  beforeMeeting: {
    prepReminder: boolean;
    prepReminderTime: '5min' | '10min' | '30min' | '1hour';
    scheduleChange: boolean;
  };
  duringMeeting: {
    aiInsight: boolean;
    gapDetection: boolean;
    riskAlert: boolean;
  };
  afterMeeting: {
    confirmReminder: boolean;
    confirmReminderTime: '1hour' | '3hours' | '1day';
    actionReminder: boolean;
  };
  doNotDisturb: {
    enabled: boolean;
    startTime: string;  // "22:00"
    endTime: string;    // "08:00"
  };
}

interface HudSettings {
  position: 'right' | 'left';
  autoStart: boolean;
  transparency: number;  // 0-100
  defaultState: 'minimized' | 'expanded';
}

interface UserProfile {
  id: string;
  name: string;
  email: string;
  avatarUrl?: string;
  company?: string;
  role?: string;
  emailVerified: boolean;
}

interface UserStats {
  totalMeetings: number;
  thisMonthMeetings: number;
  savedInsights: number;
}

interface SettingsStore {
  // ìƒíƒœ
  state: SettingsState;
  currentCategory: SettingsCategory | null;
  isLoading: boolean;
  error: string | null;

  // í”„ë¡œí•„
  profile: UserProfile | null;
  stats: UserStats | null;

  // í†µí•©
  integrations: Integration[];

  // ì•Œë¦¼
  notificationSettings: NotificationSettings;

  // HUD
  hudSettings: HudSettings;

  // êµ¬ë…
  subscription: {
    plan: 'free' | 'pro' | 'enterprise';
    nextBillingDate?: Date;
    amount?: number;
  };

  // ì•¡ì…˜
  openSettings: () => void;
  closeSettings: () => void;
  openCategory: (category: SettingsCategory) => void;
  goBack: () => void;

  // í”„ë¡œí•„ ì•¡ì…˜
  updateProfile: (updates: Partial<UserProfile>) => Promise<void>;
  uploadAvatar: (file: File) => Promise<void>;

  // í†µí•© ì•¡ì…˜
  connectIntegration: (type: IntegrationType) => Promise<void>;
  disconnectIntegration: (type: IntegrationType) => Promise<void>;
  updateIntegrationSettings: (type: IntegrationType, settings: Record<string, any>) => Promise<void>;

  // ì•Œë¦¼ ì•¡ì…˜
  updateNotificationSettings: (settings: Partial<NotificationSettings>) => void;
  toggleNotification: (key: string, value: boolean) => void;

  // HUD ì•¡ì…˜
  updateHudSettings: (settings: Partial<HudSettings>) => void;

  // ê³„ì • ì•¡ì…˜
  changePassword: (current: string, newPassword: string) => Promise<void>;
  toggle2FA: (enabled: boolean) => Promise<void>;
  logout: () => Promise<void>;
  requestAccountDeletion: (reason?: string) => Promise<void>;
}

export const useSettingsStore = create<SettingsStore>()(
  persist(
    (set, get) => ({
      // ì´ˆê¸° ìƒíƒœ
      state: 'main',
      currentCategory: null,
      isLoading: false,
      error: null,
      profile: null,
      stats: null,
      integrations: [],
      notificationSettings: {
        frequency: 'medium',
        beforeMeeting: {
          prepReminder: true,
          prepReminderTime: '10min',
          scheduleChange: true,
        },
        duringMeeting: {
          aiInsight: true,
          gapDetection: true,
          riskAlert: true,
        },
        afterMeeting: {
          confirmReminder: true,
          confirmReminderTime: '1hour',
          actionReminder: true,
        },
        doNotDisturb: {
          enabled: false,
          startTime: '22:00',
          endTime: '08:00',
        },
      },
      hudSettings: {
        position: 'right',
        autoStart: true,
        transparency: 100,
        defaultState: 'minimized',
      },
      subscription: {
        plan: 'free',
      },

      // ë„¤ë¹„ê²Œì´ì…˜ ì•¡ì…˜
      openSettings: () => {
        set({ state: 'main', currentCategory: null });
        track('settings_opened', { entryPoint: 'header' });
      },

      closeSettings: () => {
        const { state } = get();
        set({ state: 'main', currentCategory: null });
        track('settings_closed', { fromState: state });
      },

      openCategory: (category) => {
        set({ state: 'category', currentCategory: category });
        track('settings_category_viewed', { category });
      },

      goBack: () => {
        const { state } = get();
        if (state === 'category' || state === 'editing') {
          set({ state: 'main', currentCategory: null });
        }
      },

      // í”„ë¡œí•„ ì•¡ì…˜
      updateProfile: async (updates) => {
        set({ state: 'saving' });
        try {
          const response = await fetch('/api/user/profile', {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updates),
          });

          if (!response.ok) throw new Error('Failed to update profile');

          const updatedProfile = await response.json();
          set({
            profile: updatedProfile,
            state: 'category',
            error: null
          });

          track('profile_updated', {
            fieldsChanged: Object.keys(updates)
          });
        } catch (error) {
          set({
            state: 'editing',
            error: 'Failed to update profile'
          });
        }
      },

      uploadAvatar: async (file) => {
        const formData = new FormData();
        formData.append('avatar', file);

        try {
          const response = await fetch('/api/user/avatar', {
            method: 'POST',
            body: formData,
          });

          if (!response.ok) throw new Error('Failed to upload avatar');

          const { avatarUrl } = await response.json();
          set((state) => ({
            profile: state.profile
              ? { ...state.profile, avatarUrl }
              : null,
          }));
        } catch (error) {
          set({ error: 'Failed to upload avatar' });
        }
      },

      // í†µí•© ì•¡ì…˜
      connectIntegration: async (type) => {
        set({ state: 'oauth' });
        track('integration_connect_started', { integrationType: type });

        try {
          // OAuth íŒì—… ì—´ê¸°
          const popup = window.open(
            `/api/integrations/${type}/connect`,
            'oauth',
            'width=600,height=700'
          );

          // íŒì—… ë©”ì‹œì§€ ëŒ€ê¸°
          const result = await new Promise<Integration>((resolve, reject) => {
            const handleMessage = (event: MessageEvent) => {
              if (event.data.type === 'OAUTH_SUCCESS') {
                resolve(event.data.integration);
              } else if (event.data.type === 'OAUTH_ERROR') {
                reject(new Error(event.data.error));
              }
            };
            window.addEventListener('message', handleMessage);

            // íŒì—… ë‹«í˜ ê°ì§€
            const checkClosed = setInterval(() => {
              if (popup?.closed) {
                clearInterval(checkClosed);
                window.removeEventListener('message', handleMessage);
                reject(new Error('OAuth popup closed'));
              }
            }, 500);
          });

          set((state) => ({
            integrations: [
              ...state.integrations.filter((i) => i.type !== type),
              result,
            ],
            state: 'category',
          }));

          track('integration_connected', {
            integrationType: type,
            workspaceName: result.workspaceName,
          });
        } catch (error) {
          set({ state: 'category', error: 'Failed to connect' });
          track('integration_connect_failed', {
            integrationType: type,
            error: (error as Error).message,
          });
        }
      },

      disconnectIntegration: async (type) => {
        set({ state: 'confirming' });
      },

      updateIntegrationSettings: async (type, settings) => {
        set({ state: 'saving' });
        try {
          await fetch(`/api/integrations/${type}/settings`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(settings),
          });

          set((state) => ({
            integrations: state.integrations.map((i) =>
              i.type === type ? { ...i, settings } : i
            ),
            state: 'category',
          }));

          track('integration_settings_changed', {
            integrationType: type,
            settings
          });
        } catch (error) {
          set({ state: 'editing', error: 'Failed to update settings' });
        }
      },

      // ì•Œë¦¼ ì•¡ì…˜
      updateNotificationSettings: (settings) => {
        set((state) => ({
          notificationSettings: {
            ...state.notificationSettings,
            ...settings,
          },
        }));
      },

      toggleNotification: (key, value) => {
        const [category, setting] = key.split('.') as [
          'beforeMeeting' | 'duringMeeting' | 'afterMeeting',
          string
        ];

        set((state) => ({
          notificationSettings: {
            ...state.notificationSettings,
            [category]: {
              ...state.notificationSettings[category],
              [setting]: value,
            },
          },
        }));

        track('notification_toggled', {
          notificationType: setting,
          category,
          newState: value,
        });
      },

      // HUD ì•¡ì…˜
      updateHudSettings: (settings) => {
        set((state) => ({
          hudSettings: {
            ...state.hudSettings,
            ...settings,
          },
        }));
      },

      // ê³„ì • ì•¡ì…˜
      changePassword: async (current, newPassword) => {
        set({ state: 'saving' });
        try {
          const response = await fetch('/api/user/password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ current, newPassword }),
          });

          if (!response.ok) {
            const { error } = await response.json();
            throw new Error(error);
          }

          set({ state: 'category', error: null });
          track('password_changed', { success: true });
        } catch (error) {
          set({ state: 'editing', error: (error as Error).message });
          track('password_changed', {
            success: false,
            failureReason: (error as Error).message
          });
        }
      },

      toggle2FA: async (enabled) => {
        try {
          await fetch('/api/user/2fa', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ enabled }),
          });

          track('two_factor_toggled', { enabled });
        } catch (error) {
          set({ error: 'Failed to update 2FA' });
        }
      },

      logout: async () => {
        await fetch('/api/auth/logout', { method: 'POST' });
        track('logout', { logoutType: 'manual' });
        window.location.href = '/login';
      },

      requestAccountDeletion: async (reason) => {
        try {
          await fetch('/api/user/delete-request', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ reason }),
          });

          track('account_delete_requested', { reason });
        } catch (error) {
          set({ error: 'Failed to request deletion' });
        }
      },
    }),
    {
      name: 'settings-storage',
      partialize: (state) => ({
        notificationSettings: state.notificationSettings,
        hudSettings: state.hudSettings,
      }),
    }
  )
);

// Analytics íŠ¸ë˜í‚¹ í•¨ìˆ˜
function track(event: string, properties?: Record<string, any>) {
  if (import.meta.env.DEV) {
    console.log('ğŸ“Š Settings:', event, properties);
  }
  // PostHogì— ì „ì†¡
  window.posthog?.capture(event, properties);
}
```

### 14.30 ì„¤ì • ë©”ì¸ í™”ë©´ ì»´í¬ë„ŒíŠ¸ (Part 5.2)

```tsx
// src/components/Settings/SettingsScreen.tsx (Part 5.2)
import React, { useEffect } from 'react';
import { useSettingsStore } from '@/stores/settingsStore';
import { SettingsHeader } from './SettingsHeader';
import { ProfileSection } from './ProfileSection';
import { StatsSection } from './StatsSection';
import { CategoryList } from './CategoryList';
import { IntegrationSettings } from './IntegrationSettings';
import { NotificationSettings } from './NotificationSettings';
import { ProfileEditScreen } from './ProfileEditScreen';
import { cn } from '@/utils/cn';

export const SettingsScreen: React.FC = () => {
  const {
    state,
    currentCategory,
    profile,
    stats,
    openSettings,
  } = useSettingsStore();

  useEffect(() => {
    openSettings();
  }, []);

  // ì¹´í…Œê³ ë¦¬ë³„ ì„œë¸Œ í™”ë©´ ë Œë”ë§
  if (state === 'category' && currentCategory) {
    switch (currentCategory) {
      case 'integration':
        return <IntegrationSettings />;
      case 'notification':
        return <NotificationSettings />;
      // ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ë“¤...
      default:
        return null;
    }
  }

  // í”„ë¡œí•„ í¸ì§‘ í™”ë©´
  if (state === 'editing') {
    return <ProfileEditScreen />;
  }

  // ë©”ì¸ ì„¤ì • í™”ë©´
  return (
    <div className="flex flex-col min-h-screen bg-gray-50">
      <SettingsHeader title="ì„¤ì •" showSearch />

      {/* Profile Section */}
      <ProfileSection profile={profile} />

      {/* Stats Section */}
      <StatsSection stats={stats} />

      {/* Category List */}
      <CategoryList />

      {/* Footer */}
      <div className="mt-auto px-4 py-6 text-center">
        <p className="text-xs text-gray-400">
          Onno v1.0.0
        </p>
      </div>
    </div>
  );
};

// Profile Section ì»´í¬ë„ŒíŠ¸
const ProfileSection: React.FC<{ profile: UserProfile | null }> = ({ profile }) => {
  const { openCategory } = useSettingsStore();

  if (!profile) return null;

  const initials = profile.name
    .split(' ')
    .map(n => n[0])
    .join('')
    .toUpperCase();

  return (
    <div className="flex flex-col items-center py-6 px-4 bg-white border-b border-gray-200">
      {/* Avatar */}
      <div className="w-20 h-20 rounded-full bg-blue-500 flex items-center justify-center text-white text-2xl font-bold">
        {profile.avatarUrl ? (
          <img
            src={profile.avatarUrl}
            alt={profile.name}
            className="w-full h-full rounded-full object-cover"
          />
        ) : (
          initials
        )}
      </div>

      {/* Name & Email */}
      <h2 className="mt-3 text-lg font-semibold text-gray-900">
        {profile.name}
      </h2>
      <p className="text-sm text-gray-500">
        {profile.email}
      </p>

      {/* Edit Button */}
      <button
        onClick={() => openCategory('profile')}
        className="mt-3 px-4 py-2 text-sm font-medium text-gray-700
                   bg-white border border-gray-200 rounded-lg
                   hover:bg-gray-50 hover:border-gray-300
                   transition-colors"
      >
        í”„ë¡œí•„ í¸ì§‘
      </button>
    </div>
  );
};

// Stats Section ì»´í¬ë„ŒíŠ¸
const StatsSection: React.FC<{ stats: UserStats | null }> = ({ stats }) => {
  if (!stats) return null;

  const items = [
    { label: 'ì´ ë¯¸íŒ…', value: `${stats.totalMeetings}ê±´` },
    { label: 'ì´ë²ˆ ë‹¬', value: `${stats.thisMonthMeetings}ê±´` },
    { label: 'ì €ì¥ëœ ì¸ì‚¬ì´íŠ¸', value: `${stats.savedInsights}ê°œ` },
  ];

  return (
    <div className="py-4 px-4 bg-white border-b-8 border-gray-100">
      <h3 className="text-sm font-semibold text-gray-500 mb-2">
        ğŸ“Š ì‚¬ìš© ìš”ì•½
      </h3>
      {items.map((item) => (
        <div key={item.label} className="flex justify-between py-1">
          <span className="text-sm text-gray-600">{item.label}</span>
          <span className="text-sm font-semibold text-gray-900">{item.value}</span>
        </div>
      ))}
    </div>
  );
};

// Category List ì»´í¬ë„ŒíŠ¸
const CategoryList: React.FC = () => {
  const { openCategory, logout, integrations } = useSettingsStore();

  const categories = [
    {
      id: 'integration',
      icon: 'ğŸ”—',
      label: 'í†µí•©',
      badge: integrations.filter(i => !i.connected).length > 0
        ? 'ì—°ê²° í•„ìš”'
        : undefined,
    },
    { id: 'notification', icon: 'ğŸ””', label: 'ì•Œë¦¼' },
    { id: 'hud', icon: 'ğŸ¨', label: 'HUD ì„¤ì •' },
    { id: 'subscription', icon: 'ğŸ’³', label: 'êµ¬ë…' },
    { id: 'privacy', icon: 'ğŸ”’', label: 'ê°œì¸ì •ë³´ ë° ë³´ì•ˆ' },
    { id: 'data', icon: 'ğŸ“', label: 'ë°ì´í„° ê´€ë¦¬' },
    { id: 'help', icon: 'â“', label: 'ë„ì›€ë§' },
  ];

  return (
    <div className="bg-white">
      {categories.map((category) => (
        <button
          key={category.id}
          onClick={() => openCategory(category.id as SettingsCategory)}
          className="w-full h-14 px-4 flex items-center gap-3
                     border-b border-gray-100 hover:bg-gray-50
                     transition-colors"
        >
          <span className="text-xl">{category.icon}</span>
          <span className="flex-1 text-left text-sm font-medium text-gray-900">
            {category.label}
          </span>
          {category.badge && (
            <span className="px-2 py-0.5 text-xs font-medium text-blue-700
                           bg-blue-100 rounded-full">
              {category.badge}
            </span>
          )}
          <svg className="w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
          </svg>
        </button>
      ))}

      {/* Logout */}
      <button
        onClick={logout}
        className="w-full h-14 px-4 flex items-center gap-3
                   mt-2 border-b border-gray-100 hover:bg-gray-50"
      >
        <span className="text-xl">ğŸšª</span>
        <span className="text-sm font-medium text-red-500">ë¡œê·¸ì•„ì›ƒ</span>
      </button>
    </div>
  );
};
```

### 14.31 í†µí•© ê´€ë¦¬ ì»´í¬ë„ŒíŠ¸ (Part 5.2)

```tsx
// src/components/Settings/IntegrationSettings.tsx (Part 5.2)
import React, { useState } from 'react';
import { useSettingsStore } from '@/stores/settingsStore';
import { SettingsHeader } from './SettingsHeader';
import { DisconnectDialog } from './DisconnectDialog';
import { NotionSettingsModal } from './NotionSettingsModal';

const INTEGRATIONS = [
  {
    type: 'notion',
    name: 'Notion',
    icon: 'ğŸ““',
    description: 'ë¯¸íŒ… ë‚´ìš©ì„ Notionì— ìë™ ì €ì¥',
    available: true,
  },
  {
    type: 'google_calendar',
    name: 'Google Calendar',
    icon: 'ğŸ“…',
    description: 'Google ìº˜ë¦°ë”ì—ì„œ ì¼ì • ê°€ì ¸ì˜¤ê¸°',
    available: true,
  },
  {
    type: 'outlook',
    name: 'Outlook Calendar',
    icon: 'ğŸ“…',
    description: 'Microsoft ìº˜ë¦°ë”ì™€ ì—°ë™',
    available: true,
  },
  {
    type: 'slack',
    name: 'Slack',
    icon: 'ğŸ’¬',
    description: 'ë¯¸íŒ… ìš”ì•½ì„ ì±„ë„ì— ìë™ ê³µìœ ',
    available: false,
  },
  {
    type: 'salesforce',
    name: 'Salesforce',
    icon: 'ğŸ“Š',
    description: 'CRMê³¼ ë¯¸íŒ… ë°ì´í„° ìë™ ì—°ë™',
    available: false,
  },
];

export const IntegrationSettings: React.FC = () => {
  const {
    integrations,
    connectIntegration,
    disconnectIntegration,
    state,
  } = useSettingsStore();

  const [disconnectTarget, setDisconnectTarget] = useState<string | null>(null);
  const [notionModalOpen, setNotionModalOpen] = useState(false);

  const connectedIntegrations = integrations.filter(i => i.connected);
  const availableIntegrations = INTEGRATIONS.filter(
    i => i.available && !integrations.find(int => int.type === i.type && int.connected)
  );
  const comingSoonIntegrations = INTEGRATIONS.filter(i => !i.available);

  const handleConnect = (type: string) => {
    connectIntegration(type as IntegrationType);
  };

  const handleDisconnect = (type: string) => {
    setDisconnectTarget(type);
  };

  const confirmDisconnect = async () => {
    if (disconnectTarget) {
      await disconnectIntegration(disconnectTarget as IntegrationType);
      setDisconnectTarget(null);
    }
  };

  return (
    <div className="flex flex-col min-h-screen bg-gray-50">
      <SettingsHeader title="í†µí•©" />

      <div className="flex-1 p-4 space-y-6">
        {/* ì—°ê²°ë¨ */}
        {connectedIntegrations.length > 0 && (
          <section>
            <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">
              ì—°ê²°ë¨
            </h3>
            <div className="space-y-3">
              {connectedIntegrations.map((integration) => {
                const info = INTEGRATIONS.find(i => i.type === integration.type);
                return (
                  <div
                    key={integration.type}
                    className="p-4 bg-white rounded-xl border border-gray-200 shadow-sm"
                  >
                    <div className="flex items-center gap-3">
                      <div className="w-12 h-12 rounded-lg bg-gray-100 flex items-center justify-center text-2xl">
                        {info?.icon}
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center gap-2">
                          <span className="font-semibold text-gray-900">
                            {info?.name}
                          </span>
                          <span className="px-2 py-0.5 text-xs font-medium text-green-700 bg-green-100 rounded-full">
                            ì—°ê²°ë¨
                          </span>
                        </div>
                      </div>
                    </div>

                    {/* Connection Details */}
                    <div className="mt-3 ml-15 space-y-1 text-sm text-gray-500">
                      {integration.workspaceName && (
                        <p>
                          <span className="text-gray-400 mr-2">ì›Œí¬ìŠ¤í˜ì´ìŠ¤:</span>
                          <span className="text-gray-700">{integration.workspaceName}</span>
                        </p>
                      )}
                      {integration.accountEmail && (
                        <p>
                          <span className="text-gray-400 mr-2">ê³„ì •:</span>
                          <span className="text-gray-700">{integration.accountEmail}</span>
                        </p>
                      )}
                      {integration.lastSyncAt && (
                        <p className="text-green-600 text-xs">
                          ë§ˆì§€ë§‰ ë™ê¸°í™”: {formatRelativeTime(integration.lastSyncAt)}
                        </p>
                      )}
                    </div>

                    {/* Actions */}
                    <div className="mt-3 ml-15 flex gap-2">
                      <button
                        onClick={() => {
                          if (integration.type === 'notion') {
                            setNotionModalOpen(true);
                          }
                        }}
                        className="px-3 py-1.5 text-sm font-medium text-gray-700
                                   bg-white border border-gray-200 rounded-md
                                   hover:bg-gray-50"
                      >
                        ì„¤ì • ë³€ê²½
                      </button>
                      <button
                        onClick={() => handleDisconnect(integration.type)}
                        className="px-3 py-1.5 text-sm font-medium text-red-600
                                   bg-white border border-red-300 rounded-md
                                   hover:bg-red-50"
                      >
                        ì—°ê²° í•´ì œ
                      </button>
                    </div>
                  </div>
                );
              })}
            </div>
          </section>
        )}

        {/* ì—°ê²° ê°€ëŠ¥ */}
        {availableIntegrations.length > 0 && (
          <section>
            <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">
              ì—°ê²° ê°€ëŠ¥
            </h3>
            <div className="space-y-3">
              {availableIntegrations.map((integration) => (
                <button
                  key={integration.type}
                  onClick={() => handleConnect(integration.type)}
                  disabled={state === 'oauth'}
                  className="w-full p-4 bg-white rounded-xl border border-gray-200
                             flex items-center gap-3 text-left
                             hover:border-blue-500 hover:bg-blue-50
                             transition-colors disabled:opacity-50"
                >
                  <div className="w-12 h-12 rounded-lg bg-gray-100 flex items-center justify-center text-2xl">
                    {integration.icon}
                  </div>
                  <div className="flex-1">
                    <p className="font-semibold text-gray-900">{integration.name}</p>
                    <p className="text-sm text-gray-500">{integration.description}</p>
                  </div>
                  <span className="px-4 py-2 text-sm font-semibold text-white bg-blue-500 rounded-lg">
                    ì—°ê²°í•˜ê¸°
                  </span>
                </button>
              ))}
            </div>
          </section>
        )}

        {/* ì¶œì‹œ ì˜ˆì • */}
        <section>
          <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">
            ì¶œì‹œ ì˜ˆì •
          </h3>
          <div className="space-y-3">
            {comingSoonIntegrations.map((integration) => (
              <div
                key={integration.type}
                className="p-4 bg-gray-50 rounded-xl border border-dashed border-gray-300
                           flex items-center gap-3 opacity-80"
              >
                <div className="w-12 h-12 rounded-lg bg-gray-100 flex items-center justify-center text-2xl">
                  {integration.icon}
                </div>
                <div className="flex-1">
                  <p className="font-semibold text-gray-700">{integration.name}</p>
                  <p className="text-sm text-gray-500">{integration.description}</p>
                </div>
                <span className="px-3 py-1.5 text-xs font-medium text-gray-500 bg-gray-100 rounded-full">
                  Coming Soon
                </span>
              </div>
            ))}
          </div>
        </section>
      </div>

      {/* Disconnect Dialog */}
      {disconnectTarget && (
        <DisconnectDialog
          integrationType={disconnectTarget}
          onConfirm={confirmDisconnect}
          onCancel={() => setDisconnectTarget(null)}
        />
      )}

      {/* Notion Settings Modal */}
      {notionModalOpen && (
        <NotionSettingsModal onClose={() => setNotionModalOpen(false)} />
      )}
    </div>
  );
};

function formatRelativeTime(date: Date): string {
  const diff = Date.now() - new Date(date).getTime();
  const minutes = Math.floor(diff / 60000);
  if (minutes < 1) return 'ë°©ê¸ˆ ì „';
  if (minutes < 60) return `${minutes}ë¶„ ì „`;
  const hours = Math.floor(minutes / 60);
  if (hours < 24) return `${hours}ì‹œê°„ ì „`;
  return `${Math.floor(hours / 24)}ì¼ ì „`;
}
```

### 14.32 ì•Œë¦¼ ì„¤ì • ì»´í¬ë„ŒíŠ¸ (Part 5.2)

```tsx
// src/components/Settings/NotificationSettings.tsx (Part 5.2)
import React, { useState } from 'react';
import { useSettingsStore } from '@/stores/settingsStore';
import { SettingsHeader } from './SettingsHeader';
import { Toggle } from '@/components/ui/Toggle';
import { Slider } from '@/components/ui/Slider';

const FREQUENCY_LABELS = {
  low: { label: 'ì ìŒ', description: 'í•˜ë£¨ í‰ê·  1-2ê°œ' },
  medium: { label: 'ë³´í†µ', description: 'í•˜ë£¨ í‰ê·  3-5ê°œ' },
  high: { label: 'ë§ìŒ', description: 'í•˜ë£¨ í‰ê·  8-12ê°œ' },
};

export const NotificationSettings: React.FC = () => {
  const { notificationSettings, updateNotificationSettings, toggleNotification } = useSettingsStore();
  const [expandedSection, setExpandedSection] = useState<string | null>('beforeMeeting');

  const sections = [
    {
      id: 'beforeMeeting',
      title: 'ë¯¸íŒ… ì „',
      items: [
        {
          key: 'beforeMeeting.prepReminder',
          label: 'ì¤€ë¹„ ë¦¬ë§ˆì¸ë”',
          description: 'ë¯¸íŒ… ì „ ì¤€ë¹„ ì•Œë¦¼',
          value: notificationSettings.beforeMeeting.prepReminder,
          timeSelect: {
            key: 'beforeMeeting.prepReminderTime',
            value: notificationSettings.beforeMeeting.prepReminderTime,
            options: [
              { value: '5min', label: '5ë¶„ ì „' },
              { value: '10min', label: '10ë¶„ ì „' },
              { value: '30min', label: '30ë¶„ ì „' },
              { value: '1hour', label: '1ì‹œê°„ ì „' },
            ],
          },
        },
        {
          key: 'beforeMeeting.scheduleChange',
          label: 'ì¼ì • ë³€ê²½ ì•Œë¦¼',
          description: 'ë¯¸íŒ… ì‹œê°„/ì°¸ì„ì ë³€ê²½ ì‹œ',
          value: notificationSettings.beforeMeeting.scheduleChange,
        },
      ],
    },
    {
      id: 'duringMeeting',
      title: 'ë¯¸íŒ… ì¤‘',
      items: [
        {
          key: 'duringMeeting.aiInsight',
          label: 'AI ì¸ì‚¬ì´íŠ¸',
          description: 'ì¤‘ìš” ìˆ˜ì¹˜, ê²°ì • ì‚¬í•­ ê°ì§€ ì‹œ',
          value: notificationSettings.duringMeeting.aiInsight,
        },
        {
          key: 'duringMeeting.gapDetection',
          label: 'ê°­ ê°ì§€ ì•Œë¦¼',
          description: 'ë†“ì¹œ ì§ˆë¬¸, ë¯¸í™•ì¸ ì‚¬í•­ ê°ì§€ ì‹œ',
          value: notificationSettings.duringMeeting.gapDetection,
        },
        {
          key: 'duringMeeting.riskAlert',
          label: 'ìœ„í—˜ ì‹ í˜¸ ì•Œë¦¼',
          description: 'ë¶€ì •ì  ì‹ í˜¸, ë¦¬ìŠ¤í¬ ê°ì§€ ì‹œ',
          value: notificationSettings.duringMeeting.riskAlert,
        },
      ],
    },
    {
      id: 'afterMeeting',
      title: 'ë¯¸íŒ… í›„',
      items: [
        {
          key: 'afterMeeting.confirmReminder',
          label: 'í™•ì • ë¦¬ë§ˆì¸ë”',
          description: 'ë¯¸í™•ì • ë¯¸íŒ… ë¦¬ë§ˆì¸ë”',
          value: notificationSettings.afterMeeting.confirmReminder,
          timeSelect: {
            key: 'afterMeeting.confirmReminderTime',
            value: notificationSettings.afterMeeting.confirmReminderTime,
            options: [
              { value: '1hour', label: '1ì‹œê°„ í›„' },
              { value: '3hours', label: '3ì‹œê°„ í›„' },
              { value: '1day', label: '1ì¼ í›„' },
            ],
          },
        },
        {
          key: 'afterMeeting.actionReminder',
          label: 'ì•¡ì…˜ ì•„ì´í…œ ë¦¬ë§ˆì¸ë”',
          description: 'ê¸°í•œ ì„ë°• ì•¡ì…˜ ì•„ì´í…œ',
          value: notificationSettings.afterMeeting.actionReminder,
        },
      ],
    },
  ];

  const frequencyToValue = (freq: string): number => {
    switch (freq) {
      case 'low': return 0;
      case 'medium': return 50;
      case 'high': return 100;
      default: return 50;
    }
  };

  const valueToFrequency = (value: number): 'low' | 'medium' | 'high' => {
    if (value < 33) return 'low';
    if (value < 67) return 'medium';
    return 'high';
  };

  return (
    <div className="flex flex-col min-h-screen bg-gray-50">
      <SettingsHeader title="ì•Œë¦¼" />

      {/* Frequency Slider */}
      <div className="p-5 bg-white border-b-8 border-gray-100">
        <h3 className="text-sm font-semibold text-gray-900 mb-3">
          ì•Œë¦¼ ë¹ˆë„
        </h3>
        <div className="mb-3">
          <Slider
            value={frequencyToValue(notificationSettings.frequency)}
            onChange={(value) => {
              updateNotificationSettings({
                frequency: valueToFrequency(value)
              });
            }}
            min={0}
            max={100}
            step={50}
          />
          <div className="flex justify-between mt-2 text-xs text-gray-400">
            <span>ì ìŒ</span>
            <span>ë³´í†µ</span>
            <span>ë§ìŒ</span>
          </div>
        </div>
        <div className="flex items-center gap-2 px-3 py-2 bg-blue-50 rounded-lg">
          <span className="text-blue-600">ğŸ’¡</span>
          <span className="text-sm text-blue-700">
            {FREQUENCY_LABELS[notificationSettings.frequency].description}
          </span>
        </div>
      </div>

      {/* Category Sections */}
      {sections.map((section) => (
        <div key={section.id} className="bg-white border-b border-gray-200">
          {/* Section Header */}
          <button
            onClick={() => setExpandedSection(
              expandedSection === section.id ? null : section.id
            )}
            className="w-full h-13 px-4 flex items-center justify-between
                       hover:bg-gray-50 transition-colors"
          >
            <span className="text-sm font-semibold text-gray-900">
              {section.title}
            </span>
            <svg
              className={`w-5 h-5 text-gray-400 transition-transform
                         ${expandedSection === section.id ? 'rotate-180' : ''}`}
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          {/* Section Content */}
          {expandedSection === section.id && (
            <div className="px-4 pb-4 space-y-1">
              {section.items.map((item) => (
                <div
                  key={item.key}
                  className="py-3 border-b border-gray-100 last:border-0"
                >
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm font-medium text-gray-700">
                        {item.label}
                      </p>
                      <p className="text-xs text-gray-400 mt-0.5">
                        {item.description}
                      </p>
                    </div>
                    <Toggle
                      checked={item.value}
                      onChange={(checked) => toggleNotification(item.key, checked)}
                    />
                  </div>

                  {/* Time Select (if exists) */}
                  {item.timeSelect && item.value && (
                    <div className="ml-6 mt-2 flex items-center gap-2">
                      <span className="text-xs text-gray-400">ì•Œë¦¼ ì‹œì :</span>
                      <select
                        value={item.timeSelect.value}
                        onChange={(e) => {
                          // Update time setting
                        }}
                        className="px-3 py-1.5 text-sm bg-gray-100 border border-gray-200
                                   rounded-md text-gray-700"
                      >
                        {item.timeSelect.options.map((opt) => (
                          <option key={opt.value} value={opt.value}>
                            {opt.label}
                          </option>
                        ))}
                      </select>
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}
        </div>
      ))}

      {/* Do Not Disturb */}
      <div className="mt-2 p-4 bg-white">
        <h3 className="text-sm font-semibold text-gray-900 mb-3">
          ë°©í•´ ê¸ˆì§€
        </h3>
        <div className="p-4 bg-gray-50 border border-gray-200 rounded-xl flex gap-3">
          <span className="text-xl">ğŸŒ™</span>
          <div className="flex-1">
            <div className="flex items-center justify-between">
              <p className="text-sm font-semibold text-gray-900">
                ë°©í•´ ê¸ˆì§€ ì‹œê°„
              </p>
              <Toggle
                checked={notificationSettings.doNotDisturb.enabled}
                onChange={(enabled) => {
                  updateNotificationSettings({
                    doNotDisturb: {
                      ...notificationSettings.doNotDisturb,
                      enabled,
                    },
                  });
                }}
              />
            </div>
            <p className="text-sm text-gray-500 mt-1">
              {notificationSettings.doNotDisturb.startTime} - {notificationSettings.doNotDisturb.endTime}
            </p>
            <p className="text-xs text-gray-400 mt-1">
              ì´ ì‹œê°„ì—ëŠ” ì•Œë¦¼ì„ ë³´ë‚´ì§€ ì•Šì•„ìš”
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};
```

### 14.33 ì„¤ì • Analytics Hook (Part 5.2)

```tsx
// src/hooks/useSettingsAnalytics.ts (Part 5.2)
import { useCallback } from 'react';
import { track } from '@/services/analytics';

export function useSettingsAnalytics() {
  // Part 5.2.1: ì„¤ì • ë„¤ë¹„ê²Œì´ì…˜ ì´ë²¤íŠ¸
  const trackSettingsOpened = useCallback((entryPoint: string) => {
    track('settings_opened', { entryPoint, timestamp: new Date() });
  }, []);

  const trackSettingsClosed = useCallback((data: {
    exitMethod: 'back_button' | 'outside_click' | 'navigate_away';
    timeSpentMs: number;
    changesCount: number;
  }) => {
    track('settings_closed', { ...data, timestamp: new Date() });
  }, []);

  const trackCategoryViewed = useCallback((category: string) => {
    track('settings_category_viewed', { category, timestamp: new Date() });
  }, []);

  const trackSettingsSearched = useCallback((data: {
    query: string;
    resultCount: number;
    resultClicked: boolean;
  }) => {
    track('settings_searched', { ...data, timestamp: new Date() });
  }, []);

  // Part 5.2.2: í†µí•© ê´€ë¦¬ ì´ë²¤íŠ¸
  const trackIntegrationConnectStarted = useCallback((integrationType: string) => {
    track('integration_connect_started', {
      integrationType,
      timestamp: new Date()
    });
  }, []);

  const trackIntegrationConnected = useCallback((data: {
    integrationType: string;
    workspaceName?: string;
    accountEmail?: string;
    connectionTimeMs: number;
  }) => {
    track('integration_connected', { ...data, timestamp: new Date() });
  }, []);

  const trackIntegrationConnectFailed = useCallback((data: {
    integrationType: string;
    errorType: string;
    attemptNumber: number;
  }) => {
    track('integration_connect_failed', { ...data, timestamp: new Date() });
  }, []);

  const trackIntegrationDisconnected = useCallback((data: {
    integrationType: string;
    reason: string;
    connectionDurationDays: number;
  }) => {
    track('integration_disconnected', { ...data, timestamp: new Date() });
  }, []);

  // Part 5.2.3: ì•Œë¦¼ ì„¤ì • ì´ë²¤íŠ¸
  const trackNotificationToggled = useCallback((data: {
    notificationType: string;
    category: string;
    newState: boolean;
  }) => {
    track('notification_toggled', { ...data, timestamp: new Date() });
  }, []);

  const trackNotificationFrequencyChanged = useCallback((data: {
    from: string;
    to: string;
  }) => {
    track('notification_frequency_changed', { ...data, timestamp: new Date() });
  }, []);

  const trackDndToggled = useCallback((enabled: boolean) => {
    track('dnd_toggled', { enabled, timestamp: new Date() });
  }, []);

  // Part 5.2.4: ê³„ì • ì´ë²¤íŠ¸
  const trackProfileUpdated = useCallback((fieldsChanged: string[]) => {
    track('profile_updated', { fieldsChanged, timestamp: new Date() });
  }, []);

  const trackPasswordChanged = useCallback((success: boolean, failureReason?: string) => {
    track('password_changed', { success, failureReason, timestamp: new Date() });
  }, []);

  const trackLogout = useCallback(() => {
    track('logout', { logoutType: 'manual', timestamp: new Date() });
  }, []);

  const trackAccountDeleteRequested = useCallback((reason?: string) => {
    track('account_delete_requested', { reason, timestamp: new Date() });
  }, []);

  return {
    // ë„¤ë¹„ê²Œì´ì…˜
    trackSettingsOpened,
    trackSettingsClosed,
    trackCategoryViewed,
    trackSettingsSearched,
    // í†µí•©
    trackIntegrationConnectStarted,
    trackIntegrationConnected,
    trackIntegrationConnectFailed,
    trackIntegrationDisconnected,
    // ì•Œë¦¼
    trackNotificationToggled,
    trackNotificationFrequencyChanged,
    trackDndToggled,
    // ê³„ì •
    trackProfileUpdated,
    trackPasswordChanged,
    trackLogout,
    trackAccountDeleteRequested,
  };
}
```

---

### 14.34 ì—ëŸ¬ ì²˜ë¦¬ Store (Part 6.1)

ì—ëŸ¬ ì²˜ë¦¬ëŠ” **íš¡ë‹¨ ê´€ì‹¬ì‚¬(Cross-Cutting Concern)**ë¡œ, ëª¨ë“  í™”ë©´ì—ì„œ ì¼ê´€ë˜ê²Œ ë™ì‘í•©ë‹ˆë‹¤.

```typescript
// src/stores/errorStore.ts (Part 6.1)
import { create } from 'zustand';

// Part 6.1 ì—ëŸ¬ íƒ€ì… ì •ì˜
type ErrorSeverity = 'critical' | 'major' | 'minor' | 'info';
type ErrorDomain = 'network' | 'auth' | 'integration' | 'ai' | 'media' | 'storage' | 'validation';

interface AppError {
  id: string;
  code: string;
  domain: ErrorDomain;
  severity: ErrorSeverity;
  message: string;
  description?: string;
  cta?: {
    label: string;
    action: () => void | Promise<void>;
  };
  secondaryCta?: {
    label: string;
    action: () => void | Promise<void>;
  };
  dismissable: boolean;
  autoDismissMs?: number;
  recoveryStrategy?: RecoveryStrategy;
  context?: {
    screen: string;
    action: string;
  };
  timestamp: Date;
}

interface RecoveryStrategy {
  type: 'retry' | 'refresh_token' | 'reconnect' | 'fallback' | 'manual';
  maxRetries: number;
  currentRetry: number;
  backoffMs: number[];
  fallbackAction?: () => void;
}

type ErrorDisplayType = 'modal' | 'banner' | 'toast' | 'inline' | 'none';

interface ErrorState {
  // ì—ëŸ¬ ëª©ë¡
  errors: AppError[];

  // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ì—ëŸ¬
  activeModal: AppError | null;
  activeBanner: AppError | null;
  toasts: AppError[];

  // ì˜¤í”„ë¼ì¸ ìƒíƒœ
  isOffline: boolean;
  offlineSince: Date | null;
  pendingActions: number;

  // ë³µêµ¬ ìƒíƒœ
  isRecovering: boolean;
  recoveryProgress: {
    errorId: string;
    current: number;
    max: number;
  } | null;

  // ì•¡ì…˜
  addError: (error: Omit<AppError, 'id' | 'timestamp'>) => string;
  removeError: (id: string) => void;
  dismissError: (id: string) => void;
  clearAllErrors: () => void;

  // ë³µêµ¬ ì•¡ì…˜
  startRecovery: (errorId: string) => void;
  updateRecoveryProgress: (current: number, max: number) => void;
  completeRecovery: (success: boolean) => void;

  // ì˜¤í”„ë¼ì¸ ê´€ë ¨
  setOffline: (offline: boolean) => void;
  incrementPendingActions: () => void;
  decrementPendingActions: () => void;

  // ìœ í‹¸ë¦¬í‹°
  getErrorsByDomain: (domain: ErrorDomain) => AppError[];
  getErrorsBySeverity: (severity: ErrorSeverity) => AppError[];
  hasActiveError: () => boolean;
}

export const useErrorStore = create<ErrorState>((set, get) => ({
  errors: [],
  activeModal: null,
  activeBanner: null,
  toasts: [],
  isOffline: false,
  offlineSince: null,
  pendingActions: 0,
  isRecovering: false,
  recoveryProgress: null,

  addError: (error) => {
    const id = `err_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    const newError: AppError = {
      ...error,
      id,
      timestamp: new Date(),
    };

    // ì‹¬ê°ë„ë³„ í‘œì‹œ ë°©ì‹ ê²°ì •
    const displayType = getDisplayType(error.severity);

    set((state) => {
      const updates: Partial<ErrorState> = {
        errors: [...state.errors, newError],
      };

      switch (displayType) {
        case 'modal':
          updates.activeModal = newError;
          break;
        case 'banner':
          updates.activeBanner = newError;
          break;
        case 'toast':
          updates.toasts = [...state.toasts, newError].slice(-5); // ìµœëŒ€ 5ê°œ
          break;
      }

      return updates as ErrorState;
    });

    // ìë™ dismiss ì„¤ì •
    if (error.autoDismissMs) {
      setTimeout(() => {
        get().dismissError(id);
      }, error.autoDismissMs);
    }

    // ìë™ ë³µêµ¬ ì‹œì‘
    if (error.recoveryStrategy && error.recoveryStrategy.type !== 'manual') {
      get().startRecovery(id);
    }

    return id;
  },

  removeError: (id) => {
    set((state) => ({
      errors: state.errors.filter((e) => e.id !== id),
      activeModal: state.activeModal?.id === id ? null : state.activeModal,
      activeBanner: state.activeBanner?.id === id ? null : state.activeBanner,
      toasts: state.toasts.filter((e) => e.id !== id),
    }));
  },

  dismissError: (id) => {
    const error = get().errors.find((e) => e.id === id);
    if (error?.dismissable) {
      get().removeError(id);
    }
  },

  clearAllErrors: () => {
    set({
      errors: [],
      activeModal: null,
      activeBanner: null,
      toasts: [],
    });
  },

  startRecovery: (errorId) => {
    const error = get().errors.find((e) => e.id === errorId);
    if (!error?.recoveryStrategy) return;

    set({
      isRecovering: true,
      recoveryProgress: {
        errorId,
        current: error.recoveryStrategy.currentRetry + 1,
        max: error.recoveryStrategy.maxRetries,
      },
    });

    // ë³µêµ¬ ë¡œì§ ì‹¤í–‰
    executeRecovery(error, get);
  },

  updateRecoveryProgress: (current, max) => {
    set((state) => ({
      recoveryProgress: state.recoveryProgress
        ? { ...state.recoveryProgress, current, max }
        : null,
    }));
  },

  completeRecovery: (success) => {
    if (success && get().recoveryProgress) {
      get().removeError(get().recoveryProgress!.errorId);
    }
    set({
      isRecovering: false,
      recoveryProgress: null,
    });
  },

  setOffline: (offline) => {
    set({
      isOffline: offline,
      offlineSince: offline ? new Date() : null,
    });

    if (offline) {
      get().addError({
        code: 'OFFLINE',
        domain: 'network',
        severity: 'info',
        message: 'ì˜¤í”„ë¼ì¸ ëª¨ë“œì…ë‹ˆë‹¤',
        description: 'ì—°ê²°ë˜ë©´ ìë™ìœ¼ë¡œ ë™ê¸°í™”ë©ë‹ˆë‹¤',
        dismissable: false,
      });
    } else {
      // ì˜¤í”„ë¼ì¸ ì—ëŸ¬ ì œê±°
      const offlineErrors = get().errors.filter((e) => e.code === 'OFFLINE');
      offlineErrors.forEach((e) => get().removeError(e.id));

      // ì—°ê²° ë³µêµ¬ ì•Œë¦¼
      get().addError({
        code: 'ONLINE',
        domain: 'network',
        severity: 'info',
        message: 'ì—°ê²°ì´ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤',
        dismissable: true,
        autoDismissMs: 3000,
      });
    }
  },

  incrementPendingActions: () => {
    set((state) => ({ pendingActions: state.pendingActions + 1 }));
  },

  decrementPendingActions: () => {
    set((state) => ({ pendingActions: Math.max(0, state.pendingActions - 1) }));
  },

  getErrorsByDomain: (domain) => {
    return get().errors.filter((e) => e.domain === domain);
  },

  getErrorsBySeverity: (severity) => {
    return get().errors.filter((e) => e.severity === severity);
  },

  hasActiveError: () => {
    return get().errors.length > 0;
  },
}));

// ì‹¬ê°ë„ë³„ í‘œì‹œ íƒ€ì… ê²°ì •
function getDisplayType(severity: ErrorSeverity): ErrorDisplayType {
  switch (severity) {
    case 'critical':
      return 'modal';
    case 'major':
      return 'banner';
    case 'minor':
      return 'toast';
    case 'info':
      return 'toast';
    default:
      return 'toast';
  }
}

// ìë™ ë³µêµ¬ ì‹¤í–‰
async function executeRecovery(error: AppError, store: typeof useErrorStore.getState) {
  const strategy = error.recoveryStrategy!;

  while (strategy.currentRetry < strategy.maxRetries) {
    const backoffMs = strategy.backoffMs[strategy.currentRetry] || strategy.backoffMs[strategy.backoffMs.length - 1];

    await new Promise((resolve) => setTimeout(resolve, backoffMs));

    strategy.currentRetry++;
    store().updateRecoveryProgress(strategy.currentRetry, strategy.maxRetries);

    try {
      // ë³µêµ¬ ì‹œë„ (CTA ì•¡ì…˜ ì‹¤í–‰)
      if (error.cta?.action) {
        await error.cta.action();
        store().completeRecovery(true);
        return;
      }
    } catch {
      // ê³„ì† ì¬ì‹œë„
    }
  }

  // ìµœëŒ€ ì¬ì‹œë„ ì´ˆê³¼ - í´ë°± ì‹¤í–‰
  if (strategy.fallbackAction) {
    strategy.fallbackAction();
  }
  store().completeRecovery(false);
}
```

---

### 14.35 ì—ëŸ¬ ì»´í¬ë„ŒíŠ¸ (Part 6.1)

```typescript
// src/components/Error/ErrorModal.tsx (Part 6.1)
import { useErrorStore } from '@/stores/errorStore';
import { motion, AnimatePresence } from 'framer-motion';

export function ErrorModal() {
  const { activeModal, dismissError } = useErrorStore();

  if (!activeModal) return null;

  return (
    <AnimatePresence>
      <motion.div
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        exit={{ opacity: 0 }}
        className="fixed inset-0 z-[10000] flex items-center justify-center"
      >
        {/* Overlay */}
        <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" />

        {/* Modal */}
        <motion.div
          initial={{ scale: 0.95, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          exit={{ scale: 0.95, opacity: 0 }}
          className="relative w-[min(90vw,400px)] bg-white rounded-3xl p-12 text-center shadow-2xl"
        >
          {/* Icon */}
          <div className="text-6xl mb-6 animate-pulse">
            {getErrorIcon(activeModal.severity)}
          </div>

          {/* Title */}
          <h2 className="text-xl font-bold text-gray-900 mb-3">
            {activeModal.message}
          </h2>

          {/* Description */}
          {activeModal.description && (
            <p className="text-gray-500 text-sm mb-8 leading-relaxed">
              {activeModal.description}
            </p>
          )}

          {/* Primary CTA */}
          {activeModal.cta && (
            <button
              onClick={() => {
                activeModal.cta?.action();
                if (activeModal.dismissable) {
                  dismissError(activeModal.id);
                }
              }}
              className="w-full h-13 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-semibold transition-colors"
            >
              {activeModal.cta.label}
            </button>
          )}

          {/* Secondary CTA */}
          {activeModal.secondaryCta && (
            <button
              onClick={() => {
                activeModal.secondaryCta?.action();
              }}
              className="w-full h-13 mt-3 border border-gray-200 hover:bg-gray-50 text-gray-700 rounded-xl font-medium transition-colors"
            >
              {activeModal.secondaryCta.label}
            </button>
          )}
        </motion.div>
      </motion.div>
    </AnimatePresence>
  );
}

// src/components/Error/ErrorBanner.tsx (Part 6.1)
export function ErrorBanner() {
  const { activeBanner, dismissError } = useErrorStore();

  if (!activeBanner) return null;

  const variantStyles = {
    warning: 'bg-yellow-100 border-yellow-500 text-yellow-800',
    error: 'bg-red-100 border-red-500 text-red-800',
    info: 'bg-blue-100 border-blue-500 text-blue-800',
  };

  const variant = activeBanner.severity === 'major' ? 'error' : 'warning';

  return (
    <div
      className={`sticky top-0 z-[9000] w-full min-h-[52px] border-b px-4 py-3 flex items-center gap-3 ${variantStyles[variant]}`}
    >
      {/* Icon */}
      <span className="text-xl flex-shrink-0">
        {getErrorIcon(activeBanner.severity)}
      </span>

      {/* Message */}
      <p className="flex-1 text-sm font-medium leading-snug">
        {activeBanner.message}
        {activeBanner.description && (
          <span className="block text-xs opacity-80 mt-0.5">
            {activeBanner.description}
          </span>
        )}
      </p>

      {/* CTA */}
      {activeBanner.cta && (
        <button
          onClick={() => activeBanner.cta?.action()}
          className="h-8 px-4 border border-current rounded-md text-sm font-semibold hover:bg-black/5 transition-colors"
        >
          {activeBanner.cta.label}
        </button>
      )}

      {/* Close */}
      {activeBanner.dismissable && (
        <button
          onClick={() => dismissError(activeBanner.id)}
          className="w-8 h-8 flex items-center justify-center rounded-md opacity-60 hover:opacity-100 hover:bg-black/5 transition-all"
        >
          <span className="text-lg">Ã—</span>
        </button>
      )}
    </div>
  );
}

// src/components/Error/ErrorToast.tsx (Part 6.1)
import { motion, AnimatePresence } from 'framer-motion';

export function ErrorToastContainer() {
  const { toasts, dismissError, isRecovering, recoveryProgress } = useErrorStore();

  return (
    <div className="fixed bottom-6 right-6 z-[9500] flex flex-col gap-2 max-w-md">
      <AnimatePresence>
        {/* ë³µêµ¬ ì§„í–‰ í† ìŠ¤íŠ¸ */}
        {isRecovering && recoveryProgress && (
          <motion.div
            key="recovery"
            initial={{ opacity: 0, x: 100 }}
            animate={{ opacity: 1, x: 0 }}
            exit={{ opacity: 0, x: 100 }}
            className="min-w-[280px] bg-white rounded-xl p-4 shadow-lg border-l-4 border-blue-500"
          >
            <div className="flex items-center gap-2.5 mb-2">
              <span className="animate-spin">ğŸ”„</span>
              <span className="text-sm font-medium text-gray-900">ë³µêµ¬ ì¤‘...</span>
            </div>
            <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
              <div
                className="h-full bg-blue-500 rounded-full transition-all duration-300"
                style={{ width: `${(recoveryProgress.current / recoveryProgress.max) * 100}%` }}
              />
            </div>
            <div className="text-xs text-gray-500 text-right mt-1">
              {recoveryProgress.current}/{recoveryProgress.max}
            </div>
          </motion.div>
        )}

        {/* ì—ëŸ¬ í† ìŠ¤íŠ¸ */}
        {toasts.map((toast) => (
          <ErrorToast
            key={toast.id}
            error={toast}
            onDismiss={() => dismissError(toast.id)}
          />
        ))}
      </AnimatePresence>
    </div>
  );
}

function ErrorToast({ error, onDismiss }: { error: AppError; onDismiss: () => void }) {
  const borderColors = {
    critical: 'border-red-500',
    major: 'border-red-500',
    minor: 'border-yellow-500',
    info: 'border-blue-500',
  };

  return (
    <motion.div
      initial={{ opacity: 0, x: 100 }}
      animate={{ opacity: 1, x: 0 }}
      exit={{ opacity: 0, x: 100 }}
      className={`min-w-[280px] max-w-md bg-white rounded-xl p-3.5 shadow-lg border-l-4 ${borderColors[error.severity]} flex items-center gap-3`}
    >
      {/* Icon */}
      <span className="text-xl flex-shrink-0">
        {getErrorIcon(error.severity)}
      </span>

      {/* Message */}
      <p className="flex-1 text-sm font-medium text-gray-900 leading-snug">
        {error.message}
      </p>

      {/* CTA */}
      {error.cta && (
        <button
          onClick={() => error.cta?.action()}
          className="text-sm font-semibold text-blue-500 hover:bg-blue-50 px-2 py-1 rounded transition-colors"
        >
          {error.cta.label}
        </button>
      )}

      {/* Close */}
      {error.dismissable && (
        <button
          onClick={onDismiss}
          className="w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-all"
        >
          Ã—
        </button>
      )}

      {/* Auto dismiss progress */}
      {error.autoDismissMs && (
        <div
          className="absolute bottom-0 left-0 h-0.5 bg-current opacity-30 rounded-b-xl"
          style={{
            animation: `shrink ${error.autoDismissMs}ms linear forwards`,
          }}
        />
      )}
    </motion.div>
  );
}

function getErrorIcon(severity: ErrorSeverity): string {
  switch (severity) {
    case 'critical':
      return 'â›”';
    case 'major':
      return 'âŒ';
    case 'minor':
      return 'âš ï¸';
    case 'info':
      return 'â„¹ï¸';
    default:
      return 'âš ï¸';
  }
}
```

---

### 14.36 ì—ëŸ¬ Boundary (Part 6.1)

```typescript
// src/components/Error/ErrorBoundary.tsx (Part 6.1)
import React, { Component, ErrorInfo, ReactNode } from 'react';
import { useErrorStore } from '@/stores/errorStore';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
  onError?: (error: Error, errorInfo: ErrorInfo) => void;
}

interface State {
  hasError: boolean;
  error: Error | null;
}

export class ErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('ErrorBoundary caught error:', error, errorInfo);

    // ì—ëŸ¬ ìŠ¤í† ì–´ì— ì¶”ê°€
    useErrorStore.getState().addError({
      code: 'RENDER_ERROR',
      domain: 'validation',
      severity: 'critical',
      message: 'í™”ë©´ í‘œì‹œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',
      description: 'í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
      cta: {
        label: 'ìƒˆë¡œê³ ì¹¨',
        action: () => window.location.reload(),
      },
      dismissable: false,
    });

    // ì½œë°± í˜¸ì¶œ
    this.props.onError?.(error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        this.props.fallback || (
          <div className="min-h-screen flex items-center justify-center bg-gray-50">
            <div className="text-center p-8">
              <div className="text-6xl mb-4">âš ï¸</div>
              <h1 className="text-xl font-bold text-gray-900 mb-2">
                ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤
              </h1>
              <p className="text-gray-500 mb-6">
                í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”
              </p>
              <button
                onClick={() => window.location.reload()}
                className="px-6 py-3 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors"
              >
                ìƒˆë¡œê³ ì¹¨
              </button>
            </div>
          </div>
        )
      );
    }

    return this.props.children;
  }
}
```

---

### 14.37 ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ Hook (Part 6.1)

```typescript
// src/hooks/useNetworkStatus.ts (Part 6.1)
import { useEffect, useCallback } from 'react';
import { useErrorStore } from '@/stores/errorStore';

export function useNetworkStatus() {
  const { setOffline, isOffline } = useErrorStore();

  useEffect(() => {
    const handleOnline = () => setOffline(false);
    const handleOffline = () => setOffline(true);

    // ì´ˆê¸° ìƒíƒœ ì„¤ì •
    setOffline(!navigator.onLine);

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, [setOffline]);

  return { isOffline };
}

// src/hooks/useApiError.ts (Part 6.1)
import { useCallback } from 'react';
import { useErrorStore } from '@/stores/errorStore';

type ApiErrorCode =
  | 'NETWORK_ERROR'
  | 'TIMEOUT'
  | 'UNAUTHORIZED'
  | 'FORBIDDEN'
  | 'NOT_FOUND'
  | 'RATE_LIMITED'
  | 'SERVER_ERROR'
  | 'VALIDATION_ERROR';

interface ApiErrorOptions {
  retry?: () => Promise<void>;
  context?: { screen: string; action: string };
}

export function useApiError() {
  const { addError } = useErrorStore();

  const handleApiError = useCallback(
    (error: unknown, options?: ApiErrorOptions) => {
      const apiError = parseApiError(error);

      const errorConfig = getErrorConfig(apiError.code);

      addError({
        code: apiError.code,
        domain: errorConfig.domain,
        severity: errorConfig.severity,
        message: errorConfig.message,
        description: apiError.detail || errorConfig.description,
        cta: options?.retry
          ? { label: 'ë‹¤ì‹œ ì‹œë„', action: options.retry }
          : errorConfig.cta,
        secondaryCta: errorConfig.secondaryCta,
        dismissable: errorConfig.dismissable,
        autoDismissMs: errorConfig.autoDismissMs,
        recoveryStrategy: errorConfig.recovery,
        context: options?.context,
      });
    },
    [addError]
  );

  return { handleApiError };
}

function parseApiError(error: unknown): { code: ApiErrorCode; detail?: string } {
  if (error instanceof TypeError && error.message === 'Failed to fetch') {
    return { code: 'NETWORK_ERROR' };
  }

  if (error instanceof Response || (error as any)?.status) {
    const status = (error as Response).status;
    switch (status) {
      case 401:
        return { code: 'UNAUTHORIZED' };
      case 403:
        return { code: 'FORBIDDEN' };
      case 404:
        return { code: 'NOT_FOUND' };
      case 429:
        return { code: 'RATE_LIMITED' };
      case 500:
      case 502:
      case 503:
        return { code: 'SERVER_ERROR' };
      default:
        return { code: 'SERVER_ERROR' };
    }
  }

  return { code: 'SERVER_ERROR', detail: String(error) };
}

function getErrorConfig(code: ApiErrorCode) {
  const configs: Record<ApiErrorCode, any> = {
    NETWORK_ERROR: {
      domain: 'network',
      severity: 'minor',
      message: 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”',
      description: 'ì¸í„°ë„· ì—°ê²°ì´ ë¶ˆì•ˆì •í•©ë‹ˆë‹¤',
      dismissable: true,
      recovery: {
        type: 'retry',
        maxRetries: 3,
        currentRetry: 0,
        backoffMs: [1000, 2000, 4000],
      },
    },
    TIMEOUT: {
      domain: 'network',
      severity: 'minor',
      message: 'ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤',
      dismissable: true,
      autoDismissMs: 5000,
    },
    UNAUTHORIZED: {
      domain: 'auth',
      severity: 'critical',
      message: 'ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤',
      description: 'ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”',
      cta: { label: 'ë‹¤ì‹œ ë¡œê·¸ì¸', action: () => window.location.href = '/login' },
      dismissable: false,
    },
    FORBIDDEN: {
      domain: 'auth',
      severity: 'major',
      message: 'ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤',
      dismissable: true,
    },
    NOT_FOUND: {
      domain: 'validation',
      severity: 'minor',
      message: 'ìš”ì²­í•œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
      dismissable: true,
      autoDismissMs: 5000,
    },
    RATE_LIMITED: {
      domain: 'network',
      severity: 'minor',
      message: 'ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤',
      description: 'ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”',
      dismissable: true,
      autoDismissMs: 5000,
    },
    SERVER_ERROR: {
      domain: 'network',
      severity: 'major',
      message: 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',
      description: 'ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”',
      dismissable: true,
    },
    VALIDATION_ERROR: {
      domain: 'validation',
      severity: 'minor',
      message: 'ì…ë ¥ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”',
      dismissable: true,
      autoDismissMs: 5000,
    },
  };

  return configs[code];
}
```

---

### 14.38 ì—ëŸ¬ Analytics Hook (Part 6.1)

```typescript
// src/hooks/useErrorAnalytics.ts (Part 6.1)
import { useCallback } from 'react';
import { track } from '@/services/analytics';

type ErrorDomain = 'network' | 'auth' | 'integration' | 'ai' | 'media' | 'storage' | 'validation';
type ErrorSeverity = 'critical' | 'major' | 'minor' | 'info';

export function useErrorAnalytics() {
  // Part 6.1.1: ì—ëŸ¬ ë°œìƒ ì¶”ì 
  const trackErrorOccurred = useCallback((
    errorCode: string,
    domain: ErrorDomain,
    severity: ErrorSeverity,
    context: { screen: string; action: string }
  ) => {
    track('error_occurred', {
      errorCode,
      errorDomain: domain,
      severity,
      ...context,
      timestamp: new Date(),
    });
  }, []);

  // Part 6.1.2: ì—ëŸ¬ í‘œì‹œ ì¶”ì 
  const trackErrorDisplayed = useCallback((
    errorCode: string,
    displayType: 'modal' | 'banner' | 'toast' | 'inline',
    autoRecoveryStarted: boolean
  ) => {
    track('error_displayed', {
      errorCode,
      displayType,
      autoRecoveryStarted,
      timestamp: new Date(),
    });
  }, []);

  // Part 6.1.3: ìë™ ë³µêµ¬ ì¶”ì 
  const trackAutoRetryStarted = useCallback((
    errorCode: string,
    attemptNumber: number,
    maxAttempts: number
  ) => {
    track('auto_retry_started', {
      errorCode,
      attemptNumber,
      maxAttempts,
      timestamp: new Date(),
    });
  }, []);

  const trackAutoRetrySuccess = useCallback((
    errorCode: string,
    attemptNumber: number,
    recoveryTimeMs: number
  ) => {
    track('auto_retry_success', {
      errorCode,
      attemptNumber,
      recoveryTimeMs,
      timestamp: new Date(),
    });
  }, []);

  const trackAutoRetryFailed = useCallback((
    errorCode: string,
    attemptNumber: number,
    fallbackActivated: boolean
  ) => {
    track('auto_retry_failed', {
      errorCode,
      attemptNumber,
      fallbackActivated,
      timestamp: new Date(),
    });
  }, []);

  // Part 6.1.4: ì‚¬ìš©ì ë³µêµ¬ ì•¡ì…˜ ì¶”ì 
  const trackErrorCtaClicked = useCallback((
    errorCode: string,
    ctaType: 'retry' | 'settings' | 'login' | 'permission' | 'help',
    displayType: 'modal' | 'banner' | 'toast' | 'inline',
    timeToClickMs: number
  ) => {
    track('error_cta_clicked', {
      errorCode,
      ctaType,
      displayType,
      timeToClickMs,
      timestamp: new Date(),
    });
  }, []);

  const trackUserRecoverySuccess = useCallback((
    errorCode: string,
    ctaType: string,
    recoveryTimeMs: number
  ) => {
    track('user_recovery_success', {
      errorCode,
      ctaType,
      recoveryTimeMs,
      timestamp: new Date(),
    });
  }, []);

  const trackErrorDismissed = useCallback((
    errorCode: string,
    dismissMethod: 'close_button' | 'outside_click' | 'auto_timeout' | 'swipe',
    displayDurationMs: number
  ) => {
    track('error_dismissed', {
      errorCode,
      dismissMethod,
      displayDurationMs,
      timestamp: new Date(),
    });
  }, []);

  // Part 6.1.5: í´ë°±/ì˜¤í”„ë¼ì¸ ì¶”ì 
  const trackFallbackActivated = useCallback((
    domain: ErrorDomain,
    originalService: string,
    fallbackService: string
  ) => {
    track('fallback_activated', {
      errorDomain: domain,
      originalService,
      fallbackService,
      timestamp: new Date(),
    });
  }, []);

  const trackOfflineModeEntered = useCallback((
    trigger: 'network_lost' | 'server_unavailable' | 'manual',
    pendingActionsCount: number
  ) => {
    track('offline_mode_entered', {
      trigger,
      pendingActionsCount,
      timestamp: new Date(),
    });
  }, []);

  const trackOfflineModeExited = useCallback((
    durationMs: number,
    pendingActionsSynced: number,
    syncErrors: number
  ) => {
    track('offline_mode_exited', {
      durationMs,
      pendingActionsSynced,
      syncErrors,
      timestamp: new Date(),
    });
  }, []);

  return {
    // ì—ëŸ¬ ë°œìƒ
    trackErrorOccurred,
    trackErrorDisplayed,
    // ìë™ ë³µêµ¬
    trackAutoRetryStarted,
    trackAutoRetrySuccess,
    trackAutoRetryFailed,
    // ì‚¬ìš©ì ë³µêµ¬
    trackErrorCtaClicked,
    trackUserRecoverySuccess,
    trackErrorDismissed,
    // í´ë°±/ì˜¤í”„ë¼ì¸
    trackFallbackActivated,
    trackOfflineModeEntered,
    trackOfflineModeExited,
  };
}
```

### 14.39 ë¡œë”© Store (Part 6.2)

> ë¡œë”© ìƒíƒœëŠ” **íš¡ë‹¨ ê´€ì‹¬ì‚¬(Cross-Cutting Concern)**ë¡œ, ëª¨ë“  Partì—ì„œ ì¼ê´€ë˜ê²Œ ì ìš©ë©ë‹ˆë‹¤.
> ì² í•™: "ê¸°ë‹¤ë¦¼ì„ ê°€ì¹˜ë¡œ ì „í™˜" - ì²´ê° ì‹œê°„ì„ ì¤„ì´ê³  ì§„í–‰ê°ì„ ì œê³µí•©ë‹ˆë‹¤.

```typescript
// src/stores/loadingStore.ts (Part 6.2)
import { create } from 'zustand';
import { v4 as uuidv4 } from 'uuid';

// Part 6.2.1: ë¡œë”© íƒ€ì… ì •ì˜
type LoadingSeverity = 'blocking' | 'partial' | 'background' | 'inline';
type LoadingDisplayType = 'skeleton' | 'spinner' | 'progress' | 'shimmer' | 'pulse' | 'streaming';
type LoadingContext = 'navigation' | 'data_fetch' | 'action' | 'ai_process' | 'sync' | 'media';

interface LoadingItem {
  id: string;
  context: LoadingContext;
  severity: LoadingSeverity;
  displayType: LoadingDisplayType;
  message?: string;
  progress?: number;           // 0-100
  estimatedDuration?: number;  // ms
  startTime: number;
  cancellable: boolean;
}

interface LoadingState {
  // ìƒíƒœ
  loadings: Map<string, LoadingItem>;
  globalLoading: boolean;

  // ì•¡ì…˜
  startLoading: (options: Omit<LoadingItem, 'id' | 'startTime'>) => string;
  updateProgress: (id: string, progress: number) => void;
  updateMessage: (id: string, message: string) => void;
  finishLoading: (id: string) => void;
  cancelLoading: (id: string) => void;
  clearAll: () => void;

  // ì…€ë ‰í„°
  isLoading: (context?: LoadingContext) => boolean;
  getLoadingByContext: (context: LoadingContext) => LoadingItem | undefined;
  getBlockingLoading: () => LoadingItem | undefined;
}

export const useLoadingStore = create<LoadingState>((set, get) => ({
  loadings: new Map(),
  globalLoading: false,

  // Part 6.2.2: ë¡œë”© ì‹œì‘
  startLoading: (options) => {
    const id = uuidv4();
    const loadingItem: LoadingItem = {
      ...options,
      id,
      startTime: Date.now(),
    };

    set((state) => {
      const newLoadings = new Map(state.loadings);
      newLoadings.set(id, loadingItem);
      return {
        loadings: newLoadings,
        globalLoading: options.severity === 'blocking' ? true : state.globalLoading,
      };
    });

    return id;
  },

  // Part 6.2.3: ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
  updateProgress: (id, progress) => {
    set((state) => {
      const loading = state.loadings.get(id);
      if (!loading) return state;

      const newLoadings = new Map(state.loadings);
      newLoadings.set(id, { ...loading, progress });
      return { loadings: newLoadings };
    });
  },

  // Part 6.2.4: ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
  updateMessage: (id, message) => {
    set((state) => {
      const loading = state.loadings.get(id);
      if (!loading) return state;

      const newLoadings = new Map(state.loadings);
      newLoadings.set(id, { ...loading, message });
      return { loadings: newLoadings };
    });
  },

  // Part 6.2.5: ë¡œë”© ì™„ë£Œ
  finishLoading: (id) => {
    set((state) => {
      const loading = state.loadings.get(id);
      if (!loading) return state;

      const newLoadings = new Map(state.loadings);
      newLoadings.delete(id);

      // ë” ì´ìƒ blocking ë¡œë”©ì´ ì—†ìœ¼ë©´ globalLoading false
      const hasBlockingLoading = Array.from(newLoadings.values())
        .some(l => l.severity === 'blocking');

      return {
        loadings: newLoadings,
        globalLoading: hasBlockingLoading,
      };
    });
  },

  // Part 6.2.6: ë¡œë”© ì·¨ì†Œ
  cancelLoading: (id) => {
    const loading = get().loadings.get(id);
    if (loading?.cancellable) {
      get().finishLoading(id);
    }
  },

  clearAll: () => set({ loadings: new Map(), globalLoading: false }),

  // ì…€ë ‰í„°
  isLoading: (context) => {
    const { loadings } = get();
    if (!context) return loadings.size > 0;
    return Array.from(loadings.values()).some(l => l.context === context);
  },

  getLoadingByContext: (context) => {
    return Array.from(get().loadings.values()).find(l => l.context === context);
  },

  getBlockingLoading: () => {
    return Array.from(get().loadings.values()).find(l => l.severity === 'blocking');
  },
}));
```

### 14.40 Skeleton ì»´í¬ë„ŒíŠ¸ (Part 6.2)

```tsx
// src/components/loading/Skeleton.tsx (Part 6.2)
import { cn } from '@/lib/utils';
import { motion } from 'framer-motion';

// Part 6.2.1: Skeleton ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸
interface SkeletonProps {
  className?: string;
  variant?: 'text' | 'circular' | 'rectangular';
  width?: string | number;
  height?: string | number;
  animation?: 'shimmer' | 'pulse' | 'none';
}

export function Skeleton({
  className,
  variant = 'text',
  width,
  height,
  animation = 'shimmer',
}: SkeletonProps) {
  const baseStyles = cn(
    'bg-gray-200 dark:bg-gray-700',
    {
      'rounded-md': variant === 'text' || variant === 'rectangular',
      'rounded-full': variant === 'circular',
    },
    className
  );

  const animationStyles = {
    shimmer: 'relative overflow-hidden before:absolute before:inset-0 before:-translate-x-full before:animate-shimmer before:bg-gradient-to-r before:from-transparent before:via-white/40 before:to-transparent',
    pulse: 'animate-pulse',
    none: '',
  };

  return (
    <div
      className={cn(baseStyles, animationStyles[animation])}
      style={{
        width: width || (variant === 'circular' ? '40px' : '100%'),
        height: height || (variant === 'text' ? '16px' : variant === 'circular' ? '40px' : '100%'),
      }}
    />
  );
}

// Part 6.2.2: ë¯¸íŒ… ì¹´ë“œ Skeleton
export function MeetingCardSkeleton() {
  return (
    <div className="p-4 border border-gray-200 rounded-xl">
      <div className="flex items-center justify-between mb-3">
        <Skeleton width="80px" height="14px" />
        <Skeleton width="60px" height="24px" variant="rectangular" />
      </div>
      <Skeleton width="200px" height="20px" className="mb-2" />
      <div className="flex items-center gap-2 mb-4">
        <Skeleton width="120px" height="14px" />
        <Skeleton width="80px" height="14px" />
      </div>
      <Skeleton width="100px" height="36px" variant="rectangular" />
    </div>
  );
}

// Part 6.2.3: ê²€ìƒ‰ ê²°ê³¼ Skeleton
export function SearchResultSkeleton() {
  return (
    <div className="p-4 border-b border-gray-100">
      <div className="flex gap-3">
        <Skeleton variant="circular" width="32px" height="32px" />
        <div className="flex-1">
          <Skeleton width="70%" height="16px" className="mb-2" />
          <div className="flex gap-2 mb-2">
            <Skeleton width="100px" height="12px" />
            <Skeleton width="60px" height="12px" />
          </div>
          <Skeleton width="90%" height="14px" />
        </div>
      </div>
    </div>
  );
}

// Part 6.2.4: HUD AI ì‘ë‹µ Skeleton
export function HudAiSkeleton() {
  return (
    <div className="p-3">
      <div className="flex items-center gap-2 mb-3">
        <TypingDots />
      </div>
      <Skeleton width="100%" height="14px" className="mb-2" />
      <Skeleton width="80%" height="14px" className="mb-2" />
      <Skeleton width="90%" height="14px" />
    </div>
  );
}

// Part 6.2.5: íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°
export function TypingDots() {
  return (
    <div className="flex items-center gap-1">
      {[0, 1, 2].map((i) => (
        <motion.span
          key={i}
          className="w-2 h-2 bg-blue-500 rounded-full"
          animate={{
            scale: [1, 1.3, 1],
            opacity: [0.5, 1, 0.5],
          }}
          transition={{
            duration: 0.8,
            repeat: Infinity,
            delay: i * 0.15,
          }}
        />
      ))}
    </div>
  );
}
```

### 14.41 Spinner ì»´í¬ë„ŒíŠ¸ (Part 6.2)

```tsx
// src/components/loading/Spinner.tsx (Part 6.2)
import { cn } from '@/lib/utils';

type SpinnerSize = 'sm' | 'md' | 'lg' | 'xl';
type SpinnerColor = 'primary' | 'secondary' | 'white' | 'current';

interface SpinnerProps {
  size?: SpinnerSize;
  color?: SpinnerColor;
  className?: string;
}

const sizeClasses: Record<SpinnerSize, string> = {
  sm: 'w-4 h-4 border-2',
  md: 'w-6 h-6 border-[2.5px]',
  lg: 'w-10 h-10 border-3',
  xl: 'w-16 h-16 border-4',
};

const colorClasses: Record<SpinnerColor, string> = {
  primary: 'border-blue-600 border-t-transparent',
  secondary: 'border-gray-500 border-t-transparent',
  white: 'border-white border-t-transparent',
  current: 'border-current border-t-transparent',
};

export function Spinner({
  size = 'md',
  color = 'primary',
  className,
}: SpinnerProps) {
  return (
    <div
      className={cn(
        'inline-block rounded-full animate-spin',
        sizeClasses[size],
        colorClasses[color],
        className
      )}
      role="status"
      aria-label="ë¡œë”© ì¤‘"
    >
      <span className="sr-only">ë¡œë”© ì¤‘...</span>
    </div>
  );
}

// Part 6.2.2: ì˜¤ë²„ë ˆì´ Spinner
export function SpinnerOverlay({
  message,
  fullScreen = false,
}: {
  message?: string;
  fullScreen?: boolean;
}) {
  return (
    <div
      className={cn(
        'flex flex-col items-center justify-center gap-3',
        fullScreen
          ? 'fixed inset-0 bg-white/80 dark:bg-gray-900/80 z-50'
          : 'absolute inset-0 bg-white/60'
      )}
    >
      <Spinner size={fullScreen ? 'xl' : 'lg'} />
      {message && (
        <p className="text-sm text-gray-600 dark:text-gray-400">{message}</p>
      )}
    </div>
  );
}
```

### 14.42 Progress ì»´í¬ë„ŒíŠ¸ (Part 6.2)

```tsx
// src/components/loading/Progress.tsx (Part 6.2)
import { cn } from '@/lib/utils';
import { motion } from 'framer-motion';

// Part 6.2.1: Linear Progress
interface LinearProgressProps {
  value?: number;              // 0-100, undefined = indeterminate
  size?: 'sm' | 'md' | 'lg';
  color?: 'primary' | 'success' | 'warning' | 'error';
  label?: string;
  showValue?: boolean;
  className?: string;
}

const heightClasses = {
  sm: 'h-1',
  md: 'h-2',
  lg: 'h-3',
};

const colorClasses = {
  primary: 'bg-blue-600',
  success: 'bg-green-500',
  warning: 'bg-yellow-500',
  error: 'bg-red-500',
};

export function LinearProgress({
  value,
  size = 'md',
  color = 'primary',
  label,
  showValue = false,
  className,
}: LinearProgressProps) {
  const isIndeterminate = value === undefined;

  return (
    <div className={cn('w-full', className)}>
      {(label || showValue) && (
        <div className="flex justify-between items-center mb-2">
          {label && (
            <span className="text-sm font-medium text-gray-700 dark:text-gray-300">
              {label}
            </span>
          )}
          {showValue && value !== undefined && (
            <span className="text-sm text-gray-500">{Math.round(value)}%</span>
          )}
        </div>
      )}
      <div
        className={cn(
          'w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden',
          heightClasses[size]
        )}
      >
        {isIndeterminate ? (
          <motion.div
            className={cn('h-full w-1/3 rounded-full', colorClasses[color])}
            animate={{
              x: ['-100%', '400%'],
            }}
            transition={{
              duration: 1.5,
              repeat: Infinity,
              ease: 'easeInOut',
            }}
          />
        ) : (
          <motion.div
            className={cn('h-full rounded-full', colorClasses[color])}
            initial={{ width: 0 }}
            animate={{ width: `${value}%` }}
            transition={{ duration: 0.3, ease: 'easeOut' }}
          />
        )}
      </div>
    </div>
  );
}

// Part 6.2.2: Circular Progress
interface CircularProgressProps {
  value?: number;
  size?: 'sm' | 'md' | 'lg';
  strokeWidth?: number;
  color?: 'primary' | 'success' | 'warning' | 'error';
  showValue?: boolean;
  className?: string;
}

const sizePixels = { sm: 24, md: 40, lg: 64 };

export function CircularProgress({
  value,
  size = 'md',
  strokeWidth = 4,
  color = 'primary',
  showValue = false,
  className,
}: CircularProgressProps) {
  const sizePx = sizePixels[size];
  const radius = (sizePx - strokeWidth) / 2;
  const circumference = 2 * Math.PI * radius;
  const isIndeterminate = value === undefined;

  return (
    <div
      className={cn('relative inline-flex items-center justify-center', className)}
      style={{ width: sizePx, height: sizePx }}
    >
      <svg
        className={cn(isIndeterminate && 'animate-spin')}
        width={sizePx}
        height={sizePx}
        style={{ transform: 'rotate(-90deg)' }}
      >
        {/* Track */}
        <circle
          cx={sizePx / 2}
          cy={sizePx / 2}
          r={radius}
          fill="none"
          stroke="currentColor"
          strokeWidth={strokeWidth}
          className="text-gray-200 dark:text-gray-700"
        />
        {/* Progress */}
        <motion.circle
          cx={sizePx / 2}
          cy={sizePx / 2}
          r={radius}
          fill="none"
          stroke="currentColor"
          strokeWidth={strokeWidth}
          strokeLinecap="round"
          className={colorClasses[color].replace('bg-', 'text-')}
          strokeDasharray={circumference}
          initial={{ strokeDashoffset: circumference }}
          animate={{
            strokeDashoffset: isIndeterminate
              ? [circumference, 0]
              : circumference * (1 - (value || 0) / 100),
          }}
          transition={
            isIndeterminate
              ? { duration: 1.5, repeat: Infinity, ease: 'linear' }
              : { duration: 0.3, ease: 'easeOut' }
          }
        />
      </svg>
      {showValue && value !== undefined && (
        <span className="absolute text-xs font-medium text-gray-700 dark:text-gray-300">
          {Math.round(value)}%
        </span>
      )}
    </div>
  );
}

// Part 6.2.3: Steps Progress
interface Step {
  label: string;
  status: 'completed' | 'active' | 'pending' | 'error';
}

interface StepsProgressProps {
  steps: Step[];
  className?: string;
}

export function StepsProgress({ steps, className }: StepsProgressProps) {
  return (
    <div className={cn('flex items-center', className)}>
      {steps.map((step, index) => (
        <div key={index} className="flex items-center">
          {/* Step Node */}
          <div
            className={cn(
              'w-6 h-6 rounded-full flex items-center justify-center text-xs font-semibold transition-all',
              {
                'bg-green-500 text-white': step.status === 'completed',
                'bg-blue-600 text-white': step.status === 'active',
                'bg-gray-200 text-gray-400 border-2 border-gray-300': step.status === 'pending',
                'bg-red-500 text-white': step.status === 'error',
              }
            )}
          >
            {step.status === 'completed' ? (
              <CheckIcon className="w-3 h-3" />
            ) : step.status === 'active' ? (
              <Spinner size="sm" color="white" />
            ) : step.status === 'error' ? (
              <XIcon className="w-3 h-3" />
            ) : (
              index + 1
            )}
          </div>

          {/* Connector */}
          {index < steps.length - 1 && (
            <div
              className={cn(
                'h-0.5 w-6 mx-1 transition-colors',
                step.status === 'completed' ? 'bg-green-500' : 'bg-gray-200'
              )}
            />
          )}
        </div>
      ))}
    </div>
  );
}
```

### 14.43 Streaming Text ì»´í¬ë„ŒíŠ¸ (Part 6.2)

```tsx
// src/components/loading/StreamingText.tsx (Part 6.2)
import { useState, useEffect, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';

interface StreamingTextProps {
  content: string;
  isStreaming: boolean;
  speed?: number;          // ms per character
  showCursor?: boolean;
  className?: string;
  onComplete?: () => void;
}

export function StreamingText({
  content,
  isStreaming,
  speed = 30,
  showCursor = true,
  className,
  onComplete,
}: StreamingTextProps) {
  const [displayedContent, setDisplayedContent] = useState('');
  const [cursorVisible, setCursorVisible] = useState(true);
  const contentRef = useRef(content);
  const indexRef = useRef(0);

  // Part 6.2.1: ë¬¸ì ë‹¨ìœ„ ìŠ¤íŠ¸ë¦¬ë°
  useEffect(() => {
    if (!isStreaming) {
      setDisplayedContent(content);
      indexRef.current = content.length;
      return;
    }

    // ìƒˆ ì½˜í…ì¸  ê°ì§€
    if (content !== contentRef.current) {
      contentRef.current = content;
    }

    // ìŠ¤íŠ¸ë¦¬ë° ì• ë‹ˆë©”ì´ì…˜
    if (indexRef.current < content.length) {
      const timeout = setTimeout(() => {
        indexRef.current++;
        setDisplayedContent(content.slice(0, indexRef.current));

        if (indexRef.current >= content.length) {
          onComplete?.();
        }
      }, speed);

      return () => clearTimeout(timeout);
    }
  }, [content, isStreaming, speed, onComplete]);

  // Part 6.2.2: ì»¤ì„œ ê¹œë¹¡ì„
  useEffect(() => {
    if (!showCursor || !isStreaming) return;

    const interval = setInterval(() => {
      setCursorVisible((v) => !v);
    }, 500);

    return () => clearInterval(interval);
  }, [showCursor, isStreaming]);

  return (
    <span className={className}>
      {displayedContent}
      {showCursor && isStreaming && (
        <motion.span
          className="inline-block w-0.5 h-[1em] bg-blue-600 ml-0.5 align-text-bottom"
          animate={{ opacity: cursorVisible ? 1 : 0 }}
          transition={{ duration: 0.1 }}
        />
      )}
    </span>
  );
}

// Part 6.2.3: AI ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë° ì»¨í…Œì´ë„ˆ
interface AiStreamingResponseProps {
  content: string;
  isLoading: boolean;
  isStreaming: boolean;
  error?: string;
}

export function AiStreamingResponse({
  content,
  isLoading,
  isStreaming,
  error,
}: AiStreamingResponseProps) {
  if (error) {
    return (
      <div className="text-red-500 text-sm p-3">
        {error}
      </div>
    );
  }

  if (isLoading && !content) {
    return (
      <div className="flex items-center gap-2 p-3 text-gray-500">
        <TypingDots />
        <span className="text-sm">AIê°€ ë¶„ì„ ì¤‘...</span>
      </div>
    );
  }

  return (
    <div className="p-3 text-sm text-gray-700 dark:text-gray-300 leading-relaxed">
      <StreamingText
        content={content}
        isStreaming={isStreaming}
        speed={40}
        showCursor={isStreaming}
      />
    </div>
  );
}
```

### 14.44 Pulse ì¸ë””ì¼€ì´í„° (Part 6.2)

```tsx
// src/components/loading/PulseIndicator.tsx (Part 6.2)
import { cn } from '@/lib/utils';
import { motion } from 'framer-motion';

type PulseStatus = 'connected' | 'connecting' | 'disconnected' | 'live';

interface PulseIndicatorProps {
  status: PulseStatus;
  label?: string;
  showLabel?: boolean;
  size?: 'sm' | 'md' | 'lg';
  className?: string;
}

const statusColors: Record<PulseStatus, string> = {
  connected: 'bg-green-500',
  connecting: 'bg-yellow-500',
  disconnected: 'bg-red-500',
  live: 'bg-red-500',
};

const statusLabels: Record<PulseStatus, string> = {
  connected: 'ì—°ê²°ë¨',
  connecting: 'ì—°ê²° ì¤‘...',
  disconnected: 'ì—°ê²° ëŠê¹€',
  live: 'LIVE',
};

const sizeClasses = {
  sm: 'w-2 h-2',
  md: 'w-2.5 h-2.5',
  lg: 'w-3 h-3',
};

export function PulseIndicator({
  status,
  label,
  showLabel = true,
  size = 'md',
  className,
}: PulseIndicatorProps) {
  const shouldPulse = status === 'connected' || status === 'live';

  return (
    <div className={cn('inline-flex items-center gap-2', className)}>
      <div className="relative">
        <motion.div
          className={cn(
            'rounded-full',
            sizeClasses[size],
            statusColors[status]
          )}
          animate={
            shouldPulse
              ? {
                  scale: [1, 1.2, 1],
                  boxShadow: [
                    `0 0 0 0 ${status === 'live' ? 'rgba(239, 68, 68, 0.7)' : 'rgba(34, 197, 94, 0.7)'}`,
                    `0 0 0 8px ${status === 'live' ? 'rgba(239, 68, 68, 0)' : 'rgba(34, 197, 94, 0)'}`,
                    `0 0 0 0 ${status === 'live' ? 'rgba(239, 68, 68, 0)' : 'rgba(34, 197, 94, 0)'}`,
                  ],
                }
              : {}
          }
          transition={
            shouldPulse
              ? {
                  duration: 2,
                  repeat: Infinity,
                  ease: 'easeInOut',
                }
              : {}
          }
        />
      </div>
      {showLabel && (
        <span
          className={cn(
            'text-xs font-medium',
            status === 'live' ? 'text-red-600 uppercase tracking-wide' : 'text-gray-600'
          )}
        >
          {label || statusLabels[status]}
        </span>
      )}
    </div>
  );
}

// Part 6.2.2: HUD ì—°ê²° ìƒíƒœ í‘œì‹œ
export function HudConnectionStatus({
  isConnected,
  isRecording,
}: {
  isConnected: boolean;
  isRecording: boolean;
}) {
  if (isRecording) {
    return (
      <PulseIndicator
        status="live"
        label="LIVE"
        size="md"
      />
    );
  }

  return (
    <PulseIndicator
      status={isConnected ? 'connected' : 'disconnected'}
      size="sm"
    />
  );
}
```

### 14.45 ë‚™ê´€ì  UI Hook (Part 6.2)

```tsx
// src/hooks/useOptimisticUpdate.ts (Part 6.2)
import { useState, useCallback, useRef } from 'react';

interface OptimisticOptions<T> {
  onMutate: () => T;               // ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ì ìš©
  onError?: (error: Error, previousValue: T) => void;
  onSuccess?: (data: any) => void;
  onSettled?: () => void;
  rollbackOnError?: boolean;
}

interface OptimisticResult<T> {
  mutate: (asyncFn: () => Promise<any>) => Promise<void>;
  isLoading: boolean;
  error: Error | null;
  rollback: () => void;
}

export function useOptimisticUpdate<T>(
  options: OptimisticOptions<T>
): OptimisticResult<T> {
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);
  const previousValueRef = useRef<T | null>(null);

  const rollback = useCallback(() => {
    if (previousValueRef.current !== null && options.onError) {
      options.onError(new Error('Manual rollback'), previousValueRef.current);
    }
    previousValueRef.current = null;
  }, [options]);

  const mutate = useCallback(async (asyncFn: () => Promise<any>) => {
    setIsLoading(true);
    setError(null);

    // Part 6.2.1: ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ì ìš©
    previousValueRef.current = options.onMutate();

    try {
      // Part 6.2.2: ì„œë²„ ìš”ì²­
      const result = await asyncFn();
      options.onSuccess?.(result);
      previousValueRef.current = null;
    } catch (err) {
      const error = err instanceof Error ? err : new Error(String(err));
      setError(error);

      // Part 6.2.3: ì—ëŸ¬ ì‹œ ë¡¤ë°±
      if (options.rollbackOnError !== false && previousValueRef.current !== null) {
        options.onError?.(error, previousValueRef.current);
      }
      previousValueRef.current = null;
    } finally {
      setIsLoading(false);
      options.onSettled?.();
    }
  }, [options]);

  return { mutate, isLoading, error, rollback };
}

// Part 6.2.4: ìë™ ì €ì¥ ì¸ë””ì¼€ì´í„°
type SaveStatus = 'idle' | 'saving' | 'saved' | 'error';

export function useSaveIndicator() {
  const [status, setStatus] = useState<SaveStatus>('idle');
  const timeoutRef = useRef<NodeJS.Timeout>();

  const showSaving = useCallback(() => {
    setStatus('saving');
    if (timeoutRef.current) clearTimeout(timeoutRef.current);
  }, []);

  const showSaved = useCallback(() => {
    setStatus('saved');
    if (timeoutRef.current) clearTimeout(timeoutRef.current);
    timeoutRef.current = setTimeout(() => {
      setStatus('idle');
    }, 2000);
  }, []);

  const showError = useCallback(() => {
    setStatus('error');
    if (timeoutRef.current) clearTimeout(timeoutRef.current);
    timeoutRef.current = setTimeout(() => {
      setStatus('idle');
    }, 4000);
  }, []);

  return { status, showSaving, showSaved, showError };
}

// Part 6.2.5: ì €ì¥ ìƒíƒœ ì¸ë””ì¼€ì´í„° ì»´í¬ë„ŒíŠ¸
export function SaveIndicator({ status }: { status: SaveStatus }) {
  if (status === 'idle') return null;

  return (
    <motion.div
      initial={{ opacity: 0, y: -10 }}
      animate={{ opacity: 1, y: 0 }}
      exit={{ opacity: 0, y: -10 }}
      className="inline-flex items-center gap-1.5 text-xs"
    >
      {status === 'saving' && (
        <>
          <CloudIcon className="w-3.5 h-3.5 text-gray-400 animate-pulse" />
          <span className="text-gray-400">ì €ì¥ ì¤‘...</span>
        </>
      )}
      {status === 'saved' && (
        <>
          <CloudCheckIcon className="w-3.5 h-3.5 text-green-500" />
          <span className="text-gray-500">ì €ì¥ë¨</span>
        </>
      )}
      {status === 'error' && (
        <>
          <CloudOffIcon className="w-3.5 h-3.5 text-red-500" />
          <span className="text-red-500">ì €ì¥ ì‹¤íŒ¨</span>
        </>
      )}
    </motion.div>
  );
}
```

### 14.46 ë¡œë”© Analytics Hook (Part 6.2)

```typescript
// src/hooks/useLoadingAnalytics.ts (Part 6.2)
import { useCallback, useRef } from 'react';
import { track } from '@/services/analytics';

type LoadingContext = 'navigation' | 'data_fetch' | 'action' | 'ai_process' | 'sync' | 'media';
type LoadingDisplayType = 'skeleton' | 'spinner' | 'progress' | 'streaming';

export function useLoadingAnalytics() {
  const startTimeRef = useRef<Map<string, number>>(new Map());

  // Part 6.2.1: ë¡œë”© ì‹œì‘ ì¶”ì 
  const trackLoadingStarted = useCallback((
    loadingId: string,
    context: LoadingContext,
    displayType: LoadingDisplayType,
    estimatedDurationMs?: number
  ) => {
    startTimeRef.current.set(loadingId, Date.now());
    track('loading_started', {
      loadingId,
      context,
      displayType,
      estimatedDurationMs,
      timestamp: new Date(),
    });
  }, []);

  // Part 6.2.2: ë¡œë”© ì™„ë£Œ ì¶”ì 
  const trackLoadingCompleted = useCallback((
    loadingId: string,
    context: LoadingContext,
    displayShown: boolean
  ) => {
    const startTime = startTimeRef.current.get(loadingId);
    const duration = startTime ? Date.now() - startTime : 0;
    startTimeRef.current.delete(loadingId);

    track('loading_completed', {
      loadingId,
      context,
      actualDurationMs: duration,
      displayShown,
      timestamp: new Date(),
    });
  }, []);

  // Part 6.2.3: ë¡œë”© ì·¨ì†Œ ì¶”ì 
  const trackLoadingCancelled = useCallback((
    loadingId: string,
    context: LoadingContext,
    cancelMethod: 'button' | 'navigation' | 'timeout' | 'error'
  ) => {
    const startTime = startTimeRef.current.get(loadingId);
    const duration = startTime ? Date.now() - startTime : 0;
    startTimeRef.current.delete(loadingId);

    track('loading_cancelled', {
      loadingId,
      context,
      cancelMethod,
      durationBeforeCancelMs: duration,
      timestamp: new Date(),
    });
  }, []);

  // Part 6.2.4: ë‚™ê´€ì  UI ì¶”ì 
  const trackOptimisticApplied = useCallback((
    operationType: string,
    dataType: string,
    recordId: string
  ) => {
    track('optimistic_applied', {
      operationType,
      dataType,
      recordId,
      timestamp: new Date(),
    });
  }, []);

  const trackOptimisticConfirmed = useCallback((
    operationType: string,
    recordId: string,
    confirmationDelayMs: number
  ) => {
    track('optimistic_confirmed', {
      operationType,
      recordId,
      confirmationDelayMs,
      timestamp: new Date(),
    });
  }, []);

  const trackOptimisticReverted = useCallback((
    operationType: string,
    recordId: string,
    reason: 'api_error' | 'validation_error' | 'conflict'
  ) => {
    track('optimistic_reverted', {
      operationType,
      recordId,
      reason,
      timestamp: new Date(),
    });
  }, []);

  // Part 6.2.5: ìŠ¤íŠ¸ë¦¬ë° ì¶”ì 
  const trackStreamingStarted = useCallback((
    streamId: string,
    streamType: 'ai_response' | 'transcription' | 'search_results'
  ) => {
    startTimeRef.current.set(streamId, Date.now());
    track('streaming_started', {
      streamId,
      streamType,
      timestamp: new Date(),
    });
  }, []);

  const trackStreamingCompleted = useCallback((
    streamId: string,
    totalChunks: number,
    totalBytes: number
  ) => {
    const startTime = startTimeRef.current.get(streamId);
    const duration = startTime ? Date.now() - startTime : 0;
    startTimeRef.current.delete(streamId);

    track('streaming_completed', {
      streamId,
      totalChunks,
      totalBytes,
      durationMs: duration,
      timestamp: new Date(),
    });
  }, []);

  // Part 6.2.6: Web Vitals ì¶”ì 
  const trackWebVitals = useCallback((vitals: {
    fcp: number;
    lcp: number;
    cls: number;
    fid: number;
    ttfb: number;
  }) => {
    track('web_vitals_measured', {
      ...vitals,
      screen: window.location.pathname,
      timestamp: new Date(),
    });
  }, []);

  return {
    // ë¡œë”©
    trackLoadingStarted,
    trackLoadingCompleted,
    trackLoadingCancelled,
    // ë‚™ê´€ì  UI
    trackOptimisticApplied,
    trackOptimisticConfirmed,
    trackOptimisticReverted,
    // ìŠ¤íŠ¸ë¦¬ë°
    trackStreamingStarted,
    trackStreamingCompleted,
    // Web Vitals
    trackWebVitals,
  };
}
```

### 14.47 ë¹ˆ ìƒíƒœ Store (Part 6.3)

```typescript
// src/stores/emptyStateStore.ts
// Part 6.3: ë¹ˆ ìƒíƒœ ê´€ë¦¬ Zustand Store

import { create } from 'zustand';
import { v4 as uuidv4 } from 'uuid';

// ============================================
// 14.47.1 ë¹ˆ ìƒíƒœ íƒ€ì… ì •ì˜
// ============================================

type EmptyStateReason =
  | 'first_time'
  | 'no_data'
  | 'filtered_out'
  | 'search_no_match'
  | 'completed_all'
  | 'temporal_gap'
  | 'permission_limited'
  | 'feature_not_setup';

type EmptyStateContext =
  | 'today_meetings'
  | 'past_meetings'
  | 'search_results'
  | 'decisions_list'
  | 'actions_list'
  | 'insights_list'
  | 'notifications'
  | 'integrations'
  | 'hud_idle'
  | 'filter_results';

type EmptyStateTone = 'neutral' | 'positive' | 'encouraging' | 'helpful';

interface EmptyStateAction {
  label: string;
  action: string;      // 'navigate:/path', 'open:modal', 'reset:filters', 'oauth:notion'
  variant: 'primary' | 'secondary';
}

interface EmptyStateIllustration {
  type: 'icon' | 'illustration' | 'animation';
  name: string;
  size: 'sm' | 'md' | 'lg';
}

interface EmptyStateItem {
  id: string;
  reason: EmptyStateReason;
  context: EmptyStateContext;
  illustration: EmptyStateIllustration;
  title: string;
  description?: string;
  tone: EmptyStateTone;
  primaryAction?: EmptyStateAction;
  secondaryAction?: EmptyStateAction;
  suggestions?: string[];
  showTime: number;  // í‘œì‹œ ì‹œì‘ ì‹œê°„
}

interface EmptyStateStore {
  activeEmptyStates: Map<string, EmptyStateItem>;
  showEmptyState: (config: Omit<EmptyStateItem, 'id' | 'showTime'>) => string;
  hideEmptyState: (context: EmptyStateContext) => void;
  getEmptyState: (context: EmptyStateContext) => EmptyStateItem | null;
  isEmptyStateActive: (context: EmptyStateContext) => boolean;
  clearAll: () => void;
}

export const useEmptyStateStore = create<EmptyStateStore>((set, get) => ({
  activeEmptyStates: new Map(),

  showEmptyState: (config) => {
    const id = uuidv4();
    const item: EmptyStateItem = {
      ...config,
      id,
      showTime: Date.now(),
    };

    set((state) => {
      const newMap = new Map(state.activeEmptyStates);
      // ê°™ì€ contextì˜ ê¸°ì¡´ ë¹ˆ ìƒíƒœ êµì²´
      for (const [key, value] of newMap.entries()) {
        if (value.context === config.context) {
          newMap.delete(key);
        }
      }
      newMap.set(config.context, item);
      return { activeEmptyStates: newMap };
    });

    return id;
  },

  hideEmptyState: (context) => {
    set((state) => {
      const newMap = new Map(state.activeEmptyStates);
      newMap.delete(context);
      return { activeEmptyStates: newMap };
    });
  },

  getEmptyState: (context) => {
    return get().activeEmptyStates.get(context) || null;
  },

  isEmptyStateActive: (context) => {
    return get().activeEmptyStates.has(context);
  },

  clearAll: () => {
    set({ activeEmptyStates: new Map() });
  },
}));
```

### 14.48 ë²”ìš© ë¹ˆ ìƒíƒœ ì»´í¬ë„ŒíŠ¸ (Part 6.3)

```tsx
// src/components/ui/EmptyState/EmptyState.tsx
// Part 6.3: ë²”ìš© ë¹ˆ ìƒíƒœ ì»´í¬ë„ŒíŠ¸

import { memo, useEffect, useMemo } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useNavigate } from 'react-router-dom';
import * as LucideIcons from 'lucide-react';
import { Button } from '@/components/ui/Button';
import { useEmptyStateStore, EmptyStateItem } from '@/stores/emptyStateStore';
import { track } from '@/services/analytics';

// ============================================
// 14.48.1 ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´ì…˜ ë§¤í•‘
// ============================================

const ILLUSTRATIONS: Record<string, React.ComponentType<{ className?: string }>> = {
  'welcome-calendar': () => <WelcomeCalendarIllustration />,
  'relax-coffee': () => <RelaxCoffeeIllustration />,
  'no-results': () => <NoResultsIllustration />,
  // ... ì¶”ê°€ ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´ì…˜
};

const ICON_MAP: Record<string, keyof typeof LucideIcons> = {
  'search': 'Search',
  'calendar-clock': 'CalendarClock',
  'check-circle': 'CheckCircle',
  'filter-x': 'FilterX',
  'clipboard-list': 'ClipboardList',
  'bell-off': 'BellOff',
  'lightbulb': 'Lightbulb',
  'lock-shield': 'ShieldAlert',
  'cloud-offline': 'CloudOff',
};

// ============================================
// 14.48.2 ë¹ˆ ìƒíƒœ Props
// ============================================

interface EmptyStateProps {
  reason: EmptyStateItem['reason'];
  context: EmptyStateItem['context'];
  illustration: EmptyStateItem['illustration'];
  title: string;
  description?: string;
  tone?: EmptyStateItem['tone'];
  primaryAction?: EmptyStateItem['primaryAction'];
  secondaryAction?: EmptyStateItem['secondaryAction'];
  suggestions?: string[];
  size?: 'sm' | 'md' | 'lg';
  className?: string;
}

// ============================================
// 14.48.3 ë¹ˆ ìƒíƒœ ì»´í¬ë„ŒíŠ¸
// ============================================

export const EmptyState = memo(function EmptyState({
  reason,
  context,
  illustration,
  title,
  description,
  tone = 'neutral',
  primaryAction,
  secondaryAction,
  suggestions,
  size = 'md',
  className = '',
}: EmptyStateProps) {
  const navigate = useNavigate();
  const showEmptyState = useEmptyStateStore((s) => s.showEmptyState);

  // ë¹ˆ ìƒíƒœ í‘œì‹œ ì¶”ì 
  useEffect(() => {
    const emptyStateId = showEmptyState({
      reason,
      context,
      illustration,
      title,
      description,
      tone,
      primaryAction,
      secondaryAction,
      suggestions,
    });

    track('empty_state_shown', {
      emptyStateId,
      reason,
      context,
      hasPrimaryCta: !!primaryAction,
      hasSecondaryCta: !!secondaryAction,
      timestamp: new Date(),
    });

    return () => {
      // cleanupì€ hideEmptyStateë¡œ ë³„ë„ ì²˜ë¦¬
    };
  }, [reason, context]);

  // ì•¡ì…˜ í•¸ë“¤ëŸ¬
  const handleAction = (action: string, label: string, type: 'primary' | 'secondary') => {
    track('empty_state_cta_clicked', {
      reason,
      context,
      ctaType: type,
      ctaLabel: label,
      ctaAction: action,
      timestamp: new Date(),
    });

    if (action.startsWith('navigate:')) {
      navigate(action.replace('navigate:', ''));
    } else if (action.startsWith('open:')) {
      // ëª¨ë‹¬ ì—´ê¸° ë“± ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ë°œí–‰
      window.dispatchEvent(new CustomEvent('emptyStateAction', {
        detail: { action: action.replace('open:', ''), context }
      }));
    } else if (action.startsWith('reset:')) {
      window.dispatchEvent(new CustomEvent('emptyStateReset', {
        detail: { resetType: action.replace('reset:', ''), context }
      }));
    } else if (action.startsWith('oauth:')) {
      window.dispatchEvent(new CustomEvent('startOAuth', {
        detail: { provider: action.replace('oauth:', '') }
      }));
    }
  };

  // ì œì•ˆ í´ë¦­ í•¸ë“¤ëŸ¬
  const handleSuggestionClick = (suggestion: string, index: number) => {
    track('empty_state_cta_clicked', {
      reason,
      context,
      ctaType: 'suggestion',
      ctaLabel: suggestion,
      suggestionIndex: index,
      timestamp: new Date(),
    });
  };

  // ì‚¬ì´ì¦ˆë³„ ìŠ¤íƒ€ì¼
  const sizeStyles = useMemo(() => ({
    sm: {
      container: 'min-h-[120px] p-4',
      icon: 'w-12 h-12',
      title: 'text-sm font-medium',
      description: 'text-xs',
    },
    md: {
      container: 'min-h-[240px] p-6',
      icon: 'w-20 h-20',
      title: 'text-base font-semibold',
      description: 'text-sm',
    },
    lg: {
      container: 'min-h-[400px] p-12',
      icon: 'w-30 h-30',
      title: 'text-lg font-semibold',
      description: 'text-sm',
    },
  }[size]), [size]);

  // ì•„ì´ì½˜/ì¼ëŸ¬ìŠ¤íŠ¸ ë Œë”ë§
  const renderVisual = () => {
    if (illustration.type === 'icon') {
      const IconComponent = LucideIcons[ICON_MAP[illustration.name] || 'HelpCircle'] as React.ComponentType<{ className?: string }>;
      return (
        <div className={`rounded-full bg-gray-100 p-4 ${sizeStyles.icon}`}>
          <IconComponent className="w-full h-full text-gray-400" />
        </div>
      );
    }

    if (illustration.type === 'illustration') {
      const IllustrationComponent = ILLUSTRATIONS[illustration.name];
      return IllustrationComponent ? (
        <motion.div
          animate={{ y: [0, -4, 0] }}
          transition={{ duration: 3, repeat: Infinity, ease: 'easeInOut' }}
        >
          <IllustrationComponent className={sizeStyles.icon} />
        </motion.div>
      ) : null;
    }

    // animation type
    return (
      <motion.div
        animate={{ scale: [1, 1.1, 1], opacity: [0.5, 1, 0.5] }}
        transition={{ duration: 2, repeat: Infinity }}
        className={`rounded-full bg-blue-100 ${sizeStyles.icon}`}
      />
    );
  };

  return (
    <AnimatePresence>
      <motion.div
        initial={{ opacity: 0, scale: 0.95 }}
        animate={{ opacity: 1, scale: 1 }}
        exit={{ opacity: 0, scale: 0.95 }}
        transition={{ duration: 0.3, delay: 0.2 }}
        className={`flex flex-col items-center justify-center text-center ${sizeStyles.container} ${className}`}
      >
        {/* ë¹„ì£¼ì–¼ */}
        <motion.div
          initial={{ opacity: 0, y: -10 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.25 }}
        >
          {renderVisual()}
        </motion.div>

        {/* ì œëª© */}
        <motion.h3
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.3 }}
          className={`mt-4 text-gray-800 ${sizeStyles.title}`}
        >
          {title}
        </motion.h3>

        {/* ì„¤ëª… */}
        {description && (
          <motion.p
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.35 }}
            className={`mt-2 text-gray-500 max-w-[280px] ${sizeStyles.description}`}
          >
            {description}
          </motion.p>
        )}

        {/* Primary CTA */}
        {primaryAction && (
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.4 }}
          >
            <Button
              variant={primaryAction.variant}
              onClick={() => handleAction(primaryAction.action, primaryAction.label, 'primary')}
              className="mt-6 min-w-[160px]"
            >
              {primaryAction.label}
            </Button>
          </motion.div>
        )}

        {/* Secondary CTA */}
        {secondaryAction && (
          <motion.button
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.45 }}
            onClick={() => handleAction(secondaryAction.action, secondaryAction.label, 'secondary')}
            className="mt-3 text-sm text-gray-500 hover:text-blue-500 hover:underline transition-colors"
          >
            {secondaryAction.label}
          </motion.button>
        )}

        {/* ì œì•ˆ ì¹© */}
        {suggestions && suggestions.length > 0 && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.5 }}
            className="mt-5 flex flex-wrap justify-center gap-2 max-w-[320px]"
          >
            {suggestions.map((suggestion, index) => (
              <button
                key={index}
                onClick={() => handleSuggestionClick(suggestion, index)}
                className="px-3 py-1.5 text-xs text-gray-600 bg-gray-100 border border-gray-200 rounded-full hover:bg-gray-200 hover:text-gray-800 transition-colors"
              >
                ğŸ’¡ {suggestion}
              </button>
            ))}
          </motion.div>
        )}
      </motion.div>
    </AnimatePresence>
  );
});
```

### 14.49 ì¸ë¼ì¸ ë¹ˆ ìƒíƒœ ì»´í¬ë„ŒíŠ¸ (Part 6.3)

```tsx
// src/components/ui/EmptyState/InlineEmptyState.tsx
// Part 6.3: ì„¹ì…˜ ë‚´ ì¸ë¼ì¸ ë¹ˆ ìƒíƒœ

import { memo } from 'react';
import { motion } from 'framer-motion';
import * as LucideIcons from 'lucide-react';
import { track } from '@/services/analytics';

interface InlineEmptyStateProps {
  sectionId: string;
  sectionType: 'decisions' | 'actions' | 'insights' | 'participants';
  message: string;
  icon?: keyof typeof LucideIcons;
  showAddButton?: boolean;
  onAddClick?: () => void;
  className?: string;
}

export const InlineEmptyState = memo(function InlineEmptyState({
  sectionId,
  sectionType,
  message,
  icon = 'FileQuestion',
  showAddButton = false,
  onAddClick,
  className = '',
}: InlineEmptyStateProps) {
  const IconComponent = LucideIcons[icon] as React.ComponentType<{ className?: string }>;

  // ì¸ë¼ì¸ ë¹ˆ ìƒíƒœ í‘œì‹œ ì¶”ì 
  useEffect(() => {
    track('inline_empty_state_shown', {
      sectionId,
      sectionType,
      size: 'compact',
      timestamp: new Date(),
    });
  }, [sectionId, sectionType]);

  const handleAddClick = () => {
    track('inline_empty_state_interaction', {
      sectionId,
      interactionType: 'add_button',
      timestamp: new Date(),
    });
    onAddClick?.();
  };

  return (
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      className={`flex flex-col items-center justify-center p-6 bg-gray-50 border border-dashed border-gray-200 rounded-lg ${className}`}
    >
      {IconComponent && (
        <IconComponent className="w-8 h-8 text-gray-400 mb-2" />
      )}
      <p className="text-sm text-gray-500 text-center max-w-[200px]">
        {message}
      </p>
      {showAddButton && (
        <button
          onClick={handleAddClick}
          className="mt-3 flex items-center gap-1 text-sm text-blue-500 hover:text-blue-600 hover:bg-blue-50 px-3 py-1.5 rounded-md transition-colors"
        >
          <LucideIcons.Plus className="w-4 h-4" />
          ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€
        </button>
      )}
    </motion.div>
  );
});
```

### 14.50 ì»¨í…ìŠ¤íŠ¸ë³„ ë¹ˆ ìƒíƒœ í”„ë¦¬ì…‹ (Part 6.3)

```tsx
// src/components/ui/EmptyState/presets.tsx
// Part 6.3: ì»¨í…ìŠ¤íŠ¸ë³„ ë¹ˆ ìƒíƒœ í”„ë¦¬ì…‹

import { EmptyState } from './EmptyState';
import { memo } from 'react';

// ============================================
// Today í™”ë©´ ë¹ˆ ìƒíƒœë“¤
// ============================================

export const TodayFirstTimeEmptyState = memo(function TodayFirstTimeEmptyState() {
  return (
    <EmptyState
      reason="first_time"
      context="today_meetings"
      illustration={{ type: 'illustration', name: 'welcome-calendar', size: 'lg' }}
      title="ì²« ë¯¸íŒ…ì„ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”"
      description="ìº˜ë¦°ë”ë¥¼ ì—°ë™í•˜ë©´ ì˜¤ëŠ˜ ì˜ˆì •ëœ ë¯¸íŒ…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."
      tone="encouraging"
      primaryAction={{
        label: 'ìº˜ë¦°ë” ì—°ë™í•˜ê¸°',
        action: 'navigate:/settings/integrations',
        variant: 'primary',
      }}
      secondaryAction={{
        label: 'ìˆ˜ë™ìœ¼ë¡œ ë¯¸íŒ… ì¶”ê°€',
        action: 'open:add-meeting-modal',
        variant: 'secondary',
      }}
      size="lg"
    />
  );
});

export const TodayNoMeetingsEmptyState = memo(function TodayNoMeetingsEmptyState() {
  return (
    <EmptyState
      reason="no_data"
      context="today_meetings"
      illustration={{ type: 'illustration', name: 'relax-coffee', size: 'md' }}
      title="ì˜¤ëŠ˜ì€ ë¯¸íŒ…ì´ ì—†ì–´ìš”"
      description="ì—¬ìœ ë¡œìš´ í•˜ë£¨ ë³´ë‚´ì„¸ìš”! ì§€ë‚œ ë¯¸íŒ…ì„ ëŒì•„ë³´ê±°ë‚˜ ê²€ìƒ‰í•´ë³´ì„¸ìš”."
      tone="positive"
      primaryAction={{
        label: 'ì§€ë‚œ ë¯¸íŒ… ë³´ê¸°',
        action: 'navigate:/search?filter=past',
        variant: 'secondary',
      }}
      suggestions={['ì§€ë‚œ ì£¼ ë¯¸íŒ… ë³µìŠµí•˜ê¸°', 'ê²°ì • ì‚¬í•­ í™•ì¸í•˜ê¸°']}
    />
  );
});

export const TodayAllCompletedEmptyState = memo(function TodayAllCompletedEmptyState() {
  return (
    <EmptyState
      reason="completed_all"
      context="today_meetings"
      illustration={{ type: 'icon', name: 'check-circle', size: 'lg' }}
      title="ì˜¤ëŠ˜ ë¯¸íŒ… ì™„ë£Œ! ğŸ‰"
      description="ëª¨ë“  ë¯¸íŒ…ì„ ë§ˆì³¤ìŠµë‹ˆë‹¤. ìˆ˜ê³ í•˜ì…¨ì–´ìš”!"
      tone="positive"
      primaryAction={{
        label: 'ì˜¤ëŠ˜ì˜ ê²°ì • ì‚¬í•­ ë³´ê¸°',
        action: 'navigate:/decisions?date=today',
        variant: 'primary',
      }}
    />
  );
});

// ============================================
// ê²€ìƒ‰ í™”ë©´ ë¹ˆ ìƒíƒœë“¤
// ============================================

export const SearchInitialEmptyState = memo(function SearchInitialEmptyState() {
  return (
    <EmptyState
      reason="first_time"
      context="search_results"
      illustration={{ type: 'icon', name: 'search', size: 'lg' }}
      title="ë¬´ì—‡ì„ ì°¾ìœ¼ì‹œë‚˜ìš”?"
      description="ë¯¸íŒ…, ê²°ì •, ì¸ì‚¬ì´íŠ¸ë¥¼ ìì—°ì–´ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”"
      tone="helpful"
      suggestions={[
        '"ì§€ë‚œ ë‹¬ ì˜ˆì‚° ê´€ë ¨ ê²°ì •"',
        '"ê¹€ì² ìˆ˜ì™€ì˜ ë¯¸íŒ…"',
        '"Q4 ì „ëµ ë…¼ì˜"',
      ]}
      size="lg"
    />
  );
});

interface SearchNoResultsEmptyStateProps {
  query: string;
  onResetFilters: () => void;
}

export const SearchNoResultsEmptyState = memo(function SearchNoResultsEmptyState({
  query,
  onResetFilters,
}: SearchNoResultsEmptyStateProps) {
  return (
    <EmptyState
      reason="search_no_match"
      context="search_results"
      illustration={{ type: 'illustration', name: 'no-results', size: 'md' }}
      title="ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤"
      description={`"${query}"ì— ëŒ€í•œ ê²°ê³¼ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤`}
      tone="helpful"
      primaryAction={{
        label: 'í•„í„° ì´ˆê¸°í™”',
        action: 'reset:search-filters',
        variant: 'secondary',
      }}
      suggestions={['ë” ì§§ì€ í‚¤ì›Œë“œ ì‚¬ìš©', 'ë‚ ì§œ ë²”ìœ„ í™•ëŒ€', 'í•„í„° ì¡°ê±´ ì™„í™”']}
    />
  );
});

// ============================================
// ì„¤ì • í™”ë©´ ë¹ˆ ìƒíƒœë“¤
// ============================================

export const IntegrationsEmptyState = memo(function IntegrationsEmptyState() {
  return (
    <EmptyState
      reason="feature_not_setup"
      context="integrations"
      illustration={{ type: 'illustration', name: 'connect-apps', size: 'lg' }}
      title="ì—°ë™ëœ ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤"
      description="Notion, Salesforce, Slackê³¼ ì—°ë™í•˜ì—¬ ì—…ë¬´ íš¨ìœ¨ì„ ë†’ì´ì„¸ìš”"
      tone="encouraging"
      primaryAction={{
        label: 'Notion ì—°ë™í•˜ê¸°',
        action: 'oauth:notion',
        variant: 'primary',
      }}
      suggestions={['ìº˜ë¦°ë” ì—°ë™ìœ¼ë¡œ ë¯¸íŒ… ìë™ ê°ì§€', 'Slack ì—°ë™ìœ¼ë¡œ ì•Œë¦¼ ë°›ê¸°']}
      size="lg"
    />
  );
});

export const NotificationsEmptyState = memo(function NotificationsEmptyState() {
  return (
    <EmptyState
      reason="no_data"
      context="notifications"
      illustration={{ type: 'icon', name: 'bell-off', size: 'md' }}
      title="ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤"
      description="ë¯¸íŒ… ê´€ë ¨ ì†Œì‹ì´ ìˆìœ¼ë©´ ì•Œë ¤ë“œë¦´ê²Œìš”"
      tone="neutral"
      size="md"
    />
  );
});
```

### 14.51 ë¹ˆ ìƒíƒœ Analytics Hook (Part 6.3)

```typescript
// src/hooks/useEmptyStateAnalytics.ts
// Part 6.3: ë¹ˆ ìƒíƒœ ë¶„ì„ Hook

import { useCallback, useRef, useEffect } from 'react';
import { track } from '@/services/analytics';

type EmptyStateReason = 'first_time' | 'no_data' | 'filtered_out' | 'search_no_match' | 'completed_all' | 'temporal_gap' | 'permission_limited' | 'feature_not_setup';
type EmptyStateContext = 'today_meetings' | 'past_meetings' | 'search_results' | 'decisions_list' | 'actions_list' | 'insights_list' | 'notifications' | 'integrations' | 'hud_idle' | 'filter_results';

export function useEmptyStateAnalytics() {
  const showTimeRef = useRef<Map<string, number>>(new Map());

  // ë¹ˆ ìƒíƒœ í‘œì‹œ ì¶”ì 
  const trackEmptyStateShown = useCallback((
    emptyStateId: string,
    reason: EmptyStateReason,
    context: EmptyStateContext,
    options?: {
      isFirstTime?: boolean;
      hasPrimaryCta?: boolean;
      hasSecondaryCta?: boolean;
    }
  ) => {
    showTimeRef.current.set(emptyStateId, Date.now());

    track('empty_state_shown', {
      emptyStateId,
      reason,
      context,
      screen: window.location.pathname,
      ...options,
      timestamp: new Date(),
    });
  }, []);

  // CTA í´ë¦­ ì¶”ì 
  const trackCtaClicked = useCallback((
    emptyStateId: string,
    reason: EmptyStateReason,
    context: EmptyStateContext,
    ctaType: 'primary' | 'secondary' | 'suggestion' | 'link',
    ctaLabel: string,
    ctaAction: string
  ) => {
    const showTime = showTimeRef.current.get(emptyStateId);
    const timeToClick = showTime ? Date.now() - showTime : 0;

    track('empty_state_cta_clicked', {
      emptyStateId,
      reason,
      context,
      ctaType,
      ctaLabel,
      ctaAction,
      timeToClickMs: timeToClick,
      timestamp: new Date(),
    });
  }, []);

  // ë¹ˆ ìƒíƒœ í•´ì†Œ ì¶”ì 
  const trackEmptyStateDismissed = useCallback((
    emptyStateId: string,
    reason: EmptyStateReason,
    context: EmptyStateContext,
    dismissMethod: 'data_created' | 'filter_changed' | 'navigation' | 'refresh',
    ctaClicked: boolean
  ) => {
    const showTime = showTimeRef.current.get(emptyStateId);
    const timeSpent = showTime ? Date.now() - showTime : 0;
    showTimeRef.current.delete(emptyStateId);

    track('empty_state_dismissed', {
      emptyStateId,
      reason,
      context,
      dismissMethod,
      timeSpentMs: timeSpent,
      ctaClicked,
      timestamp: new Date(),
    });
  }, []);

  // ë¹ˆ ìƒíƒœì—ì„œ ë‹¤ë¥¸ í™”ë©´ìœ¼ë¡œ ì´ë™ ì¶”ì 
  const trackEmptyStateNavigated = useCallback((
    emptyStateId: string,
    reason: EmptyStateReason,
    context: EmptyStateContext,
    navigatedTo: string,
    navigationMethod: 'cta' | 'nav_bar' | 'back_button' | 'link'
  ) => {
    const showTime = showTimeRef.current.get(emptyStateId);
    const timeSpent = showTime ? Date.now() - showTime : 0;
    showTimeRef.current.delete(emptyStateId);

    track('empty_state_navigated', {
      emptyStateId,
      reason,
      context,
      navigatedTo,
      navigationMethod,
      timeSpentMs: timeSpent,
      timestamp: new Date(),
    });
  }, []);

  // ë¹ˆ ìƒíƒœì—ì„œ ì´íƒˆ ì¶”ì 
  const trackEmptyStateBounced = useCallback((
    emptyStateId: string,
    reason: EmptyStateReason,
    context: EmptyStateContext,
    bounceType: 'app_close' | 'tab_close' | 'session_timeout',
    anyInteraction: boolean
  ) => {
    const showTime = showTimeRef.current.get(emptyStateId);
    const timeSpent = showTime ? Date.now() - showTime : 0;

    track('empty_state_bounced', {
      emptyStateId,
      reason,
      context,
      bounceType,
      timeSpentMs: timeSpent,
      anyInteraction,
      timestamp: new Date(),
    });
  }, []);

  // ì²« ì‚¬ìš©ì ì˜¨ë³´ë”© ì¶”ì 
  const trackFirstTimeOnboarding = useCallback((
    emptyStateId: string,
    context: EmptyStateContext,
    event: 'shown' | 'started' | 'completed' | 'skipped',
    details?: {
      onboardingType?: string;
      actionSelected?: string;
      success?: boolean;
      skipReason?: string;
      durationMs?: number;
    }
  ) => {
    const showTime = showTimeRef.current.get(emptyStateId);
    const timeSpent = showTime ? Date.now() - showTime : 0;

    track(`first_time_onboarding_${event}`, {
      emptyStateId,
      context,
      timeToActionMs: timeSpent,
      ...details,
      timestamp: new Date(),
    });
  }, []);

  // ê²€ìƒ‰ ë¹ˆ ìƒíƒœ ì œì•ˆ í´ë¦­ ì¶”ì 
  const trackSearchSuggestionClicked = useCallback((
    emptyStateId: string,
    originalQuery: string,
    suggestionType: 'query' | 'filter' | 'reset',
    suggestionValue: string,
    suggestionIndex: number
  ) => {
    track('search_empty_suggestion_clicked', {
      emptyStateId,
      originalQuery,
      suggestionType,
      suggestionValue,
      suggestionIndex,
      timestamp: new Date(),
    });
  }, []);

  return {
    trackEmptyStateShown,
    trackCtaClicked,
    trackEmptyStateDismissed,
    trackEmptyStateNavigated,
    trackEmptyStateBounced,
    trackFirstTimeOnboarding,
    trackSearchSuggestionClicked,
  };
}
```

### 14.52 ë¹ˆ ìƒíƒœ í›… - useEmptyState (Part 6.3)

```typescript
// src/hooks/useEmptyState.ts
// Part 6.3: ì¡°ê±´ë¶€ ë¹ˆ ìƒíƒœ í‘œì‹œ í›…

import { useMemo } from 'react';

interface UseEmptyStateOptions<T> {
  data: T[] | T | null | undefined;
  isLoading?: boolean;
  isError?: boolean;
  isFirstTime?: boolean;
  hasFilters?: boolean;
  allCompleted?: boolean;
}

interface EmptyStateResult {
  isEmpty: boolean;
  reason: 'first_time' | 'no_data' | 'filtered_out' | 'completed_all' | null;
  showEmptyState: boolean;
}

export function useEmptyState<T>({
  data,
  isLoading = false,
  isError = false,
  isFirstTime = false,
  hasFilters = false,
  allCompleted = false,
}: UseEmptyStateOptions<T>): EmptyStateResult {

  return useMemo(() => {
    // ë¡œë”© ì¤‘ì´ê±°ë‚˜ ì—ëŸ¬ë©´ ë¹ˆ ìƒíƒœ ì•„ë‹˜
    if (isLoading || isError) {
      return { isEmpty: false, reason: null, showEmptyState: false };
    }

    // ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ í™•ì¸
    const hasData = Array.isArray(data)
      ? data.length > 0
      : data !== null && data !== undefined;

    if (hasData) {
      // ëª¨ë“  í•­ëª© ì™„ë£Œ ìƒíƒœ ì²´í¬
      if (allCompleted) {
        return { isEmpty: true, reason: 'completed_all', showEmptyState: true };
      }
      return { isEmpty: false, reason: null, showEmptyState: false };
    }

    // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°
    if (isFirstTime) {
      return { isEmpty: true, reason: 'first_time', showEmptyState: true };
    }

    if (hasFilters) {
      return { isEmpty: true, reason: 'filtered_out', showEmptyState: true };
    }

    return { isEmpty: true, reason: 'no_data', showEmptyState: true };
  }, [data, isLoading, isError, isFirstTime, hasFilters, allCompleted]);
}

// ì‚¬ìš© ì˜ˆì‹œ
/*
const { isEmpty, reason, showEmptyState } = useEmptyState({
  data: meetings,
  isLoading,
  isFirstTime: !user.hasCompletedOnboarding,
  hasFilters: activeFilters.length > 0,
});

if (showEmptyState) {
  switch (reason) {
    case 'first_time':
      return <TodayFirstTimeEmptyState />;
    case 'no_data':
      return <TodayNoMeetingsEmptyState />;
    case 'filtered_out':
      return <FilteredEmptyState onReset={resetFilters} />;
    case 'completed_all':
      return <TodayAllCompletedEmptyState />;
  }
}
*/
```

### 14.53 ì ‘ê·¼ì„± Store (Part 6.4)

```typescript
// src/stores/accessibility.store.ts

import { create } from 'zustand';
import { persist } from 'zustand/middleware';

// Part 6.4: ì ‘ê·¼ì„± ì„¤ì • ë° ìƒíƒœ ê´€ë¦¬ Zustand Store

// ============================================
// 14.53.1 ì ‘ê·¼ì„± ì„¤ì • íƒ€ì…
// ============================================

interface AccessibilitySettings {
  // ëª¨ì…˜ ì„¤ì •
  reduceMotion: boolean;
  reduceTransparency: boolean;

  // ì‹œê°ì  ì„¤ì •
  highContrast: boolean;
  largeText: boolean;
  textScaleFactor: number; // 1.0 - 2.0

  // í¬ì»¤ìŠ¤ ì„¤ì •
  showFocusOutline: boolean;
  focusOutlineWidth: 'normal' | 'thick';

  // ìŠ¤í¬ë¦° ë¦¬ë” ìµœì í™”
  verboseMode: boolean;
  announceStatusChanges: boolean;

  // í‚¤ë³´ë“œ ì„¤ì •
  keyboardShortcutsEnabled: boolean;
}

interface AccessibilityState extends AccessibilitySettings {
  // ê°ì§€ëœ ì‹œìŠ¤í…œ ì„¤ì •
  systemPrefersReducedMotion: boolean;
  systemPrefersHighContrast: boolean;
  screenReaderActive: boolean;

  // ì•¡ì…˜
  updateSetting: <K extends keyof AccessibilitySettings>(
    key: K,
    value: AccessibilitySettings[K]
  ) => void;
  resetToDefaults: () => void;
  syncWithSystemPreferences: () => void;
}

// ============================================
// 14.53.2 ê¸°ë³¸ê°’
// ============================================

const DEFAULT_SETTINGS: AccessibilitySettings = {
  reduceMotion: false,
  reduceTransparency: false,
  highContrast: false,
  largeText: false,
  textScaleFactor: 1.0,
  showFocusOutline: true,
  focusOutlineWidth: 'normal',
  verboseMode: false,
  announceStatusChanges: true,
  keyboardShortcutsEnabled: true,
};

// ============================================
// 14.53.3 ì ‘ê·¼ì„± Store
// ============================================

export const useAccessibilityStore = create<AccessibilityState>()(
  persist(
    (set, get) => ({
      ...DEFAULT_SETTINGS,

      // ì‹œìŠ¤í…œ ì„¤ì • ê°ì§€ ìƒíƒœ
      systemPrefersReducedMotion: false,
      systemPrefersHighContrast: false,
      screenReaderActive: false,

      updateSetting: (key, value) => {
        set({ [key]: value });

        // Analytics ì´ë²¤íŠ¸
        track('accessibility_setting_changed', {
          settingName: key,
          newValue: value,
          source: 'user_preference',
        });
      },

      resetToDefaults: () => {
        set(DEFAULT_SETTINGS);
        track('accessibility_settings_reset', {});
      },

      syncWithSystemPreferences: () => {
        const prefersReducedMotion =
          window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        const prefersHighContrast =
          window.matchMedia('(prefers-contrast: more)').matches;

        set({
          systemPrefersReducedMotion: prefersReducedMotion,
          systemPrefersHighContrast: prefersHighContrast,
          reduceMotion: prefersReducedMotion,
          highContrast: prefersHighContrast,
        });
      },
    }),
    {
      name: 'accessibility-settings',
      partialize: (state) => ({
        reduceMotion: state.reduceMotion,
        highContrast: state.highContrast,
        largeText: state.largeText,
        textScaleFactor: state.textScaleFactor,
        showFocusOutline: state.showFocusOutline,
        focusOutlineWidth: state.focusOutlineWidth,
        keyboardShortcutsEnabled: state.keyboardShortcutsEnabled,
      }),
    }
  )
);

// ============================================
// 14.53.4 ì‹œìŠ¤í…œ ì„¤ì • ê°ì§€ í›…
// ============================================

export function useSystemAccessibilityPreferences() {
  const syncWithSystemPreferences = useAccessibilityStore(
    (state) => state.syncWithSystemPreferences
  );

  useEffect(() => {
    // ì´ˆê¸° ë™ê¸°í™”
    syncWithSystemPreferences();

    // ì‹œìŠ¤í…œ ì„¤ì • ë³€ê²½ ê°ì§€
    const reducedMotionQuery = window.matchMedia(
      '(prefers-reduced-motion: reduce)'
    );
    const highContrastQuery = window.matchMedia('(prefers-contrast: more)');

    const handleChange = () => syncWithSystemPreferences();

    reducedMotionQuery.addEventListener('change', handleChange);
    highContrastQuery.addEventListener('change', handleChange);

    return () => {
      reducedMotionQuery.removeEventListener('change', handleChange);
      highContrastQuery.removeEventListener('change', handleChange);
    };
  }, [syncWithSystemPreferences]);
}
```

### 14.54 í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ í›… (Part 6.4)

```typescript
// src/hooks/useKeyboardNavigation.ts

import { useCallback, useEffect, useRef } from 'react';
import { useAccessibilityStore } from '@/stores/accessibility.store';
import { track } from '@/services/analytics';

// Part 6.4: í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ë° ë‹¨ì¶•í‚¤ ê´€ë¦¬

// ============================================
// 14.54.1 í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì •ì˜
// ============================================

interface KeyboardShortcut {
  key: string;
  modifiers?: ('ctrl' | 'alt' | 'shift' | 'meta')[];
  action: () => void;
  description: string;
  scope: 'global' | 'today' | 'hud' | 'search' | 'modal' | 'settings';
  preventDefault?: boolean;
}

// ============================================
// 14.54.2 í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ í›…
// ============================================

export function useKeyboardShortcuts(
  shortcuts: KeyboardShortcut[],
  scope: string,
  enabled = true
) {
  const keyboardShortcutsEnabled = useAccessibilityStore(
    (state) => state.keyboardShortcutsEnabled
  );

  const handleKeyDown = useCallback(
    (event: KeyboardEvent) => {
      if (!enabled || !keyboardShortcutsEnabled) return;

      // ì…ë ¥ í•„ë“œ ë‚´ì—ì„œëŠ” ë‹¨ì¶•í‚¤ ë¹„í™œì„±í™”
      const target = event.target as HTMLElement;
      if (
        target.tagName === 'INPUT' ||
        target.tagName === 'TEXTAREA' ||
        target.isContentEditable
      ) {
        // EscapeëŠ” ì˜ˆì™¸
        if (event.key !== 'Escape') return;
      }

      for (const shortcut of shortcuts) {
        if (shortcut.scope !== 'global' && shortcut.scope !== scope) continue;

        const keyMatch = event.key.toLowerCase() === shortcut.key.toLowerCase();
        const ctrlMatch = !shortcut.modifiers?.includes('ctrl') || event.ctrlKey;
        const altMatch = !shortcut.modifiers?.includes('alt') || event.altKey;
        const shiftMatch = !shortcut.modifiers?.includes('shift') || event.shiftKey;
        const metaMatch = !shortcut.modifiers?.includes('meta') || event.metaKey;

        if (keyMatch && ctrlMatch && altMatch && shiftMatch && metaMatch) {
          if (shortcut.preventDefault !== false) {
            event.preventDefault();
          }

          shortcut.action();

          // Analytics
          track('keyboard_shortcut_used', {
            shortcutKey: shortcut.key,
            modifiers: shortcut.modifiers || [],
            action: shortcut.description,
            scope: shortcut.scope,
            success: true,
          });

          break;
        }
      }
    },
    [shortcuts, scope, enabled, keyboardShortcutsEnabled]
  );

  useEffect(() => {
    document.addEventListener('keydown', handleKeyDown);
    return () => document.removeEventListener('keydown', handleKeyDown);
  }, [handleKeyDown]);
}

// ============================================
// 14.54.3 ë¦¬ìŠ¤íŠ¸ íƒìƒ‰ í›…
// ============================================

export function useListNavigation<T>(
  items: T[],
  onSelect?: (item: T, index: number) => void
) {
  const [focusedIndex, setFocusedIndex] = useState(-1);
  const listRef = useRef<HTMLDivElement>(null);

  const handleKeyDown = useCallback(
    (event: React.KeyboardEvent) => {
      const itemCount = items.length;
      if (itemCount === 0) return;

      switch (event.key) {
        case 'ArrowDown':
        case 'j':
          event.preventDefault();
          setFocusedIndex((prev) => (prev + 1) % itemCount);
          break;

        case 'ArrowUp':
        case 'k':
          event.preventDefault();
          setFocusedIndex((prev) => (prev - 1 + itemCount) % itemCount);
          break;

        case 'Home':
          event.preventDefault();
          setFocusedIndex(0);
          break;

        case 'End':
          event.preventDefault();
          setFocusedIndex(itemCount - 1);
          break;

        case 'Enter':
        case ' ':
          if (focusedIndex >= 0 && onSelect) {
            event.preventDefault();
            onSelect(items[focusedIndex], focusedIndex);
          }
          break;
      }
    },
    [items, focusedIndex, onSelect]
  );

  // í¬ì»¤ìŠ¤ëœ ì•„ì´í…œìœ¼ë¡œ ìŠ¤í¬ë¡¤
  useEffect(() => {
    if (focusedIndex >= 0 && listRef.current) {
      const focusedElement = listRef.current.querySelector(
        `[data-index="${focusedIndex}"]`
      ) as HTMLElement;

      focusedElement?.scrollIntoView({
        block: 'nearest',
        behavior: 'smooth',
      });
    }
  }, [focusedIndex]);

  return {
    focusedIndex,
    setFocusedIndex,
    handleKeyDown,
    listRef,
    getItemProps: (index: number) => ({
      'data-index': index,
      'aria-selected': focusedIndex === index,
      tabIndex: focusedIndex === index ? 0 : -1,
    }),
  };
}

// ============================================
// 14.54.4 ë‹¨ì¶•í‚¤ ì•ˆë‚´ ëª¨ë‹¬
// ============================================

interface ShortcutsHelpModalProps {
  isOpen: boolean;
  onClose: () => void;
}

export function ShortcutsHelpModal({ isOpen, onClose }: ShortcutsHelpModalProps) {
  const shortcuts = [
    { scope: 'ì „ì—­', items: [
      { key: '/', description: 'ê²€ìƒ‰ìœ¼ë¡œ ì´ë™' },
      { key: 'Esc', description: 'ëª¨ë‹¬ ë‹«ê¸°' },
      { key: 'Shift + ?', description: 'ë‹¨ì¶•í‚¤ ì•ˆë‚´' },
    ]},
    { scope: 'Today í™”ë©´', items: [
      { key: 'j', description: 'ë‹¤ìŒ ë¯¸íŒ…' },
      { key: 'k', description: 'ì´ì „ ë¯¸íŒ…' },
      { key: 'Enter', description: 'ë¯¸íŒ… ì—´ê¸°' },
      { key: 'p', description: 'ë¯¸íŒ… ì¤€ë¹„' },
    ]},
    { scope: 'HUD', items: [
      { key: 'Space', description: 'ë…¹ìŒ í† ê¸€' },
      { key: 'c', description: 'ê²°ì • í™•ì •' },
      { key: 'd', description: 'ì œì•ˆ ë¬´ì‹œ' },
    ]},
  ];

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent
        className="max-w-md"
        aria-labelledby="shortcuts-title"
      >
        <DialogHeader>
          <DialogTitle id="shortcuts-title">í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤</DialogTitle>
        </DialogHeader>

        <div className="space-y-6">
          {shortcuts.map((section) => (
            <div key={section.scope}>
              <h3 className="text-sm font-semibold text-gray-500 mb-2">
                {section.scope}
              </h3>
              <div className="space-y-2">
                {section.items.map((item) => (
                  <div
                    key={item.key}
                    className="flex justify-between items-center"
                  >
                    <span className="text-sm text-gray-700">
                      {item.description}
                    </span>
                    <kbd className="px-2 py-1 bg-gray-100 border border-gray-200 rounded text-xs font-mono">
                      {item.key}
                    </kbd>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      </DialogContent>
    </Dialog>
  );
}
```

### 14.55 í¬ì»¤ìŠ¤ íŠ¸ë© í›… (Part 6.4)

```typescript
// src/hooks/useFocusTrap.ts

import { useEffect, useRef, useCallback } from 'react';
import { track } from '@/services/analytics';

// Part 6.4: ëª¨ë‹¬/íŒ¨ë„ìš© í¬ì»¤ìŠ¤ íŠ¸ë© ê´€ë¦¬

// ============================================
// 14.55.1 í¬ì»¤ìŠ¤ ê°€ëŠ¥ ìš”ì†Œ ì„ íƒì
// ============================================

const FOCUSABLE_SELECTORS = [
  'button:not([disabled])',
  'input:not([disabled])',
  'select:not([disabled])',
  'textarea:not([disabled])',
  'a[href]',
  '[tabindex]:not([tabindex="-1"])',
  '[contenteditable="true"]',
].join(', ');

// ============================================
// 14.55.2 í¬ì»¤ìŠ¤ íŠ¸ë© í›…
// ============================================

interface UseFocusTrapOptions {
  enabled?: boolean;
  returnFocusOnClose?: boolean;
  initialFocus?: string; // ì´ˆê¸° í¬ì»¤ìŠ¤ ìš”ì†Œ ì„ íƒì
  onEscape?: () => void;
}

export function useFocusTrap<T extends HTMLElement = HTMLDivElement>(
  options: UseFocusTrapOptions = {}
) {
  const {
    enabled = true,
    returnFocusOnClose = true,
    initialFocus,
    onEscape,
  } = options;

  const containerRef = useRef<T>(null);
  const previousFocusRef = useRef<HTMLElement | null>(null);
  const entryTimeRef = useRef<number>(0);

  // í¬ì»¤ìŠ¤ ê°€ëŠ¥ ìš”ì†Œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
  const getFocusableElements = useCallback(() => {
    if (!containerRef.current) return [];
    return Array.from(
      containerRef.current.querySelectorAll<HTMLElement>(FOCUSABLE_SELECTORS)
    ).filter((el) => el.offsetParent !== null); // ë³´ì´ëŠ” ìš”ì†Œë§Œ
  }, []);

  // í¬ì»¤ìŠ¤ íŠ¸ë© í™œì„±í™”
  useEffect(() => {
    if (!enabled || !containerRef.current) return;

    // ì´ì „ í¬ì»¤ìŠ¤ ì €ì¥
    previousFocusRef.current = document.activeElement as HTMLElement;
    entryTimeRef.current = Date.now();

    // ì´ˆê¸° í¬ì»¤ìŠ¤ ì„¤ì •
    const focusableElements = getFocusableElements();
    if (initialFocus) {
      const initialElement = containerRef.current.querySelector<HTMLElement>(
        initialFocus
      );
      initialElement?.focus();
    } else if (focusableElements.length > 0) {
      focusableElements[0].focus();
    }

    track('focus_trap_entered', {
      trapContainerId: containerRef.current.id || 'unknown',
      trapType: 'modal',
    });

    // í´ë¦°ì—…: ì›ë˜ í¬ì»¤ìŠ¤ë¡œ ë³µê·€
    return () => {
      if (returnFocusOnClose && previousFocusRef.current) {
        const timeInTrap = Date.now() - entryTimeRef.current;

        track('focus_trap_exited', {
          trapContainerId: containerRef.current?.id || 'unknown',
          timeInTrapMs: timeInTrap,
          focusReturnedCorrectly: true,
        });

        previousFocusRef.current.focus();
      }
    };
  }, [enabled, initialFocus, returnFocusOnClose, getFocusableElements]);

  // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
  useEffect(() => {
    if (!enabled || !containerRef.current) return;

    const handleKeyDown = (event: KeyboardEvent) => {
      if (event.key === 'Escape' && onEscape) {
        event.preventDefault();
        onEscape();
        return;
      }

      if (event.key !== 'Tab') return;

      const focusableElements = getFocusableElements();
      if (focusableElements.length === 0) return;

      const firstElement = focusableElements[0];
      const lastElement = focusableElements[focusableElements.length - 1];

      // Shift + Tab: ì²« ìš”ì†Œì—ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ
      if (event.shiftKey && document.activeElement === firstElement) {
        event.preventDefault();
        lastElement.focus();
      }
      // Tab: ë§ˆì§€ë§‰ ìš”ì†Œì—ì„œ ì²« ë²ˆì§¸ë¡œ
      else if (!event.shiftKey && document.activeElement === lastElement) {
        event.preventDefault();
        firstElement.focus();
      }
    };

    document.addEventListener('keydown', handleKeyDown);
    return () => document.removeEventListener('keydown', handleKeyDown);
  }, [enabled, getFocusableElements, onEscape]);

  return containerRef;
}

// ============================================
// 14.55.3 í¬ì»¤ìŠ¤ íŠ¸ë© ë˜í¼ ì»´í¬ë„ŒíŠ¸
// ============================================

interface FocusTrapProps {
  children: React.ReactNode;
  enabled?: boolean;
  onEscape?: () => void;
  className?: string;
}

export function FocusTrap({
  children,
  enabled = true,
  onEscape,
  className,
}: FocusTrapProps) {
  const trapRef = useFocusTrap<HTMLDivElement>({ enabled, onEscape });

  return (
    <div ref={trapRef} className={className}>
      {children}
    </div>
  );
}
```

### 14.56 ìŠ¤í¬ë¦° ë¦¬ë” ìœ í‹¸ë¦¬í‹° (Part 6.4)

```typescript
// src/utils/screenReader.ts

// Part 6.4: ìŠ¤í¬ë¦° ë¦¬ë” ì§€ì› ìœ í‹¸ë¦¬í‹°

// ============================================
// 14.56.1 ìŠ¤í¬ë¦° ë¦¬ë” ì „ìš© í…ìŠ¤íŠ¸ ì»´í¬ë„ŒíŠ¸
// ============================================

interface VisuallyHiddenProps {
  children: React.ReactNode;
  as?: keyof JSX.IntrinsicElements;
}

export function VisuallyHidden({ children, as: Tag = 'span' }: VisuallyHiddenProps) {
  return (
    <Tag
      style={{
        position: 'absolute',
        width: '1px',
        height: '1px',
        padding: 0,
        margin: '-1px',
        overflow: 'hidden',
        clip: 'rect(0, 0, 0, 0)',
        whiteSpace: 'nowrap',
        border: 0,
      }}
    >
      {children}
    </Tag>
  );
}

// ============================================
// 14.56.2 ARIA ë¼ì´ë¸Œ ë¦¬ì „ ì»´í¬ë„ŒíŠ¸
// ============================================

interface LiveRegionProps {
  children: React.ReactNode;
  politeness?: 'polite' | 'assertive' | 'off';
  atomic?: boolean;
  relevant?: 'additions' | 'removals' | 'text' | 'all';
  className?: string;
}

export function LiveRegion({
  children,
  politeness = 'polite',
  atomic = false,
  relevant = 'additions',
  className,
}: LiveRegionProps) {
  return (
    <div
      aria-live={politeness}
      aria-atomic={atomic}
      aria-relevant={relevant}
      className={className}
    >
      {children}
    </div>
  );
}

// ============================================
// 14.56.3 ìŠ¤í¬ë¦° ë¦¬ë” ì•Œë¦¼ í›…
// ============================================

export function useAnnounce() {
  const [message, setMessage] = useState('');

  const announce = useCallback(
    (text: string, priority: 'polite' | 'assertive' = 'polite') => {
      // ë©”ì‹œì§€ë¥¼ ì¼ì‹œì ìœ¼ë¡œ í´ë¦¬ì–´í•˜ì—¬ ë™ì¼ ë©”ì‹œì§€ë„ ë‹¤ì‹œ ì½íˆë„ë¡
      setMessage('');
      setTimeout(() => setMessage(text), 50);

      track('aria_live_announced', {
        message: text.substring(0, 100), // ê°œì¸ì •ë³´ ì œí•œ
        ariaLive: priority,
      });
    },
    []
  );

  const Announcer = useCallback(
    ({ politeness = 'polite' }: { politeness?: 'polite' | 'assertive' }) => (
      <div
        aria-live={politeness}
        aria-atomic="true"
        style={{
          position: 'absolute',
          width: '1px',
          height: '1px',
          padding: 0,
          margin: '-1px',
          overflow: 'hidden',
          clip: 'rect(0, 0, 0, 0)',
          whiteSpace: 'nowrap',
          border: 0,
        }}
      >
        {message}
      </div>
    ),
    [message]
  );

  return { announce, Announcer };
}

// ============================================
// 14.56.4 ìŠ¤í¬ë¦° ë¦¬ë” ê°ì§€ í›…
// ============================================

export function useScreenReaderDetection() {
  const [isScreenReaderActive, setIsScreenReaderActive] = useState(false);

  useEffect(() => {
    // íœ´ë¦¬ìŠ¤í‹± ê¸°ë°˜ ìŠ¤í¬ë¦° ë¦¬ë” ê°ì§€
    const checkScreenReader = () => {
      // aria-hiddenì´ trueì¸ ìš”ì†Œì— í¬ì»¤ìŠ¤ê°€ ê°€ë©´ ìŠ¤í¬ë¦° ë¦¬ë”ì¼ ê°€ëŠ¥ì„±
      // ë˜ëŠ” navigator.userAgentì—ì„œ íŒíŠ¸ ì°¾ê¸°
      const hasVoiceOverHint =
        navigator.userAgent.includes('VoiceOver') ||
        'speechSynthesis' in window;

      setIsScreenReaderActive(hasVoiceOverHint);
    };

    checkScreenReader();

    // ìŠ¤í¬ë¦° ë¦¬ë”ëŠ” ë³´í†µ ì²˜ìŒë¶€í„° í™œì„±í™”ë˜ì–´ ìˆìœ¼ë¯€ë¡œ
    // í˜ì´ì§€ ë¡œë“œ ì‹œ í•œ ë²ˆë§Œ ì²´í¬
  }, []);

  return isScreenReaderActive;
}

// ============================================
// 14.56.5 ARIA ë ˆì´ë¸” í—¬í¼
// ============================================

export const ARIA_LABELS = {
  // ë„¤ë¹„ê²Œì´ì…˜
  mainNav: 'ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜',
  tabBar: 'íƒ­ ë°”',
  skipLink: 'ë³¸ë¬¸ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°',

  // Today í™”ë©´
  meetingList: 'ì˜¤ëŠ˜ì˜ ë¯¸íŒ… ëª©ë¡',
  meetingCard: (title: string, time: string) => `${title}, ${time} ë¯¸íŒ…`,
  prepareButton: (title: string) => `${title} ë¯¸íŒ… ì¤€ë¹„í•˜ê¸°`,

  // HUD
  hudPanel: 'HUD íŒ¨ë„',
  suggestionCard: (type: string) => `AI ì œì•ˆ: ${type}`,
  confirmButton: 'ê²°ì • í™•ì •í•˜ê¸°',
  dismissButton: 'ì œì•ˆ ë¬´ì‹œí•˜ê¸°',

  // ê²€ìƒ‰
  searchInput: 'ë¯¸íŒ… ê²€ìƒ‰',
  searchResults: (count: number) => `ê²€ìƒ‰ ê²°ê³¼ ${count}ê°œ`,
  filterPanel: 'ê²€ìƒ‰ í•„í„°',

  // ê³µí†µ
  closeButton: 'ë‹«ê¸°',
  loadingSpinner: 'ë¡œë”© ì¤‘',
  errorMessage: (message: string) => `ì˜¤ë¥˜: ${message}`,
  successMessage: (message: string) => `ì„±ê³µ: ${message}`,
};
```

### 14.57 ìŠ¤í‚µ ë§í¬ ì»´í¬ë„ŒíŠ¸ (Part 6.4)

```typescript
// src/components/accessibility/SkipLink.tsx

// Part 6.4: ìŠ¤í‚µ ë§í¬ ì»´í¬ë„ŒíŠ¸

interface SkipLinkProps {
  href: string;
  children: React.ReactNode;
}

export function SkipLink({ href, children }: SkipLinkProps) {
  const handleClick = (e: React.MouseEvent<HTMLAnchorElement>) => {
    const target = document.querySelector(href);
    if (target) {
      e.preventDefault();
      (target as HTMLElement).focus();
      target.scrollIntoView({ behavior: 'smooth' });

      track('skip_link_used', {
        skipLinkType: 'main_content',
        targetId: href,
      });
    }
  };

  return (
    <a
      href={href}
      onClick={handleClick}
      className="
        sr-only focus:not-sr-only
        focus:fixed focus:top-4 focus:left-4
        focus:z-[10000] focus:px-6 focus:py-3
        focus:bg-gray-900 focus:text-white
        focus:rounded-lg focus:shadow-lg
        focus:outline-none focus:ring-2 focus:ring-blue-500
        focus:ring-offset-2
      "
    >
      {children}
    </a>
  );
}

// ìŠ¤í‚µ ë§í¬ ê·¸ë£¹
export function SkipLinks() {
  return (
    <div className="skip-links">
      <SkipLink href="#main-content">ë³¸ë¬¸ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸°</SkipLink>
      <SkipLink href="#navigation">ë„¤ë¹„ê²Œì´ì…˜ìœ¼ë¡œ ì´ë™</SkipLink>
      <SkipLink href="#search">ê²€ìƒ‰ìœ¼ë¡œ ì´ë™</SkipLink>
    </div>
  );
}
```

### 14.58 ì ‘ê·¼ì„± Analytics í›… (Part 6.4)

```typescript
// src/hooks/useAccessibilityAnalytics.ts

import { useEffect, useCallback } from 'react';
import { track } from '@/services/analytics';

// Part 6.4: ì ‘ê·¼ì„± ê´€ë ¨ ì´ë²¤íŠ¸ ë¶„ì„ í›…

export function useAccessibilityAnalytics() {
  // í‚¤ë³´ë“œ íƒìƒ‰ íŒ¨í„´ ì¶”ì 
  const trackKeyboardNavigation = useCallback(
    (data: {
      screen: string;
      navigationPath: string[];
      tabCount: number;
      taskCompleted: boolean;
      targetAction: string;
      totalNavigationTimeMs: number;
    }) => {
      track('keyboard_navigation_pattern', data);
    },
    []
  );

  // í¬ì»¤ìŠ¤ ì¸ë””ì¼€ì´í„° ìƒí˜¸ì‘ìš©
  const trackFocusInteraction = useCallback(
    (data: {
      elementType: string;
      elementId: string;
      focusMethod: 'keyboard' | 'programmatic';
      screen: string;
    }) => {
      track('focus_indicator_interaction', {
        ...data,
        focusVisible: true,
      });
    },
    []
  );

  // ì ‘ê·¼ì„± ì´ìŠˆ ë³´ê³ 
  const reportAccessibilityIssue = useCallback(
    (data: {
      issueType: string;
      severity: 'blocker' | 'critical' | 'major' | 'minor';
      description: string;
      screen: string;
      elementSelector?: string;
    }) => {
      track('accessibility_issue_reported', {
        ...data,
        browserInfo: navigator.userAgent,
      });
    },
    []
  );

  return {
    trackKeyboardNavigation,
    trackFocusInteraction,
    reportAccessibilityIssue,
  };
}

// ============================================
// ì‹œìŠ¤í…œ ì ‘ê·¼ì„± ì„¤ì • ê°ì§€ ë° ë¡œê¹…
// ============================================

export function useSystemAccessibilityTracking() {
  useEffect(() => {
    // ëª¨ì…˜ ê°ì†Œ ì„¤ì • ê°ì§€
    const reducedMotionQuery = window.matchMedia(
      '(prefers-reduced-motion: reduce)'
    );

    if (reducedMotionQuery.matches) {
      track('reduced_motion_enabled', {
        source: 'system_setting',
      });
    }

    // ê³ ëŒ€ë¹„ ì„¤ì • ê°ì§€
    const highContrastQuery = window.matchMedia('(prefers-contrast: more)');

    if (highContrastQuery.matches) {
      track('high_contrast_enabled', {
        source: 'system_setting',
        contrastMode: 'system',
      });
    }

    // ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    const handleReducedMotionChange = (e: MediaQueryListEvent) => {
      track(e.matches ? 'reduced_motion_enabled' : 'reduced_motion_disabled', {
        source: 'system_setting',
      });
    };

    const handleHighContrastChange = (e: MediaQueryListEvent) => {
      track(e.matches ? 'high_contrast_enabled' : 'high_contrast_disabled', {
        source: 'system_setting',
      });
    };

    reducedMotionQuery.addEventListener('change', handleReducedMotionChange);
    highContrastQuery.addEventListener('change', handleHighContrastChange);

    return () => {
      reducedMotionQuery.removeEventListener('change', handleReducedMotionChange);
      highContrastQuery.removeEventListener('change', handleHighContrastChange);
    };
  }, []);
}
```

### 14.59 ëª¨ì…˜ ê°ì†Œ ìœ í‹¸ë¦¬í‹° (Part 6.4)

```typescript
// src/utils/reducedMotion.ts

import { useAccessibilityStore } from '@/stores/accessibility.store';

// Part 6.4: ëª¨ì…˜ ê°ì†Œ ì„¤ì • ì§€ì› ìœ í‹¸ë¦¬í‹°

// ============================================
// 14.59.1 ëª¨ì…˜ ê°ì†Œ í›…
// ============================================

export function usePrefersReducedMotion() {
  const reduceMotion = useAccessibilityStore((state) => state.reduceMotion);
  const systemPrefersReducedMotion = useAccessibilityStore(
    (state) => state.systemPrefersReducedMotion
  );

  // ì‚¬ìš©ì ì„¤ì • ë˜ëŠ” ì‹œìŠ¤í…œ ì„¤ì • ì¤‘ í•˜ë‚˜ë¼ë„ í™œì„±í™”ë˜ë©´ true
  return reduceMotion || systemPrefersReducedMotion;
}

// ============================================
// 14.59.2 ì¡°ê±´ë¶€ ì• ë‹ˆë©”ì´ì…˜ ì„¤ì •
// ============================================

export function useMotionSafeAnimation(
  normalAnimation: object,
  reducedAnimation?: object
) {
  const prefersReducedMotion = usePrefersReducedMotion();

  if (prefersReducedMotion) {
    return reducedAnimation || { duration: 0 };
  }

  return normalAnimation;
}

// ============================================
// 14.59.3 Framer Motion variants í—¬í¼
// ============================================

export function createMotionSafeVariants(
  variants: Record<string, object>,
  reducedVariants?: Record<string, object>
) {
  const prefersReducedMotion =
    typeof window !== 'undefined' &&
    window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  if (prefersReducedMotion && reducedVariants) {
    return reducedVariants;
  }

  if (prefersReducedMotion) {
    // ê¸°ë³¸ì ìœ¼ë¡œ opacityë§Œ ìœ ì§€
    const safeVariants: Record<string, object> = {};
    for (const [key, value] of Object.entries(variants)) {
      safeVariants[key] = {
        opacity: (value as any).opacity ?? 1,
        transition: { duration: 0.05 },
      };
    }
    return safeVariants;
  }

  return variants;
}

// ============================================
// 14.59.4 ì‚¬ìš© ì˜ˆì‹œ
// ============================================

/*
// ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©
const cardVariants = createMotionSafeVariants({
  hidden: { opacity: 0, y: 20 },
  visible: { opacity: 1, y: 0, transition: { duration: 0.3 } },
});

return (
  <motion.div
    variants={cardVariants}
    initial="hidden"
    animate="visible"
  >
    {children}
  </motion.div>
);
*/
```

---

## 15. ì´ë²¤íŠ¸ ë¡œê¹… ë° ë¶„ì„

### 15.1 Analytics ì„¤ì •

```typescript
// src/services/analytics.ts
import posthog from 'posthog-js';

// PostHog ì´ˆê¸°í™”
export const initAnalytics = () => {
  if (import.meta.env.VITE_POSTHOG_KEY) {
    posthog.init(import.meta.env.VITE_POSTHOG_KEY, {
      api_host: 'https://app.posthog.com',
      capture_pageview: false,
      autocapture: false,
    });
  }
};

// ì´ë²¤íŠ¸ íŠ¸ë˜í‚¹
export const track = (
  event: string,
  properties?: Record<string, any>
) => {
  if (import.meta.env.DEV) {
    console.log('ğŸ” Analytics:', event, properties);
  }
  posthog.capture(event, properties);
};

// ì‚¬ìš©ì ì‹ë³„
export const identify = (userId: string, traits?: Record<string, any>) => {
  posthog.identify(userId, traits);
};
```

### 13.2 ì´ë²¤íŠ¸ íƒ€ì… ì •ì˜

```typescript
// src/types/analytics.ts

// ë°ëª¨ ì²´í—˜ ì´ë²¤íŠ¸
interface DemoEvent {
  userId: string;              // ìµëª… ID (ì¿ í‚¤)
  sessionId: string;           // ì„¸ì…˜ ID
  timestamp: number;           // Unix timestamp
  event: DemoEventType;
  metadata?: DemoEventMetadata;
}

type DemoEventType =
  // ì§„ì…
  | 'demo_started'
  | 'welcome_screen_shown'
  // ì¤€ë¹„ ë‹¨ê³„
  | 'prep_modal_opened'
  | 'prep_checkbox_clicked'
  | 'prep_completed'
  | 'prep_skipped'
  // ì‹œë®¬ë ˆì´ì…˜
  | 'simulation_started'
  | 'transcript_updated'
  | 'insight_shown'
  | 'alert_shown'
  | 'alert_action'
  | 'simulation_completed'
  // í™•ì •
  | 'confirmation_modal_opened'
  | 'integration_toggled'
  | 'save_clicked'
  | 'save_completed'
  // ì „í™˜
  | 'signup_modal_shown'
  | 'signup_clicked'
  | 'demo_abandoned';

interface DemoEventMetadata {
  duration?: number;
  checkboxId?: string;
  alertLevel?: 1 | 2 | 3;
  integration?: 'notion' | 'slack' | 'salesforce';
  enabled?: boolean;
  lastStep?: string;
}

// íšŒì›ê°€ì… ì´ë²¤íŠ¸
type SignupEventType =
  | 'signup_modal_shown'
  | 'signup_cta_clicked'
  | 'oauth_popup_opened'
  | 'oauth_authorized'
  | 'oauth_denied'
  | 'email_form_shown'
  | 'email_validation_error'
  | 'email_duplicate_error'
  | 'signup_completed'
  | 'demo_data_migrated'
  | 'welcome_screen_shown'
  | 'today_screen_entered'
  | 'later_clicked'
  | 'later_confirm_modal_shown'
  | 'later_reconversion'
  | 'signup_abandoned';

interface SignupEventMetadata {
  method?: 'google' | 'github' | 'email';
  timeFromDemoEnd?: number;
  errorType?: string;
  errorMessage?: string;
  reconversion?: boolean;
  migratedItems?: {
    meetings: number;
    decisions: number;
    insights: number;
    actions: number;
  };
}
```

### 13.3 Analytics Hook

```typescript
// src/hooks/useAnalytics.ts
import { useCallback } from 'react';
import { track } from '@/services/analytics';
import { useSession } from './useSession';

export function useAnalytics() {
  const { sessionId, userId } = useSession();

  const trackEvent = useCallback((
    event: string,
    metadata?: Record<string, any>
  ) => {
    track(event, {
      userId,
      sessionId,
      timestamp: Date.now(),
      ...metadata,
    });
  }, [sessionId, userId]);

  // ë°ëª¨ ê´€ë ¨ ì´ë²¤íŠ¸
  const trackDemoStart = () => trackEvent('demo_started');
  const trackDemoComplete = () => trackEvent('demo_completed');
  const trackDemoAbandoned = (lastStep: string) =>
    trackEvent('demo_abandoned', { lastStep });

  // ì¤€ë¹„ ê´€ë ¨ ì´ë²¤íŠ¸
  const trackPrepModalOpen = () => trackEvent('prep_modal_opened');
  const trackPrepCheckbox = (checkboxId: string) =>
    trackEvent('prep_checkbox_clicked', { checkboxId });
  const trackPrepComplete = (duration: number) =>
    trackEvent('prep_completed', { duration });

  // ì•Œë¦¼ ê´€ë ¨ ì´ë²¤íŠ¸
  const trackAlertShown = (level: 1 | 2 | 3, alertId: string) =>
    trackEvent('alert_shown', { alertLevel: level, alertId });
  const trackAlertAction = (action: 'ask' | 'dismiss' | 'later') =>
    trackEvent('alert_action', { action });

  // íšŒì›ê°€ì… ê´€ë ¨ ì´ë²¤íŠ¸
  const trackSignupModalShown = () => trackEvent('signup_modal_shown');
  const trackSignupClicked = (method: 'google' | 'github' | 'email') =>
    trackEvent('signup_cta_clicked', { method });
  const trackSignupCompleted = (method: string) =>
    trackEvent('signup_completed', { method });
  const trackLaterClicked = () => trackEvent('later_clicked');
  const trackLaterReconversion = () => trackEvent('later_reconversion');

  // Notion í†µí•© ê´€ë ¨ ì´ë²¤íŠ¸ (Part 1.4)
  const trackNotionCheckboxShown = () => trackEvent('notion_checkbox_shown');
  const trackNotionCheckboxChecked = () => trackEvent('notion_checkbox_checked');
  const trackNotionCheckboxUnchecked = () => trackEvent('notion_checkbox_unchecked');
  const trackNotionConnectClicked = () => trackEvent('notion_connect_clicked');
  const trackNotionOAuthStarted = () => trackEvent('notion_oauth_started');
  const trackNotionOAuthCompleted = () => trackEvent('notion_oauth_completed');
  const trackNotionOAuthDenied = () => trackEvent('notion_oauth_denied');
  const trackNotionOAuthError = (errorType: string) =>
    trackEvent('notion_oauth_error', { errorType });
  const trackNotionSaveAttempted = () => trackEvent('notion_save_attempted');
  const trackNotionSaveCompleted = () => trackEvent('notion_save_completed');
  const trackNotionSaveFailed = (errorType?: string) =>
    trackEvent('notion_save_failed', { errorType });
  const trackNotionViewClicked = () => trackEvent('notion_view_clicked');

  return {
    trackEvent,
    // Demo
    trackDemoStart,
    trackDemoComplete,
    trackDemoAbandoned,
    // Prep
    trackPrepModalOpen,
    trackPrepCheckbox,
    trackPrepComplete,
    // Alert
    trackAlertShown,
    trackAlertAction,
    // Signup
    trackSignupModalShown,
    trackSignupClicked,
    trackSignupCompleted,
    trackLaterClicked,
    trackLaterReconversion,
    // Notion (Part 1.4)
    trackNotionCheckboxShown,
    trackNotionCheckboxChecked,
    trackNotionCheckboxUnchecked,
    trackNotionConnectClicked,
    trackNotionOAuthStarted,
    trackNotionOAuthCompleted,
    trackNotionOAuthDenied,
    trackNotionOAuthError,
    trackNotionSaveAttempted,
    trackNotionSaveCompleted,
    trackNotionSaveFailed,
    trackNotionViewClicked,
  };
}
```

### 13.4 í•µì‹¬ ì§€í‘œ ê³„ì‚°

```typescript
// src/utils/metrics.ts

// ì²´í—˜ ì™„ë£Œìœ¨
export const calcDemoCompletionRate = (events: DemoEvent[]) => {
  const started = events.filter(e => e.event === 'demo_started').length;
  const completed = events.filter(e => e.event === 'simulation_completed').length;
  return started > 0 ? completed / started : 0;
};
// ëª©í‘œ: > 65%

// Aha Moment ë„ë‹¬ë¥ 
export const calcAhaMomentRate = (events: DemoEvent[]) => {
  const alertsShown = events.filter(e => e.event === 'alert_shown').length;
  const alertsClicked = events.filter(
    e => e.event === 'alert_action' && e.metadata?.action === 'ask'
  ).length;
  return alertsShown > 0 ? alertsClicked / alertsShown : 0;
};
// ëª©í‘œ: > 70%

// ê°€ì… ì „í™˜ìœ¨
export const calcSignupConversionRate = (events: SignupEvent[]) => {
  const shown = events.filter(e => e.event === 'signup_modal_shown').length;
  const completed = events.filter(e => e.event === 'signup_completed').length;
  return shown > 0 ? completed / shown : 0;
};
// ëª©í‘œ: > 42%

// ì¬ì „í™˜ìœ¨
export const calcReconversionRate = (events: SignupEvent[]) => {
  const laterClicked = events.filter(e => e.event === 'later_clicked').length;
  const reconverted = events.filter(e => e.event === 'later_reconversion').length;
  return laterClicked > 0 ? reconverted / laterClicked : 0;
};
// ëª©í‘œ: > 30%
```

### 13.5 ì‚¬ìš© ì˜ˆì‹œ

```typescript
// src/components/demo/DemoSimulation.tsx
import { useAnalytics } from '@/hooks/useAnalytics';
import { useState, useEffect } from 'react';

export function DemoSimulation() {
  const {
    trackDemoStart,
    trackDemoComplete,
    trackAlertShown,
    trackAlertAction,
  } = useAnalytics();

  // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ë°ëª¨ ì‹œì‘ ì¶”ì 
  useEffect(() => {
    trackDemoStart();
  }, []);

  // ì•Œë¦¼ í‘œì‹œ ì‹œ
  const handleAlertShow = (level: 1 | 2 | 3, alertId: string) => {
    trackAlertShown(level, alertId);
    setCurrentAlert({ level, alertId });
  };

  // ì•Œë¦¼ ì•¡ì…˜ ì²˜ë¦¬
  const handleAlertAction = (action: 'ask' | 'dismiss' | 'later') => {
    trackAlertAction(action);

    if (action === 'ask') {
      // ì§ˆë¬¸ ë³µì‚¬ ë“± ì²˜ë¦¬
    }
  };

  // ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ ì‹œ
  const handleSimulationComplete = () => {
    trackDemoComplete();
    // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
  };

  // ...
}
```

```typescript
// src/components/signup/SignupModal.tsx
import { useAnalytics } from '@/hooks/useAnalytics';

export function SignupModal({ onClose }: { onClose: () => void }) {
  const {
    trackSignupModalShown,
    trackSignupClicked,
    trackSignupCompleted,
    trackLaterClicked,
    trackLaterReconversion,
  } = useAnalytics();
  const [showLaterConfirm, setShowLaterConfirm] = useState(false);

  // ëª¨ë‹¬ í‘œì‹œ ì‹œ
  useEffect(() => {
    trackSignupModalShown();
  }, []);

  // êµ¬ê¸€ ë¡œê·¸ì¸ í´ë¦­
  const handleGoogleSignup = async () => {
    trackSignupClicked('google');

    try {
      await signInWithGoogle();
      trackSignupCompleted('google');
    } catch (error) {
      // ì—ëŸ¬ ì²˜ë¦¬
    }
  };

  // "ë‚˜ì¤‘ì—" í´ë¦­
  const handleLater = () => {
    trackLaterClicked();
    setShowLaterConfirm(true);
  };

  // í™•ì¸ ëª¨ë‹¬ì—ì„œ "1ì´ˆ ê°€ì…í•˜ê¸°" í´ë¦­
  const handleReconversion = () => {
    trackLaterReconversion();
    setShowLaterConfirm(false);
    // êµ¬ê¸€ ë¡œê·¸ì¸ í”Œë¡œìš° ì‹œì‘
    handleGoogleSignup();
  };

  // ...
}
```

---

**ë¬¸ì„œ ë**

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-30 (Part 3 HUD ì¸í„°ë™ì…˜ êµ¬í˜„ ì¶”ê°€)

**ë‹¤ìŒ ë‹¨ê³„:**
1. ê°œë°œ í™˜ê²½ ì„¤ì • (Node.js, pnpm)
2. í”„ë¡œì íŠ¸ ì´ˆê¸°í™” ë° ì˜ì¡´ì„± ì„¤ì¹˜
3. ë””ìì¸ ì‹œìŠ¤í…œë¶€í„° ìˆœì°¨ ê°œë°œ
4. ì»´í¬ë„ŒíŠ¸ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
5. E2E í…ŒìŠ¤íŠ¸ ì‘ì„±
6. ë¹Œë“œ ë° ë¡œì»¬ í…ŒìŠ¤íŠ¸
7. PostHog ì—°ë™ ë° ëŒ€ì‹œë³´ë“œ ì„¤ì •
8. **Part 3 HUD ì»´í¬ë„ŒíŠ¸ êµ¬í˜„**: useMeetingDetection, HUDIdleExpanded, HUDAlertCard, RiskAcceptanceDialog
